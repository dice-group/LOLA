cpu-bind=MASK - n2dgx01, task  0  0 [852226]: mask |--------|--------||--------|--------||--------|--------||--------|--------||||B-------|--------||--------|--------||--------|--------||--------|--------|  set
python: can't open file '/scratch/hpc-prf-lola/nikit/repos/Megatron-DeepSpeed-Microsoft/lola_ws/scaling_experiments/../gpt_param_estimate_util.py': [Errno 2] No such file or directory
LAUNCHER: python -u -m torch.distributed.run --nproc_per_node 1 --nnodes 1 --rdzv_id=30632 --rdzv_endpoint n2dgx01:6005 --rdzv_backend c10d --max_restarts 0 --tee 3
CMD: /scratch/hpc-prf-lola/nikit/repos/Megatron-DeepSpeed-Microsoft/pretrain_gpt.py --override-opt_param-scheduler --adam-beta1 0.9 --adam-beta2 0.95 --tensor-model-parallel-size 1 --moe-expert-parallel-size 1 --num-experts 4 --moe-loss-coeff 0.01 --moe-train-capacity-factor 1.0 --moe-eval-capacity-factor 1.0 --moe-min-capacity 4 --init-method-std 0.01 --lr-decay-tokens 300000000000 --lr-warmup-tokens 375000000 --micro-batch-size 8 --exit-duration-in-mins 30000000 --global-batch-size 8 --num-layers 24 --hidden-size 1536 --num-attention-heads 16 --seq-length 2048 --max-position-embeddings 2048 --train-tokens 300000000000 --train-iters 54931640 --lr 2.0e-4 --min-lr 2e-06 --lr-decay-style cosine --split 98,2,0 --log-interval 5 --eval-interval 100 --eval-iters 50 --save-interval 1000000 --weight-decay 0.1 --clip-grad 1.0 --hysteresis 2 --num-workers 0 --fp16 --load /scratch/hpc-prf-lola/nikit/repos/Megatron-DeepSpeed-Microsoft/lola_ws/scaling_experiments/output/GPT_0.76B_MoE128_8BATCH_1GPU_1Node/checkpoint/gpt-0.76B-lr-2.0e-4-minlr-2e-06-bs-8-gpus-1-mp-1-pp-1-ep-4-mlc-0.01-cap-1.0-drop-true --save /scratch/hpc-prf-lola/nikit/repos/Megatron-DeepSpeed-Microsoft/lola_ws/scaling_experiments/output/GPT_0.76B_MoE128_8BATCH_1GPU_1Node/checkpoint/gpt-0.76B-lr-2.0e-4-minlr-2e-06-bs-8-gpus-1-mp-1-pp-1-ep-4-mlc-0.01-cap-1.0-drop-true --tensorboard-queue-size 1 --log-timers-to-tensorboard --log-batch-size-to-tensorboard --log-validation-ppl-to-tensorboard --tensorboard-dir /scratch/hpc-prf-lola/nikit/repos/Megatron-DeepSpeed-Microsoft/lola_ws/scaling_experiments/output/GPT_0.76B_MoE128_8BATCH_1GPU_1Node/tensorboard/gpt-0.76B-lr-2.0e-4-minlr-2e-06-bs-8-gpus-1-mp-1-pp-1-ep-4-mlc-0.01-cap-1.0-drop-true_n2dgx01_2023.09.01-14.22.46 --checkpoint-activations --create-moe-param-group --vocab-file /scratch/hpc-prf-lola/nikit/repos/Megatron-DeepSpeed-Microsoft/data/gpt2-vocab.json --merge-file /scratch/hpc-prf-lola/nikit/repos/Megatron-DeepSpeed-Microsoft/data/gpt2-merges.txt --data-path /scratch/hpc-prf-lola/nikit/repos/Megatron-DeepSpeed-Microsoft/data/meg-gpt2-oscar-en-10k_text_document --data-impl mmap --deepspeed --deepspeed_config /scratch/hpc-prf-lola/nikit/repos/Megatron-DeepSpeed-Microsoft/lola_ws/scaling_experiments/output/GPT_0.76B_MoE128_8BATCH_1GPU_1Node/ds_config_gpt_gpt-0.76B-lr-2.0e-4-minlr-2e-06-bs-8-gpus-1-mp-1-pp-1-ep-4-mlc-0.01-cap-1.0-drop-true.json --pipeline-model-parallel-size 1 --no-pipeline-parallel --deepspeed-activation-checkpointing
cpu-bind=MASK - n2dgx01, task  0  0 [852332]: mask |--------|--------||--------|--------||--------|--------||--------|--------||||B-------|--------||--------|--------||--------|--------||--------|--------|  set
[default0]:[2023-09-01 14:22:49,349] [INFO] [real_accelerator.py:158:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[default0]:--------------------------------------------------
[default0]:DeepSpeed C++/CUDA extension op report
[default0]:--------------------------------------------------
[default0]:NOTE: Ops not installed will be just-in-time (JIT) compiled at
[default0]:      runtime if needed. Op compatibility means that your system
[default0]:      meet the required dependencies to JIT install the op.
[default0]:--------------------------------------------------
[default0]:JIT compiled ops requires ninja
[default0]:ninja .................. [92m[OKAY][0m
[default0]:--------------------------------------------------
[default0]:op name ................ installed .. compatible
[default0]:--------------------------------------------------
[default0]:[93m [WARNING] [0m async_io requires the dev libaio .so object and headers but these were not found.
[default0]:[93m [WARNING] [0m async_io: please install the libaio-devel package with yum
[default0]:[93m [WARNING] [0m If libaio is already installed (perhaps from source), try setting the CFLAGS and LDFLAGS environment variables to where it can be found.
[default0]:async_io ............... [93m[NO][0m ....... [93m[NO][0m
[default0]:fused_adam ............. [93m[NO][0m ....... [92m[OKAY][0m
[default0]:cpu_adam ............... [93m[NO][0m ....... [92m[OKAY][0m
[default0]:cpu_adagrad ............ [93m[NO][0m ....... [92m[OKAY][0m
[default0]:fused_lamb ............. [93m[NO][0m ....... [92m[OKAY][0m
[default0]:quantizer .............. [93m[NO][0m ....... [92m[OKAY][0m
[default0]:random_ltd ............. [93m[NO][0m ....... [92m[OKAY][0m
[default0]:[93m [WARNING] [0m please install triton==1.0.0 if you want to use sparse attention
[default0]:sparse_attn ............ [93m[NO][0m ....... [93m[NO][0m
[default0]:spatial_inference ...... [93m[NO][0m ....... [92m[OKAY][0m
[default0]:transformer ............ [93m[NO][0m ....... [92m[OKAY][0m
[default0]:stochastic_transformer . [93m[NO][0m ....... [92m[OKAY][0m
[default0]:transformer_inference .. [93m[NO][0m ....... [92m[OKAY][0m
[default0]:--------------------------------------------------
[default0]:DeepSpeed general environment info:
[default0]:torch install path ............... ['/opt/software/pc2/EB-SW/software/PyTorch/1.12.0-foss-2022a-CUDA-11.7.0/lib/python3.10/site-packages/torch']
[default0]:torch version .................... 1.12.0
[default0]:deepspeed install path ........... ['/scratch/hpc-prf-lola/lib_repo/custom-venvs/lola1/lib/python3.10/site-packages/deepspeed']
[default0]:deepspeed info ................... 0.10.1, unknown, unknown
[default0]:torch cuda version ............... 11.7
[default0]:torch hip version ................ None
[default0]:nvcc version ..................... 11.7
[default0]:deepspeed wheel compiled w. ...... torch 1.12, cuda 11.7
[default0]:shared memory (/dev/shm) size .... 503.68 GB
[default0]:**** Git info for Megatron: git_hash=633e9338 git_branch=main ****
[default0]:using world size: 1, data-parallel-size: 1, tensor-model-parallel size: 1, pipeline-model-parallel size: 1 
[default0]:using torch.float16 for parameters ...
[default0]:------------------------ arguments ------------------------
[default0]:  accumulate_allreduce_grads_in_fp32 .............. False
[default0]:  adam_beta1 ...................................... 0.9
[default0]:  adam_beta2 ...................................... 0.95
[default0]:  adam_eps ........................................ 1e-08
[default0]:  add_bias_linear ................................. True
[default0]:  add_position_embedding .......................... True
[default0]:  adlr_autoresume ................................. False
[default0]:  adlr_autoresume_interval ........................ 1000
[default0]:  aml_data_download_path .......................... None
[default0]:  apply_layernorm_1p .............................. False
[default0]:  apply_query_key_layer_scaling ................... True
[default0]:  apply_residual_connection_post_layernorm ........ False
[default0]:  async_tensor_model_parallel_allreduce ........... False
[default0]:  attention_dropout ............................... 0.1
[default0]:  attention_softmax_in_fp32 ....................... False
[default0]:  barrier_with_L1_time ............................ True
[default0]:  bert_binary_head ................................ True
[default0]:  bert_embedder_type .............................. megatron
[default0]:  bert_load ....................................... None
[default0]:  bf16 ............................................ False
[default0]:  bias_dropout_fusion ............................. True
[default0]:  bias_gelu_fusion ................................ True
[default0]:  biencoder_projection_dim ........................ 0
[default0]:  biencoder_shared_query_context_model ............ False
[default0]:  block_data_path ................................. None
[default0]:  checkpoint_activations .......................... True
[default0]:  checkpoint_in_cpu ............................... False
[default0]:  checkpoint_num_layers ........................... 1
[default0]:  classes_fraction ................................ 1.0
[default0]:  clip_grad ....................................... 1.0
[default0]:  compression_training ............................ False
[default0]:  consumed_train_samples .......................... 0
[default0]:  consumed_train_tokens ........................... 0
[default0]:  consumed_valid_samples .......................... 0
[default0]:  contigious_checkpointing ........................ False
[default0]:  cpu_optimizer ................................... False
[default0]:  cpu_torch_adam .................................. False
[default0]:  create_moe_param_group .......................... True
[default0]:  curriculum_learning_legacy ...................... False
[default0]:  data_cache_path ................................. None
[default0]:  data_efficiency_curriculum_learning ............. False
[default0]:  data_impl ....................................... mmap
[default0]:  data_parallel_random_init ....................... False
[default0]:  data_parallel_size .............................. 1
[default0]:  data_path ....................................... ['/scratch/hpc-prf-lola/nikit/repos/Megatron-DeepSpeed-Microsoft/data/meg-gpt2-oscar-en-10k_text_document']
[default0]:  data_per_class_fraction ......................... 1.0
[default0]:  data_sharding ................................... True
[default0]:  dataloader_type ................................. single
[default0]:  DDP_impl ........................................ local
[default0]:  decoder_num_layers .............................. None
[default0]:  decoder_seq_length .............................. None
[default0]:  deepscale ....................................... False
[default0]:  deepscale_config ................................ None
[default0]:  deepspeed ....................................... True
[default0]:  deepspeed_activation_checkpointing .............. True
[default0]:  deepspeed_config ................................ /scratch/hpc-prf-lola/nikit/repos/Megatron-DeepSpeed-Microsoft/lola_ws/scaling_experiments/output/GPT_0.76B_MoE128_8BATCH_1GPU_1Node/ds_config_gpt_gpt-0.76B-lr-2.0e-4-minlr-2e-06-bs-8-gpus-1-mp-1-pp-1-ep-4-mlc-0.01-cap-1.0-drop-true.json
[default0]:  deepspeed_mpi ................................... False
[default0]:  dino_bottleneck_size ............................ 256
[default0]:  dino_freeze_last_layer .......................... 1
[default0]:  dino_head_hidden_size ........................... 2048
[default0]:  dino_local_crops_number ......................... 10
[default0]:  dino_local_img_size ............................. 96
[default0]:  dino_norm_last_layer ............................ False
[default0]:  dino_teacher_temp ............................... 0.07
[default0]:  dino_warmup_teacher_temp ........................ 0.04
[default0]:  dino_warmup_teacher_temp_epochs ................. 30
[default0]:  distribute_checkpointed_activations ............. False
[default0]:  distribute_saved_activations .................... False
[default0]:  distributed_backend ............................. nccl
[default0]:  distributed_timeout_minutes ..................... 10
[default0]:  ds_inference .................................... False
[default0]:  ds_pipeline_enabled ............................. False
[default0]:  embedding_path .................................. None
[default0]:  embedding_weights_in_fp32 ....................... False
[default0]:  empty_unused_memory_level ....................... 0
[default0]:  enable_expert_tensor_parallelism ................ False
[default0]:  encoder_num_layers .............................. 24
[default0]:  encoder_seq_length .............................. 2048
[default0]:  end_weight_decay ................................ 0.1
[default0]:  eod_mask_loss ................................... False
[default0]:  eval_interval ................................... 100
[default0]:  eval_iters ...................................... 50
[default0]:  evidence_data_path .............................. None
[default0]:  exit_duration_in_mins ........................... 30000000
[default0]:  exit_interval ................................... None
[default0]:  exit_on_missing_checkpoint ...................... False
[default0]:  exit_signal_handler ............................. False
[default0]:  expert_interval ................................. 2
[default0]:  ffn_hidden_size ................................. 6144
[default0]:  finetune ........................................ False
[default0]:  fp16 ............................................ True
[default0]:  fp16_lm_cross_entropy ........................... False
[default0]:  fp32_residual_connection ........................ False
[default0]:  fp8_amax_compute_algo ........................... most_recent
[default0]:  fp8_amax_history_len ............................ 1
[default0]:  fp8_e4m3 ........................................ False
[default0]:  fp8_hybrid ...................................... False
[default0]:  fp8_interval .................................... 1
[default0]:  fp8_margin ...................................... 0
[default0]:  fp8_wgrad ....................................... True
[default0]:  global_batch_size ............................... 8
[default0]:  gradient_accumulation_fusion .................... True
[default0]:  head_lr_mult .................................... 1.0
[default0]:  hidden_dropout .................................. 0.1
[default0]:  hidden_size ..................................... 1536
[default0]:  hidden_size_teacher ............................. None
[default0]:  hysteresis ...................................... 2
[default0]:  ict_head_size ................................... None
[default0]:  ict_load ........................................ None
[default0]:  img_h ........................................... 224
[default0]:  img_w ........................................... 224
[default0]:  indexer_batch_size .............................. 128
[default0]:  indexer_log_interval ............................ 1000
[default0]:  inference ....................................... False
[default0]:  inference_batch_times_seqlen_threshold .......... 512
[default0]:  init_method_std ................................. 0.01
[default0]:  init_method_xavier_uniform ...................... False
[default0]:  initial_loss_scale .............................. 4294967296
[default0]:  iter_per_epoch .................................. 1250
[default0]:  kd .............................................. False
[default0]:  kd_alpha_ce ..................................... 1
[default0]:  kd_beta_ce ...................................... 1
[default0]:  kd_temp ......................................... 1.0
[default0]:  kv_channels ..................................... 96
[default0]:  layernorm_epsilon ............................... 1e-05
[default0]:  lazy_mpu_init ................................... None
[default0]:  load ............................................ /scratch/hpc-prf-lola/nikit/repos/Megatron-DeepSpeed-Microsoft/lola_ws/scaling_experiments/output/GPT_0.76B_MoE128_8BATCH_1GPU_1Node/checkpoint/gpt-0.76B-lr-2.0e-4-minlr-2e-06-bs-8-gpus-1-mp-1-pp-1-ep-4-mlc-0.01-cap-1.0-drop-true
[default0]:  load_teacher .................................... None
[default0]:  local_rank ...................................... None
[default0]:  log_batch_size_to_tensorboard ................... True
[default0]:  log_interval .................................... 5
[default0]:  log_learning_rate_to_tensorboard ................ True
[default0]:  log_loss_scale_to_tensorboard ................... True
[default0]:  log_memory_to_tensorboard ....................... False
[default0]:  log_num_zeros_in_grad ........................... False
[default0]:  log_optimizer_states_to_tensorboard ............. False
[default0]:  log_params_norm ................................. False
[default0]:  log_timers_to_tensorboard ....................... True
[default0]:  log_validation_ppl_to_tensorboard ............... True
[default0]:  log_world_size_to_tensorboard ................... False
[default0]:  loss_scale ...................................... None
[default0]:  loss_scale_window ............................... 1000
[default0]:  lr .............................................. 0.0002
[default0]:  lr_decay_iters .................................. None
[default0]:  lr_decay_samples ................................ None
[default0]:  lr_decay_style .................................. cosine
[default0]:  lr_decay_tokens ................................. 300000000000
[default0]:  lr_warmup_fraction .............................. None
[default0]:  lr_warmup_iters ................................. 0
[default0]:  lr_warmup_samples ............................... 0
[default0]:  lr_warmup_tokens ................................ 375000000
[default0]:  make_vocab_size_divisible_by .................... 128
[default0]:  mask_factor ..................................... 1.0
[default0]:  mask_prob ....................................... 0.15
[default0]:  mask_type ....................................... random
[default0]:  masked_softmax_fusion ........................... True
[default0]:  max_position_embeddings ......................... 2048
[default0]:  max_tokens_to_oom ............................... 12000
[default0]:  memory_centric_tiled_linear ..................... False
[default0]:  merge_file ...................................... /scratch/hpc-prf-lola/nikit/repos/Megatron-DeepSpeed-Microsoft/data/gpt2-merges.txt
[default0]:  micro_batch_size ................................ 8
[default0]:  min_loss_scale .................................. 1.0
[default0]:  min_lr .......................................... 2e-06
[default0]:  mlp_type ........................................ standard
[default0]:  mmap_warmup ..................................... False
[default0]:  moe_eval_capacity_factor ........................ 1.0
[default0]:  moe_expert_parallel_size ........................ 1
[default0]:  moe_loss_coeff .................................. 0.01
[default0]:  moe_min_capacity ................................ 4
[default0]:  moe_token_dropping .............................. True
[default0]:  moe_train_capacity_factor ....................... 1.0
[default0]:  mos ............................................. False
[default0]:  no_load_lr_state ................................ False
[default0]:  no_load_optim ................................... None
[default0]:  no_load_rng ..................................... None
[default0]:  no_persist_layer_norm ........................... False
[default0]:  no_pipeline_parallel ............................ True
[default0]:  no_save_optim ................................... None
[default0]:  no_save_rng ..................................... None
[default0]:  normalization ................................... layernorm
[default0]:  num_attention_heads ............................. 16
[default0]:  num_attention_heads_teacher ..................... None
[default0]:  num_channels .................................... 3
[default0]:  num_classes ..................................... 1000
[default0]:  num_experts ..................................... [4]
[default0]:  num_experts_switch .............................. None
[default0]:  num_experts_teacher ............................. [1]
[default0]:  num_key_value_heads ............................. 16
[default0]:  num_layers ...................................... 24
[default0]:  num_layers_per_virtual_pipeline_stage ........... None
[default0]:  num_layers_teacher .............................. None
[default0]:  num_workers ..................................... 0
[default0]:  onnx_safe ....................................... None
[default0]:  openai_gelu ..................................... False
[default0]:  optimizer ....................................... adam
[default0]:  output_bert_embeddings .......................... False
[default0]:  overlap_p2p_comm ................................ False
[default0]:  override_opt_param_scheduler .................... True
[default0]:  params_dtype .................................... torch.float16
[default0]:  partition_activations ........................... False
[default0]:  patch_dim ....................................... 16
[default0]:  perform_initialization .......................... True
[default0]:  pipeline_model_parallel_size .................... 1
[default0]:  pipeline_model_parallel_split_rank .............. None
[default0]:  profile_backward ................................ False
[default0]:  query_in_block_prob ............................. 0.1
[default0]:  rampup_batch_size ............................... None
[default0]:  random_ltd ...................................... False
[default0]:  rank ............................................ 0
[default0]:  recompute_granularity ........................... None
[default0]:  recompute_method ................................ None
[default0]:  recompute_num_layers ............................ 1
[default0]:  remote_device ................................... none
[default0]:  reset_attention_mask ............................ False
[default0]:  reset_iteration ................................. False
[default0]:  reset_position_ids .............................. False
[default0]:  retriever_report_topk_accuracies ................ []
[default0]:  retriever_score_scaling ......................... False
[default0]:  retriever_seq_length ............................ 256
[default0]:  retro_add_retriever ............................. False
[default0]:  retro_cyclic_train_iters ........................ None
[default0]:  retro_encoder_attention_dropout ................. 0.1
[default0]:  retro_encoder_hidden_dropout .................... 0.1
[default0]:  retro_encoder_layers ............................ 2
[default0]:  retro_num_neighbors ............................. 2
[default0]:  retro_num_retrieved_chunks ...................... 2
[default0]:  retro_return_doc_ids ............................ False
[default0]:  retro_workdir ................................... None
[default0]:  return_data_index ............................... False
[default0]:  rotary_percent .................................. 1.0
[default0]:  sample_rate ..................................... 1.0
[default0]:  save ............................................ /scratch/hpc-prf-lola/nikit/repos/Megatron-DeepSpeed-Microsoft/lola_ws/scaling_experiments/output/GPT_0.76B_MoE128_8BATCH_1GPU_1Node/checkpoint/gpt-0.76B-lr-2.0e-4-minlr-2e-06-bs-8-gpus-1-mp-1-pp-1-ep-4-mlc-0.01-cap-1.0-drop-true
[default0]:  save_interval ................................... 1000000
[default0]:  scatter_gather_tensors_in_pipeline .............. True
[default0]:  scattered_embeddings ............................ False
[default0]:  seed ............................................ 1234
[default0]:  seq_length ...................................... 2048
[default0]:  sequence_parallel ............................... False
[default0]:  sgd_momentum .................................... 0.9
[default0]:  short_seq_prob .................................. 0.1
[default0]:  skip_train ...................................... False
[default0]:  split ........................................... 98,2,0
[default0]:  split_transformers .............................. False
[default0]:  squared_relu .................................... False
[default0]:  standalone_embedding_stage ...................... False
[default0]:  start_weight_decay .............................. 0.1
[default0]:  swiglu .......................................... False
[default0]:  swin_backbone_type .............................. tiny
[default0]:  synchronize_each_layer .......................... False
[default0]:  tensor_model_parallel_size ...................... 1
[default0]:  tensorboard_dir ................................. /scratch/hpc-prf-lola/nikit/repos/Megatron-DeepSpeed-Microsoft/lola_ws/scaling_experiments/output/GPT_0.76B_MoE128_8BATCH_1GPU_1Node/tensorboard/gpt-0.76B-lr-2.0e-4-minlr-2e-06-bs-8-gpus-1-mp-1-pp-1-ep-4-mlc-0.01-cap-1.0-drop-true_n2dgx01_2023.09.01-14.22.46
[default0]:  tensorboard_log_interval ........................ 1
[default0]:  tensorboard_queue_size .......................... 1
[default0]:  test_data_path .................................. None
[default0]:  tile_factor ..................................... 1
[default0]:  timing_log_level ................................ 0
[default0]:  timing_log_option ............................... minmax
[default0]:  titles_data_path ................................ None
[default0]:  tokenizer_model ................................. None
[default0]:  tokenizer_type .................................. GPT2BPETokenizer
[default0]:  topk ............................................ 1
[default0]:  train_data_exact_num_epochs ..................... None
[default0]:  train_data_path ................................. None
[default0]:  train_desc_path ................................. None
[default0]:  train_doc_idx_path .............................. None
[default0]:  train_idx_path .................................. None
[default0]:  train_iters ..................................... 54931640
[default0]:  train_sample_idx_path ........................... None
[default0]:  train_samples ................................... None
[default0]:  train_shuffle_idx_path .......................... None
[default0]:  train_tokens .................................... 300000000000
[default0]:  transformer_impl ................................ local
[default0]:  transformer_pipeline_model_parallel_size ........ 1
[default0]:  untie_embeddings_and_output_weights ............. False
[default0]:  use_checkpoint_args ............................. False
[default0]:  use_checkpoint_opt_param_scheduler .............. False
[default0]:  use_contiguous_buffers_in_local_ddp ............. True
[default0]:  use_cpu_initialization .......................... None
[default0]:  use_distributed_optimizer ....................... False
[default0]:  use_flash_attn .................................. False
[default0]:  use_one_sent_docs ............................... False
[default0]:  use_pin_memory .................................. False
[default0]:  use_ring_exchange_p2p ........................... False
[default0]:  use_rotary_position_embeddings .................. False
[default0]:  use_tutel ....................................... False
[default0]:  valid_data_path ................................. None
[default0]:  variable_seq_lengths ............................ False
[default0]:  virtual_pipeline_model_parallel_size ............ None
[default0]:  vision_backbone_type ............................ vit
[default0]:  vision_pretraining .............................. False
[default0]:  vision_pretraining_type ......................... classify
[default0]:  vocab_extra_ids ................................. 0
[default0]:  vocab_file ...................................... /scratch/hpc-prf-lola/nikit/repos/Megatron-DeepSpeed-Microsoft/data/gpt2-vocab.json
[default0]:  vocab_size ...................................... None
[default0]:  weight_decay .................................... 0.1
[default0]:  weight_decay_incr_style ......................... constant
[default0]:  world_size ...................................... 1
[default0]:  zero_allgather_bucket_size ...................... 0.0
[default0]:  zero_contigious_gradients ....................... False
[default0]:  zero_reduce_bucket_size ......................... 0.0
[default0]:  zero_reduce_scatter ............................. False
[default0]:  zero_stage ...................................... 1.0
[default0]:-------------------- end of arguments ---------------------
[default0]:setting number of micro-batches to constant 1
[default0]:> building GPT2BPETokenizer tokenizer ...
[default0]: > padded vocab (size: 50257) with 47 dummy tokens (new size: 50304)
[default0]:> setting tensorboard ...
[default0]:> initializing torch distributed ...
[default0]:[2023-09-01 14:23:03,851] [INFO] [comm.py:631:init_distributed] cdb=None
[default0]:[2023-09-01 14:23:03,851] [INFO] [comm.py:662:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
[default0]:> initialized tensor model parallel with size 1
[default0]:> initialized pipeline model parallel with size 1
[default0]:> setting random seeds to 1234 ...
[default0]:> initializing model parallel cuda seeds on global rank 0, model parallel rank 0, and data parallel rank 0 with model parallel seed: 3952 and data parallel seed: 1234
[default0]:> compiling dataset index builder ...
[default0]:make: Entering directory '/scratch/hpc-prf-lola/nikit/repos/Megatron-DeepSpeed-Microsoft/megatron/data'
[default0]:make: Nothing to be done for 'default'.
[default0]:make: Leaving directory '/scratch/hpc-prf-lola/nikit/repos/Megatron-DeepSpeed-Microsoft/megatron/data'
[default0]:>>> done with dataset index builder. Compilation time: 0.125 seconds
[default0]:> compiling and loading fused kernels ...
[default0]:Detected CUDA files, patching ldflags
[default0]:Emitting ninja build file /scratch/hpc-prf-lola/nikit/repos/Megatron-DeepSpeed-Microsoft/megatron/fused_kernels/build/build.ninja...
[default0]:Building extension module scaled_upper_triang_masked_softmax_cuda...
[default0]:Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
[default0]:ninja: no work to do.
[default0]:Loading extension module scaled_upper_triang_masked_softmax_cuda...
[default0]:Detected CUDA files, patching ldflags
[default0]:Emitting ninja build file /scratch/hpc-prf-lola/nikit/repos/Megatron-DeepSpeed-Microsoft/megatron/fused_kernels/build/build.ninja...
[default0]:Building extension module scaled_masked_softmax_cuda...
[default0]:Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
[default0]:ninja: no work to do.
[default0]:Loading extension module scaled_masked_softmax_cuda...
[default0]:Detected CUDA files, patching ldflags
[default0]:Emitting ninja build file /scratch/hpc-prf-lola/nikit/repos/Megatron-DeepSpeed-Microsoft/megatron/fused_kernels/build/build.ninja...
[default0]:Building extension module scaled_softmax_cuda...
[default0]:Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
[default0]:ninja: no work to do.
[default0]:Loading extension module scaled_softmax_cuda...
[default0]:n2dgx01:852351:852351 [0] NCCL INFO Bootstrap : Using ib0:10.10.103.101<0>
[default0]:n2dgx01:852351:852351 [0] NCCL INFO NET/Plugin : No plugin found (libnccl-net.so), using internal implementation
[default0]:n2dgx01:852351:852351 [0] NCCL INFO NET/IB : Using [0]mlx5_0:1/IB [RO]; OOB ib0:10.10.103.101<0>
[default0]:n2dgx01:852351:852351 [0] NCCL INFO Using network IB
[default0]:NCCL version 2.12.12+cuda11.7
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Channel 00/32 :    0
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Channel 01/32 :    0
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Channel 02/32 :    0
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Channel 03/32 :    0
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Channel 04/32 :    0
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Channel 05/32 :    0
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Channel 06/32 :    0
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Channel 07/32 :    0
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Channel 08/32 :    0
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Channel 09/32 :    0
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Channel 10/32 :    0
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Channel 11/32 :    0
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Channel 12/32 :    0
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Channel 13/32 :    0
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Channel 14/32 :    0
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Channel 15/32 :    0
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Channel 16/32 :    0
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Channel 17/32 :    0
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Channel 18/32 :    0
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Channel 19/32 :    0
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Channel 20/32 :    0
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Channel 21/32 :    0
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Channel 22/32 :    0
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Channel 23/32 :    0
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Channel 24/32 :    0
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Channel 25/32 :    0
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Channel 26/32 :    0
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Channel 27/32 :    0
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Channel 28/32 :    0
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Channel 29/32 :    0
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Channel 30/32 :    0
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Channel 31/32 :    0
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Trees [0] -1/-1/-1->0->-1 [1] -1/-1/-1->0->-1 [2] -1/-1/-1->0->-1 [3] -1/-1/-1->0->-1 [4] -1/-1/-1->0->-1 [5] -1/-1/-1->0->-1 [6] -1/-1/-1->0->-1 [7] -1/-1/-1->0->-1 [8] -1/-1/-1->0->-1 [9] -1/-1/-1->0->-1 [10] -1/-1/-1->0->-1 [11] -1/-1/-1->0->-1 [12] -1/-1/-1->0->-1 [13] -1/-1/-1->0->-1 [14] -1/-1/-1->0->-1 [15] -1/-1/-1->0->-1 [16] -1/-1/-1->0->-1 [17] -1/-1/-1->0->-1 [18] -1/-1/-1->0->-1 [19] -1/-1/-1->0->-1 [20] -1/-1/-1->0->-1 [21] -1/-1/-1->0->-1 [22] -1/-1/-1->0->-1 [23] -1/-1/-1->0->-1 [24] -1/-1/-1->0->-1 [25] -1/-1/-1->0->-1 [26] -1/-1/-1->0->-1 [27] -1/-1/-1->0->-1 [28] -1/-1/-1->0->-1 [29] -1/-1/-1->0->-1 [30] -1/-1/-1->0->-1 [31] -1/-1/-1->0->-1
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Connected all rings
[default0]:n2dgx01:852351:852557 [0] NCCL INFO Connected all trees
[default0]:n2dgx01:852351:852557 [0] NCCL INFO 32 coll channels, 32 p2p channels, 32 p2p channels per peer
[default0]:n2dgx01:852351:852557 [0] NCCL INFO comm 0x149c8c0090d0 rank 0 nranks 1 cudaDev 0 busId 7000 - Init COMPLETE
[default0]:>>> done with compiling and loading fused kernels. Compilation time: 2.977 seconds
[default0]:time to initialize megatron (seconds): 5.585
[default0]:[after megatron is initialized] datetime: 2023-09-01 14:23:07 
[default0]:building GPT model ...
[default0]:[2023-09-01 14:23:07,957] [INFO] [utils.py:803:see_memory_usage] Before Building Model
[default0]:[2023-09-01 14:23:07,958] [INFO] [utils.py:804:see_memory_usage] MA 0.0 GB         Max_MA 3.19 GB         CA 0.0 GB         Max_CA 3 GB 
[default0]:[2023-09-01 14:23:07,959] [INFO] [utils.py:811:see_memory_usage] CPU Virtual Memory:  used = 12.82 GB, percent = 1.3%
[default0]:LOLA: Number of experts passed to language model: [4]
[default0]:LOLA: Building Encoder
[default0]:LOLA: Number of experts being sent to encoder layers: [4]
[default0]:LOLA: Number of experts for the MoE layers: [4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4]
[default0]:LOLA: Setting experts for layer number: 1
[default0]:LOLA: Building MLP layer, num_experts: 1
[default0]:LOLA: Built MLP layer: ParallelMLP(
[default0]:  (dense_h_to_4h): ColumnParallelLinear()
[default0]:  (dense_4h_to_h): RowParallelLinear()
[default0]:)
[default0]:LOLA: Setting experts for layer number: 2
[default0]:LOLA: Building MLP layer, num_experts: 4
[default0]:[2023-09-01 14:23:08,072] [INFO] [logging.py:96:log_dist] [Rank 0] Creating MoE layer with num_experts: 4 | num_local_experts: 4 | expert_parallel_size: 1
[default0]:LOLA: Built MLP layer: MoE(
[default0]:  (deepspeed_moe): MOELayer(
[default0]:    (gate): TopKGate(
[default0]:      (wg): Linear(in_features=1536, out_features=4, bias=False)
[default0]:    )
[default0]:    (experts): Experts(
[default0]:      (deepspeed_experts): ModuleList(
[default0]:        (0): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (1): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (2): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (3): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:      )
[default0]:    )
[default0]:  )
[default0]:)
[default0]:LOLA: Setting experts for layer number: 3
[default0]:LOLA: Building MLP layer, num_experts: 1
[default0]:LOLA: Built MLP layer: ParallelMLP(
[default0]:  (dense_h_to_4h): ColumnParallelLinear()
[default0]:  (dense_4h_to_h): RowParallelLinear()
[default0]:)
[default0]:LOLA: Setting experts for layer number: 4
[default0]:LOLA: Building MLP layer, num_experts: 4
[default0]:[2023-09-01 14:23:08,080] [INFO] [logging.py:96:log_dist] [Rank 0] Creating MoE layer with num_experts: 4 | num_local_experts: 4 | expert_parallel_size: 1
[default0]:LOLA: Built MLP layer: MoE(
[default0]:  (deepspeed_moe): MOELayer(
[default0]:    (gate): TopKGate(
[default0]:      (wg): Linear(in_features=1536, out_features=4, bias=False)
[default0]:    )
[default0]:    (experts): Experts(
[default0]:      (deepspeed_experts): ModuleList(
[default0]:        (0): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (1): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (2): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (3): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:      )
[default0]:    )
[default0]:  )
[default0]:)
[default0]:LOLA: Setting experts for layer number: 5
[default0]:LOLA: Building MLP layer, num_experts: 1
[default0]:LOLA: Built MLP layer: ParallelMLP(
[default0]:  (dense_h_to_4h): ColumnParallelLinear()
[default0]:  (dense_4h_to_h): RowParallelLinear()
[default0]:)
[default0]:LOLA: Setting experts for layer number: 6
[default0]:LOLA: Building MLP layer, num_experts: 4
[default0]:[2023-09-01 14:23:08,090] [INFO] [logging.py:96:log_dist] [Rank 0] Creating MoE layer with num_experts: 4 | num_local_experts: 4 | expert_parallel_size: 1
[default0]:LOLA: Built MLP layer: MoE(
[default0]:  (deepspeed_moe): MOELayer(
[default0]:    (gate): TopKGate(
[default0]:      (wg): Linear(in_features=1536, out_features=4, bias=False)
[default0]:    )
[default0]:    (experts): Experts(
[default0]:      (deepspeed_experts): ModuleList(
[default0]:        (0): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (1): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (2): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (3): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:      )
[default0]:    )
[default0]:  )
[default0]:)
[default0]:LOLA: Setting experts for layer number: 7
[default0]:LOLA: Building MLP layer, num_experts: 1
[default0]:LOLA: Built MLP layer: ParallelMLP(
[default0]:  (dense_h_to_4h): ColumnParallelLinear()
[default0]:  (dense_4h_to_h): RowParallelLinear()
[default0]:)
[default0]:LOLA: Setting experts for layer number: 8
[default0]:LOLA: Building MLP layer, num_experts: 4
[default0]:[2023-09-01 14:23:08,098] [INFO] [logging.py:96:log_dist] [Rank 0] Creating MoE layer with num_experts: 4 | num_local_experts: 4 | expert_parallel_size: 1
[default0]:LOLA: Built MLP layer: MoE(
[default0]:  (deepspeed_moe): MOELayer(
[default0]:    (gate): TopKGate(
[default0]:      (wg): Linear(in_features=1536, out_features=4, bias=False)
[default0]:    )
[default0]:    (experts): Experts(
[default0]:      (deepspeed_experts): ModuleList(
[default0]:        (0): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (1): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (2): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (3): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:      )
[default0]:    )
[default0]:  )
[default0]:)
[default0]:LOLA: Setting experts for layer number: 9
[default0]:LOLA: Building MLP layer, num_experts: 1
[default0]:LOLA: Built MLP layer: ParallelMLP(
[default0]:  (dense_h_to_4h): ColumnParallelLinear()
[default0]:  (dense_4h_to_h): RowParallelLinear()
[default0]:)
[default0]:LOLA: Setting experts for layer number: 10
[default0]:LOLA: Building MLP layer, num_experts: 4
[default0]:[2023-09-01 14:23:08,108] [INFO] [logging.py:96:log_dist] [Rank 0] Creating MoE layer with num_experts: 4 | num_local_experts: 4 | expert_parallel_size: 1
[default0]:LOLA: Built MLP layer: MoE(
[default0]:  (deepspeed_moe): MOELayer(
[default0]:    (gate): TopKGate(
[default0]:      (wg): Linear(in_features=1536, out_features=4, bias=False)
[default0]:    )
[default0]:    (experts): Experts(
[default0]:      (deepspeed_experts): ModuleList(
[default0]:        (0): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (1): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (2): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (3): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:      )
[default0]:    )
[default0]:  )
[default0]:)
[default0]:LOLA: Setting experts for layer number: 11
[default0]:LOLA: Building MLP layer, num_experts: 1
[default0]:LOLA: Built MLP layer: ParallelMLP(
[default0]:  (dense_h_to_4h): ColumnParallelLinear()
[default0]:  (dense_4h_to_h): RowParallelLinear()
[default0]:)
[default0]:LOLA: Setting experts for layer number: 12
[default0]:LOLA: Building MLP layer, num_experts: 4
[default0]:[2023-09-01 14:23:08,118] [INFO] [logging.py:96:log_dist] [Rank 0] Creating MoE layer with num_experts: 4 | num_local_experts: 4 | expert_parallel_size: 1
[default0]:LOLA: Built MLP layer: MoE(
[default0]:  (deepspeed_moe): MOELayer(
[default0]:    (gate): TopKGate(
[default0]:      (wg): Linear(in_features=1536, out_features=4, bias=False)
[default0]:    )
[default0]:    (experts): Experts(
[default0]:      (deepspeed_experts): ModuleList(
[default0]:        (0): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (1): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (2): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (3): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:      )
[default0]:    )
[default0]:  )
[default0]:)
[default0]:LOLA: Setting experts for layer number: 13
[default0]:LOLA: Building MLP layer, num_experts: 1
[default0]:LOLA: Built MLP layer: ParallelMLP(
[default0]:  (dense_h_to_4h): ColumnParallelLinear()
[default0]:  (dense_4h_to_h): RowParallelLinear()
[default0]:)
[default0]:LOLA: Setting experts for layer number: 14
[default0]:LOLA: Building MLP layer, num_experts: 4
[default0]:[2023-09-01 14:23:08,126] [INFO] [logging.py:96:log_dist] [Rank 0] Creating MoE layer with num_experts: 4 | num_local_experts: 4 | expert_parallel_size: 1
[default0]:LOLA: Built MLP layer: MoE(
[default0]:  (deepspeed_moe): MOELayer(
[default0]:    (gate): TopKGate(
[default0]:      (wg): Linear(in_features=1536, out_features=4, bias=False)
[default0]:    )
[default0]:    (experts): Experts(
[default0]:      (deepspeed_experts): ModuleList(
[default0]:        (0): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (1): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (2): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (3): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:      )
[default0]:    )
[default0]:  )
[default0]:)
[default0]:LOLA: Setting experts for layer number: 15
[default0]:LOLA: Building MLP layer, num_experts: 1
[default0]:LOLA: Built MLP layer: ParallelMLP(
[default0]:  (dense_h_to_4h): ColumnParallelLinear()
[default0]:  (dense_4h_to_h): RowParallelLinear()
[default0]:)
[default0]:LOLA: Setting experts for layer number: 16
[default0]:LOLA: Building MLP layer, num_experts: 4
[default0]:[2023-09-01 14:23:08,133] [INFO] [logging.py:96:log_dist] [Rank 0] Creating MoE layer with num_experts: 4 | num_local_experts: 4 | expert_parallel_size: 1
[default0]:LOLA: Built MLP layer: MoE(
[default0]:  (deepspeed_moe): MOELayer(
[default0]:    (gate): TopKGate(
[default0]:      (wg): Linear(in_features=1536, out_features=4, bias=False)
[default0]:    )
[default0]:    (experts): Experts(
[default0]:      (deepspeed_experts): ModuleList(
[default0]:        (0): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (1): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (2): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (3): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:      )
[default0]:    )
[default0]:  )
[default0]:)
[default0]:LOLA: Setting experts for layer number: 17
[default0]:LOLA: Building MLP layer, num_experts: 1
[default0]:LOLA: Built MLP layer: ParallelMLP(
[default0]:  (dense_h_to_4h): ColumnParallelLinear()
[default0]:  (dense_4h_to_h): RowParallelLinear()
[default0]:)
[default0]:LOLA: Setting experts for layer number: 18
[default0]:LOLA: Building MLP layer, num_experts: 4
[default0]:[2023-09-01 14:23:08,141] [INFO] [logging.py:96:log_dist] [Rank 0] Creating MoE layer with num_experts: 4 | num_local_experts: 4 | expert_parallel_size: 1
[default0]:LOLA: Built MLP layer: MoE(
[default0]:  (deepspeed_moe): MOELayer(
[default0]:    (gate): TopKGate(
[default0]:      (wg): Linear(in_features=1536, out_features=4, bias=False)
[default0]:    )
[default0]:    (experts): Experts(
[default0]:      (deepspeed_experts): ModuleList(
[default0]:        (0): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (1): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (2): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (3): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:      )
[default0]:    )
[default0]:  )
[default0]:)
[default0]:LOLA: Setting experts for layer number: 19
[default0]:LOLA: Building MLP layer, num_experts: 1
[default0]:LOLA: Built MLP layer: ParallelMLP(
[default0]:  (dense_h_to_4h): ColumnParallelLinear()
[default0]:  (dense_4h_to_h): RowParallelLinear()
[default0]:)
[default0]:LOLA: Setting experts for layer number: 20
[default0]:LOLA: Building MLP layer, num_experts: 4
[default0]:[2023-09-01 14:23:08,149] [INFO] [logging.py:96:log_dist] [Rank 0] Creating MoE layer with num_experts: 4 | num_local_experts: 4 | expert_parallel_size: 1
[default0]:LOLA: Built MLP layer: MoE(
[default0]:  (deepspeed_moe): MOELayer(
[default0]:    (gate): TopKGate(
[default0]:      (wg): Linear(in_features=1536, out_features=4, bias=False)
[default0]:    )
[default0]:    (experts): Experts(
[default0]:      (deepspeed_experts): ModuleList(
[default0]:        (0): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (1): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (2): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (3): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:      )
[default0]:    )
[default0]:  )
[default0]:)
[default0]:LOLA: Setting experts for layer number: 21
[default0]:LOLA: Building MLP layer, num_experts: 1
[default0]:LOLA: Built MLP layer: ParallelMLP(
[default0]:  (dense_h_to_4h): ColumnParallelLinear()
[default0]:  (dense_4h_to_h): RowParallelLinear()
[default0]:)
[default0]:LOLA: Setting experts for layer number: 22
[default0]:LOLA: Building MLP layer, num_experts: 4
[default0]:[2023-09-01 14:23:08,157] [INFO] [logging.py:96:log_dist] [Rank 0] Creating MoE layer with num_experts: 4 | num_local_experts: 4 | expert_parallel_size: 1
[default0]:LOLA: Built MLP layer: MoE(
[default0]:  (deepspeed_moe): MOELayer(
[default0]:    (gate): TopKGate(
[default0]:      (wg): Linear(in_features=1536, out_features=4, bias=False)
[default0]:    )
[default0]:    (experts): Experts(
[default0]:      (deepspeed_experts): ModuleList(
[default0]:        (0): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (1): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (2): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (3): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:      )
[default0]:    )
[default0]:  )
[default0]:)
[default0]:LOLA: Setting experts for layer number: 23
[default0]:LOLA: Building MLP layer, num_experts: 1
[default0]:LOLA: Built MLP layer: ParallelMLP(
[default0]:  (dense_h_to_4h): ColumnParallelLinear()
[default0]:  (dense_4h_to_h): RowParallelLinear()
[default0]:)
[default0]:LOLA: Setting experts for layer number: 24
[default0]:LOLA: Building MLP layer, num_experts: 4
[default0]:[2023-09-01 14:23:08,164] [INFO] [logging.py:96:log_dist] [Rank 0] Creating MoE layer with num_experts: 4 | num_local_experts: 4 | expert_parallel_size: 1
[default0]:LOLA: Built MLP layer: MoE(
[default0]:  (deepspeed_moe): MOELayer(
[default0]:    (gate): TopKGate(
[default0]:      (wg): Linear(in_features=1536, out_features=4, bias=False)
[default0]:    )
[default0]:    (experts): Experts(
[default0]:      (deepspeed_experts): ModuleList(
[default0]:        (0): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (1): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (2): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:        (3): ParallelMLP(
[default0]:          (dense_h_to_4h): ColumnParallelLinear()
[default0]:          (dense_4h_to_h): RowParallelLinear()
[default0]:        )
[default0]:      )
[default0]:    )
[default0]:  )
[default0]:)
[default0]:[2023-09-01 14:23:08,225] [INFO] [utils.py:803:see_memory_usage] After Building Model
[default0]:[2023-09-01 14:23:08,225] [INFO] [utils.py:804:see_memory_usage] MA 2.68 GB         Max_MA 2.71 GB         CA 2.75 GB         Max_CA 3 GB 
[default0]:[2023-09-01 14:23:08,226] [INFO] [utils.py:811:see_memory_usage] CPU Virtual Memory:  used = 12.83 GB, percent = 1.3%
[default0]: > number of parameters on (tensor, pipeline) model parallel rank (0, 0): 1440199680
[default0]:param_group keyset: dict_keys(['name', 'params', 'wd_mult', 'lr_mult'])
[default0]:> learning rate decay style: cosine
[default0]:DeepSpeed is enabled.
[default0]:[2023-09-01 14:23:08,232] [INFO] [logging.py:96:log_dist] [Rank 0] DeepSpeed info: version=0.10.1, git-hash=unknown, git-branch=unknown
[default0]:No existing process group found, creating a new group named: ep_size_1
[default0]:[2023-09-01 14:23:08,250] [INFO] [logging.py:96:log_dist] [Rank 0] Creating expert and data parallel groups with size 1
[default0]:[2023-09-01 14:23:08,251] [INFO] [logging.py:96:log_dist] [Rank 0] Creating expert data parallel process group named ep_size_1 with ranks: [0]
[default0]:[2023-09-01 14:23:08,251] [INFO] [logging.py:96:log_dist] [Rank 0] creating expert parallel process group named ep_size_1 with ranks: [0]
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Channel 00/32 :    0
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Channel 01/32 :    0
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Channel 02/32 :    0
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Channel 03/32 :    0
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Channel 04/32 :    0
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Channel 05/32 :    0
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Channel 06/32 :    0
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Channel 07/32 :    0
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Channel 08/32 :    0
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Channel 09/32 :    0
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Channel 10/32 :    0
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Channel 11/32 :    0
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Channel 12/32 :    0
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Channel 13/32 :    0
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Channel 14/32 :    0
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Channel 15/32 :    0
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Channel 16/32 :    0
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Channel 17/32 :    0
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Channel 18/32 :    0
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Channel 19/32 :    0
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Channel 20/32 :    0
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Channel 21/32 :    0
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Channel 22/32 :    0
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Channel 23/32 :    0
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Channel 24/32 :    0
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Channel 25/32 :    0
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Channel 26/32 :    0
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Channel 27/32 :    0
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Channel 28/32 :    0
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Channel 29/32 :    0
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Channel 30/32 :    0
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Channel 31/32 :    0
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Trees [0] -1/-1/-1->0->-1 [1] -1/-1/-1->0->-1 [2] -1/-1/-1->0->-1 [3] -1/-1/-1->0->-1 [4] -1/-1/-1->0->-1 [5] -1/-1/-1->0->-1 [6] -1/-1/-1->0->-1 [7] -1/-1/-1->0->-1 [8] -1/-1/-1->0->-1 [9] -1/-1/-1->0->-1 [10] -1/-1/-1->0->-1 [11] -1/-1/-1->0->-1 [12] -1/-1/-1->0->-1 [13] -1/-1/-1->0->-1 [14] -1/-1/-1->0->-1 [15] -1/-1/-1->0->-1 [16] -1/-1/-1->0->-1 [17] -1/-1/-1->0->-1 [18] -1/-1/-1->0->-1 [19] -1/-1/-1->0->-1 [20] -1/-1/-1->0->-1 [21] -1/-1/-1->0->-1 [22] -1/-1/-1->0->-1 [23] -1/-1/-1->0->-1 [24] -1/-1/-1->0->-1 [25] -1/-1/-1->0->-1 [26] -1/-1/-1->0->-1 [27] -1/-1/-1->0->-1 [28] -1/-1/-1->0->-1 [29] -1/-1/-1->0->-1 [30] -1/-1/-1->0->-1 [31] -1/-1/-1->0->-1
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Connected all rings
[default0]:n2dgx01:852351:852630 [0] NCCL INFO Connected all trees
[default0]:n2dgx01:852351:852630 [0] NCCL INFO 32 coll channels, 32 p2p channels, 32 p2p channels per peer
[default0]:n2dgx01:852351:852630 [0] NCCL INFO comm 0x149a580090d0 rank 0 nranks 1 cudaDev 0 busId 7000 - Init COMPLETE
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Channel 00/32 :    0
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Channel 01/32 :    0
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Channel 02/32 :    0
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Channel 03/32 :    0
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Channel 04/32 :    0
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Channel 05/32 :    0
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Channel 06/32 :    0
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Channel 07/32 :    0
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Channel 08/32 :    0
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Channel 09/32 :    0
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Channel 10/32 :    0
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Channel 11/32 :    0
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Channel 12/32 :    0
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Channel 13/32 :    0
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Channel 14/32 :    0
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Channel 15/32 :    0
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Channel 16/32 :    0
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Channel 17/32 :    0
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Channel 18/32 :    0
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Channel 19/32 :    0
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Channel 20/32 :    0
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Channel 21/32 :    0
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Channel 22/32 :    0
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Channel 23/32 :    0
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Channel 24/32 :    0
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Channel 25/32 :    0
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Channel 26/32 :    0
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Channel 27/32 :    0
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Channel 28/32 :    0
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Channel 29/32 :    0
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Channel 30/32 :    0
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Channel 31/32 :    0
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Trees [0] -1/-1/-1->0->-1 [1] -1/-1/-1->0->-1 [2] -1/-1/-1->0->-1 [3] -1/-1/-1->0->-1 [4] -1/-1/-1->0->-1 [5] -1/-1/-1->0->-1 [6] -1/-1/-1->0->-1 [7] -1/-1/-1->0->-1 [8] -1/-1/-1->0->-1 [9] -1/-1/-1->0->-1 [10] -1/-1/-1->0->-1 [11] -1/-1/-1->0->-1 [12] -1/-1/-1->0->-1 [13] -1/-1/-1->0->-1 [14] -1/-1/-1->0->-1 [15] -1/-1/-1->0->-1 [16] -1/-1/-1->0->-1 [17] -1/-1/-1->0->-1 [18] -1/-1/-1->0->-1 [19] -1/-1/-1->0->-1 [20] -1/-1/-1->0->-1 [21] -1/-1/-1->0->-1 [22] -1/-1/-1->0->-1 [23] -1/-1/-1->0->-1 [24] -1/-1/-1->0->-1 [25] -1/-1/-1->0->-1 [26] -1/-1/-1->0->-1 [27] -1/-1/-1->0->-1 [28] -1/-1/-1->0->-1 [29] -1/-1/-1->0->-1 [30] -1/-1/-1->0->-1 [31] -1/-1/-1->0->-1
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Connected all rings
[default0]:n2dgx01:852351:852637 [0] NCCL INFO Connected all trees
[default0]:n2dgx01:852351:852637 [0] NCCL INFO 32 coll channels, 32 p2p channels, 32 p2p channels per peer
[default0]:n2dgx01:852351:852637 [0] NCCL INFO comm 0x149a4c0090d0 rank 0 nranks 1 cudaDev 0 busId 7000 - Init COMPLETE
[default0]:[2023-09-01 14:23:10,320] [INFO] [logging.py:96:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: True
[default0]:[2023-09-01 14:23:10,322] [INFO] [logging.py:96:log_dist] [Rank 0] Removing param_group that has no 'params' in the client Optimizer
[default0]:[2023-09-01 14:23:10,322] [INFO] [logging.py:96:log_dist] [Rank 0] Using client Optimizer as basic optimizer
[default0]:[2023-09-01 14:23:10,340] [INFO] [logging.py:96:log_dist] [Rank 0] DeepSpeed Basic Optimizer = FusedAdam
[default0]:[2023-09-01 14:23:10,340] [INFO] [utils.py:54:is_zero_supported_optimizer] Checking ZeRO support for optimizer=FusedAdam type=<class 'apex.optimizers.fused_adam.FusedAdam'>
[default0]:[2023-09-01 14:23:10,341] [INFO] [logging.py:96:log_dist] [Rank 0] Creating torch.float16 ZeRO stage 2 optimizer
[default0]:[2023-09-01 14:23:10,341] [INFO] [stage_1_and_2.py:146:__init__] Reduce bucket size 500,000,000
[default0]:[2023-09-01 14:23:10,341] [INFO] [stage_1_and_2.py:147:__init__] Allgather bucket size 500,000,000
[default0]:[2023-09-01 14:23:10,341] [INFO] [stage_1_and_2.py:148:__init__] CPU Offload: False
[default0]:[2023-09-01 14:23:10,341] [INFO] [stage_1_and_2.py:149:__init__] Round robin gradient partitioning: False
[default0]:Rank: 0 partition count [1, 1, 1, 1, 1, 1, 1, 1, 1] and sizes[(533471232, False), (390144, False), (169869312, True), (169869312, True), (169869312, True), (169869312, True), (169869312, True), (56623104, True), (368640, True)] 
[default0]:[2023-09-01 14:23:12,650] [INFO] [utils.py:803:see_memory_usage] Before initializing optimizer states
[default0]:[2023-09-01 14:23:12,651] [INFO] [utils.py:804:see_memory_usage] MA 8.05 GB         Max_MA 8.05 GB         CA 8.07 GB         Max_CA 8 GB 
[default0]:[2023-09-01 14:23:12,651] [INFO] [utils.py:811:see_memory_usage] CPU Virtual Memory:  used = 13.57 GB, percent = 1.3%
[default0]:[2023-09-01 14:23:12,774] [INFO] [utils.py:803:see_memory_usage] After initializing optimizer states
[default0]:[2023-09-01 14:23:12,775] [INFO] [utils.py:804:see_memory_usage] MA 18.78 GB         Max_MA 24.15 GB         CA 24.16 GB         Max_CA 24 GB 
[default0]:[2023-09-01 14:23:12,775] [INFO] [utils.py:811:see_memory_usage] CPU Virtual Memory:  used = 13.57 GB, percent = 1.3%
[default0]:[2023-09-01 14:23:12,775] [INFO] [stage_1_and_2.py:520:__init__] optimizer state initialized
[default0]:[2023-09-01 14:23:12,831] [INFO] [utils.py:803:see_memory_usage] After initializing ZeRO optimizer
[default0]:[2023-09-01 14:23:12,831] [INFO] [utils.py:804:see_memory_usage] MA 18.78 GB         Max_MA 18.78 GB         CA 24.16 GB         Max_CA 24 GB 
[default0]:[2023-09-01 14:23:12,832] [INFO] [utils.py:811:see_memory_usage] CPU Virtual Memory:  used = 13.57 GB, percent = 1.3%
[default0]:[2023-09-01 14:23:12,840] [INFO] [logging.py:96:log_dist] [Rank 0] DeepSpeed Final Optimizer = FusedAdam
[default0]:[2023-09-01 14:23:12,840] [INFO] [logging.py:96:log_dist] [Rank 0] DeepSpeed using client LR scheduler
[default0]:[2023-09-01 14:23:12,841] [INFO] [logging.py:96:log_dist] [Rank 0] DeepSpeed LR Scheduler = <megatron.optimizer_param_scheduler.OptimizerParamScheduler object at 0x149d0eecae60>
[default0]:[2023-09-01 14:23:12,841] [INFO] [logging.py:96:log_dist] [Rank 0] step=0, skipped=0, lr=[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], mom=[(0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95)]
[default0]:[2023-09-01 14:23:12,842] [INFO] [config.py:960:print] DeepSpeedEngine configuration:
[default0]:[2023-09-01 14:23:12,842] [INFO] [config.py:964:print]   activation_checkpointing_config  {
[default0]:    "partition_activations": false, 
[default0]:    "contiguous_memory_optimization": false, 
[default0]:    "cpu_checkpointing": false, 
[default0]:    "number_checkpoints": null, 
[default0]:    "synchronize_checkpoint_boundary": false, 
[default0]:    "profile": false
[default0]:}
[default0]:[2023-09-01 14:23:12,842] [INFO] [config.py:964:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[default0]:[2023-09-01 14:23:12,842] [INFO] [config.py:964:print]   amp_enabled .................. False
[default0]:[2023-09-01 14:23:12,842] [INFO] [config.py:964:print]   amp_params ................... False
[default0]:[2023-09-01 14:23:12,842] [INFO] [config.py:964:print]   autotuning_config ............ {
[default0]:    "enabled": false, 
[default0]:    "start_step": null, 
[default0]:    "end_step": null, 
[default0]:    "metric_path": null, 
[default0]:    "arg_mappings": null, 
[default0]:    "metric": "throughput", 
[default0]:    "model_info": null, 
[default0]:    "results_dir": "autotuning_results", 
[default0]:    "exps_dir": "autotuning_exps", 
[default0]:    "overwrite": true, 
[default0]:    "fast": true, 
[default0]:    "start_profile_step": 3, 
[default0]:    "end_profile_step": 5, 
[default0]:    "tuner_type": "gridsearch", 
[default0]:    "tuner_early_stopping": 5, 
[default0]:    "tuner_num_trials": 50, 
[default0]:    "model_info_path": null, 
[default0]:    "mp_size": 1, 
[default0]:    "max_train_batch_size": null, 
[default0]:    "min_train_batch_size": 1, 
[default0]:    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
[default0]:    "min_train_micro_batch_size_per_gpu": 1, 
[default0]:    "num_tuning_micro_batch_sizes": 3
[default0]:}
[default0]:[2023-09-01 14:23:12,842] [INFO] [config.py:964:print]   bfloat16_enabled ............. False
[default0]:[2023-09-01 14:23:12,842] [INFO] [config.py:964:print]   checkpoint_parallel_write_pipeline  False
[default0]:[2023-09-01 14:23:12,842] [INFO] [config.py:964:print]   checkpoint_tag_validation_enabled  True
[default0]:[2023-09-01 14:23:12,843] [INFO] [config.py:964:print]   checkpoint_tag_validation_fail  False
[default0]:[2023-09-01 14:23:12,843] [INFO] [config.py:964:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x149d0cb18820>
[default0]:[2023-09-01 14:23:12,843] [INFO] [config.py:964:print]   communication_data_type ...... None
[default0]:[2023-09-01 14:23:12,843] [INFO] [config.py:964:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[default0]:[2023-09-01 14:23:12,843] [INFO] [config.py:964:print]   curriculum_enabled_legacy .... False
[default0]:[2023-09-01 14:23:12,843] [INFO] [config.py:964:print]   curriculum_params_legacy ..... {'curriculum_type': 'seqlen', 'min_difficulty': 80, 'max_difficulty': 2048, 'schedule_type': 'fixed_linear', 'schedule_config': {'total_curriculum_step': 7048872, 'difficulty_step': 8}}
[default0]:[2023-09-01 14:23:12,843] [INFO] [config.py:964:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[default0]:[2023-09-01 14:23:12,843] [INFO] [config.py:964:print]   data_efficiency_enabled ...... False
[default0]:[2023-09-01 14:23:12,843] [INFO] [config.py:964:print]   dataloader_drop_last ......... False
[default0]:[2023-09-01 14:23:12,843] [INFO] [config.py:964:print]   disable_allgather ............ False
[default0]:[2023-09-01 14:23:12,843] [INFO] [config.py:964:print]   dump_state ................... False
[default0]:[2023-09-01 14:23:12,843] [INFO] [config.py:964:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 500, 'delayed_shift': 2, 'consecutive_hysteresis': False, 'min_scale': 1}
[default0]:[2023-09-01 14:23:12,843] [INFO] [config.py:964:print]   eigenvalue_enabled ........... False
[default0]:[2023-09-01 14:23:12,843] [INFO] [config.py:964:print]   eigenvalue_gas_boundary_resolution  1
[default0]:[2023-09-01 14:23:12,844] [INFO] [config.py:964:print]   eigenvalue_layer_name ........ bert.encoder.layer
[default0]:[2023-09-01 14:23:12,844] [INFO] [config.py:964:print]   eigenvalue_layer_num ......... 0
[default0]:[2023-09-01 14:23:12,844] [INFO] [config.py:964:print]   eigenvalue_max_iter .......... 100
[default0]:[2023-09-01 14:23:12,844] [INFO] [config.py:964:print]   eigenvalue_stability ......... 1e-06
[default0]:[2023-09-01 14:23:12,844] [INFO] [config.py:964:print]   eigenvalue_tol ............... 0.01
[default0]:[2023-09-01 14:23:12,844] [INFO] [config.py:964:print]   eigenvalue_verbose ........... False
[default0]:[2023-09-01 14:23:12,844] [INFO] [config.py:964:print]   elasticity_enabled ........... False
[default0]:[2023-09-01 14:23:12,844] [INFO] [config.py:964:print]   flops_profiler_config ........ {
[default0]:    "enabled": true, 
[default0]:    "recompute_fwd_factor": 0.0, 
[default0]:    "profile_step": 10, 
[default0]:    "module_depth": -1, 
[default0]:    "top_modules": 1, 
[default0]:    "detailed": true, 
[default0]:    "output_file": null
[default0]:}
[default0]:[2023-09-01 14:23:12,844] [INFO] [config.py:964:print]   fp16_auto_cast ............... False
[default0]:[2023-09-01 14:23:12,844] [INFO] [config.py:964:print]   fp16_enabled ................. True
[default0]:[2023-09-01 14:23:12,844] [INFO] [config.py:964:print]   fp16_master_weights_and_gradients  False
[default0]:[2023-09-01 14:23:12,844] [INFO] [config.py:964:print]   global_rank .................. 0
[default0]:[2023-09-01 14:23:12,844] [INFO] [config.py:964:print]   grad_accum_dtype ............. None
[default0]:[2023-09-01 14:23:12,844] [INFO] [config.py:964:print]   gradient_accumulation_steps .. 1
[default0]:[2023-09-01 14:23:12,845] [INFO] [config.py:964:print]   gradient_clipping ............ 1
[default0]:[2023-09-01 14:23:12,845] [INFO] [config.py:964:print]   gradient_predivide_factor .... 1.0
[default0]:[2023-09-01 14:23:12,845] [INFO] [config.py:964:print]   hybrid_engine ................ enabled=False max_out_tokens=512 inference_tp_size=1 release_inference_cache=False pin_parameters=True tp_gather_partition_size=8
[default0]:[2023-09-01 14:23:12,845] [INFO] [config.py:964:print]   initial_dynamic_scale ........ 2048
[default0]:[2023-09-01 14:23:12,845] [INFO] [config.py:964:print]   load_universal_checkpoint .... False
[default0]:[2023-09-01 14:23:12,845] [INFO] [config.py:964:print]   loss_scale ................... 0
[default0]:[2023-09-01 14:23:12,845] [INFO] [config.py:964:print]   memory_breakdown ............. False
[default0]:[2023-09-01 14:23:12,845] [INFO] [config.py:964:print]   mics_hierarchial_params_gather  False
[default0]:[2023-09-01 14:23:12,845] [INFO] [config.py:964:print]   mics_shard_size .............. -1
[default0]:[2023-09-01 14:23:12,845] [INFO] [config.py:964:print]   monitor_config ............... tensorboard=TensorBoardConfig(enabled=False, output_path='', job_name='DeepSpeedJobName') wandb=WandbConfig(enabled=False, group=None, team=None, project='deepspeed') csv_monitor=CSVConfig(enabled=False, output_path='', job_name='DeepSpeedJobName') enabled=False
[default0]:[2023-09-01 14:23:12,845] [INFO] [config.py:964:print]   nebula_config ................ {
[default0]:    "enabled": false, 
[default0]:    "persistent_storage_path": null, 
[default0]:    "persistent_time_interval": 100, 
[default0]:    "num_of_version_in_retention": 2, 
[default0]:    "enable_nebula_load": true, 
[default0]:    "load_path": null
[default0]:}
[default0]:[2023-09-01 14:23:12,845] [INFO] [config.py:964:print]   optimizer_legacy_fusion ...... False
[default0]:[2023-09-01 14:23:12,845] [INFO] [config.py:964:print]   optimizer_name ............... None
[default0]:[2023-09-01 14:23:12,846] [INFO] [config.py:964:print]   optimizer_params ............. None
[default0]:[2023-09-01 14:23:12,846] [INFO] [config.py:964:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[default0]:[2023-09-01 14:23:12,846] [INFO] [config.py:964:print]   pld_enabled .................. False
[default0]:[2023-09-01 14:23:12,846] [INFO] [config.py:964:print]   pld_params ................... False
[default0]:[2023-09-01 14:23:12,846] [INFO] [config.py:964:print]   prescale_gradients ........... False
[default0]:[2023-09-01 14:23:12,846] [INFO] [config.py:964:print]   scheduler_name ............... None
[default0]:[2023-09-01 14:23:12,846] [INFO] [config.py:964:print]   scheduler_params ............. None
[default0]:[2023-09-01 14:23:12,846] [INFO] [config.py:964:print]   sparse_attention ............. None
[default0]:[2023-09-01 14:23:12,846] [INFO] [config.py:964:print]   sparse_gradients_enabled ..... False
[default0]:[2023-09-01 14:23:12,846] [INFO] [config.py:964:print]   steps_per_print .............. 5
[default0]:[2023-09-01 14:23:12,846] [INFO] [config.py:964:print]   train_batch_size ............. 8
[default0]:[2023-09-01 14:23:12,846] [INFO] [config.py:964:print]   train_micro_batch_size_per_gpu  8
[default0]:[2023-09-01 14:23:12,846] [INFO] [config.py:964:print]   use_node_local_storage ....... False
[default0]:[2023-09-01 14:23:12,846] [INFO] [config.py:964:print]   wall_clock_breakdown ......... True
[default0]:[2023-09-01 14:23:12,847] [INFO] [config.py:964:print]   world_size ................... 1
[default0]:[2023-09-01 14:23:12,847] [INFO] [config.py:964:print]   zero_allow_untested_optimizer  False
[default0]:[2023-09-01 14:23:12,847] [INFO] [config.py:964:print]   zero_config .................. stage=2 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False zero_hpz_partition_size=1 zero_quantized_weights=False zero_quantized_gradients=False mics_shard_size=-1 mics_hierarchical_params_gather=False memory_efficient_linear=True pipeline_loading_checkpoint=False override_module_apply=True
[default0]:[2023-09-01 14:23:12,847] [INFO] [config.py:964:print]   zero_enabled ................. True
[default0]:[2023-09-01 14:23:12,847] [INFO] [config.py:964:print]   zero_force_ds_cpu_optimizer .. True
[default0]:[2023-09-01 14:23:12,847] [INFO] [config.py:964:print]   zero_optimization_stage ...... 2
[default0]:[2023-09-01 14:23:12,847] [INFO] [config.py:950:print_user_config]   json = {
[default0]:    "train_batch_size": 8, 
[default0]:    "train_micro_batch_size_per_gpu": 8, 
[default0]:    "steps_per_print": 5, 
[default0]:    "zero_optimization": {
[default0]:        "stage": 2
[default0]:    }, 
[default0]:    "gradient_clipping": 1, 
[default0]:    "prescale_gradients": false, 
[default0]:    "fp16": {
[default0]:        "enabled": true, 
[default0]:        "loss_scale": 0, 
[default0]:        "loss_scale_window": 500, 
[default0]:        "hysteresis": 2, 
[default0]:        "min_loss_scale": 1, 
[default0]:        "initial_scale_power": 11
[default0]:    }, 
[default0]:    "bf16": {
[default0]:        "enabled": false
[default0]:    }, 
[default0]:    "curriculum_learning": {
[default0]:        "enabled": false, 
[default0]:        "curriculum_type": "seqlen", 
[default0]:        "min_difficulty": 80, 
[default0]:        "max_difficulty": 2.048000e+03, 
[default0]:        "schedule_type": "fixed_linear", 
[default0]:        "schedule_config": {
[default0]:            "total_curriculum_step": 7.048872e+06, 
[default0]:            "difficulty_step": 8
[default0]:        }
[default0]:    }, 
[default0]:    "wall_clock_breakdown": true, 
[default0]:    "flops_profiler": {
[default0]:        "enabled": true, 
[default0]:        "profile_step": 10, 
[default0]:        "module_depth": -1, 
[default0]:        "top_modules": 1, 
[default0]:        "detailed": true, 
[default0]:        "output_file": null
[default0]:    }
[default0]:}
[default0]:[2023-09-01 14:23:12,849] [WARNING] [engine.py:2638:load_checkpoint] Unable to find latest file at /scratch/hpc-prf-lola/nikit/repos/Megatron-DeepSpeed-Microsoft/lola_ws/scaling_experiments/output/GPT_0.76B_MoE128_8BATCH_1GPU_1Node/checkpoint/gpt-0.76B-lr-2.0e-4-minlr-2e-06-bs-8-gpus-1-mp-1-pp-1-ep-4-mlc-0.01-cap-1.0-drop-true/latest, if trying to load latest checkpoint please ensure this file exists or pass an explicit checkpoint tag when loading a checkpoint.
[default0]:WARNING: could not find the metadata file /scratch/hpc-prf-lola/nikit/repos/Megatron-DeepSpeed-Microsoft/lola_ws/scaling_experiments/output/GPT_0.76B_MoE128_8BATCH_1GPU_1Node/checkpoint/gpt-0.76B-lr-2.0e-4-minlr-2e-06-bs-8-gpus-1-mp-1-pp-1-ep-4-mlc-0.01-cap-1.0-drop-true 
[default0]:    will not load any checkpoints and will start from random
[default0]:(min, max) time across ranks (ms):
[default0]:    load-checkpoint ................................: (1.61, 1.61)
[default0]:[after model, optimizer, and learning rate scheduler are built] datetime: 2023-09-01 14:23:12 
[default0]:> building train, validation, and test datasets ...
[default0]: > datasets target sizes (minimum size):
[default0]:    train:      439453120
[default0]:    validation: 219726800
[default0]:    test:       400
[default0]:> building train, validation, and test datasets for GPT ...
[default0]:Single data path provided for train, valid & test
[default0]: > building dataset index ...
[default0]:    reading sizes...
[default0]:    reading pointers...
[default0]:    reading document index...
[default0]:    creating numpy buffer of mmap...
[default0]:    creating memory view of numpy buffer...
[default0]: > finished creating indexed dataset in 0.013492 seconds
[default0]:    number of documents: 10000
[default0]: > dataset split:
[default0]:    train:
[default0]:     document indices in [0, 9800) total of 9800 documents
[default0]:    validation:
[default0]:     document indices in [9800, 10000) total of 200 documents
[default0]:    test:
[default0]:     document indices in [10000, 10000) total of 0 documents
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Channel 00/32 :    0
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Channel 01/32 :    0
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Channel 02/32 :    0
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Channel 03/32 :    0
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Channel 04/32 :    0
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Channel 05/32 :    0
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Channel 06/32 :    0
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Channel 07/32 :    0
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Channel 08/32 :    0
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Channel 09/32 :    0
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Channel 10/32 :    0
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Channel 11/32 :    0
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Channel 12/32 :    0
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Channel 13/32 :    0
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Channel 14/32 :    0
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Channel 15/32 :    0
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Channel 16/32 :    0
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Channel 17/32 :    0
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Channel 18/32 :    0
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Channel 19/32 :    0
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Channel 20/32 :    0
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Channel 21/32 :    0
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Channel 22/32 :    0
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Channel 23/32 :    0
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Channel 24/32 :    0
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Channel 25/32 :    0
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Channel 26/32 :    0
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Channel 27/32 :    0
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Channel 28/32 :    0
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Channel 29/32 :    0
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Channel 30/32 :    0
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Channel 31/32 :    0
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Trees [0] -1/-1/-1->0->-1 [1] -1/-1/-1->0->-1 [2] -1/-1/-1->0->-1 [3] -1/-1/-1->0->-1 [4] -1/-1/-1->0->-1 [5] -1/-1/-1->0->-1 [6] -1/-1/-1->0->-1 [7] -1/-1/-1->0->-1 [8] -1/-1/-1->0->-1 [9] -1/-1/-1->0->-1 [10] -1/-1/-1->0->-1 [11] -1/-1/-1->0->-1 [12] -1/-1/-1->0->-1 [13] -1/-1/-1->0->-1 [14] -1/-1/-1->0->-1 [15] -1/-1/-1->0->-1 [16] -1/-1/-1->0->-1 [17] -1/-1/-1->0->-1 [18] -1/-1/-1->0->-1 [19] -1/-1/-1->0->-1 [20] -1/-1/-1->0->-1 [21] -1/-1/-1->0->-1 [22] -1/-1/-1->0->-1 [23] -1/-1/-1->0->-1 [24] -1/-1/-1->0->-1 [25] -1/-1/-1->0->-1 [26] -1/-1/-1->0->-1 [27] -1/-1/-1->0->-1 [28] -1/-1/-1->0->-1 [29] -1/-1/-1->0->-1 [30] -1/-1/-1->0->-1 [31] -1/-1/-1->0->-1
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Connected all rings
[default0]:n2dgx01:852351:852651 [0] NCCL INFO Connected all trees
[default0]:n2dgx01:852351:852651 [0] NCCL INFO 32 coll channels, 32 p2p channels, 32 p2p channels per peer
[default0]:n2dgx01:852351:852651 [0] NCCL INFO comm 0x149c200090d0 rank 0 nranks 1 cudaDev 0 busId 7000 - Init COMPLETE
[default0]: > loading doc-idx mapping from /scratch/hpc-prf-lola/nikit/repos/Megatron-DeepSpeed-Microsoft/data/index-cache/3e541422cadca564d1c62edd2b40c688_doc_idx.npy
[default0]: > loading sample-idx mapping from /scratch/hpc-prf-lola/nikit/repos/Megatron-DeepSpeed-Microsoft/data/index-cache/3e541422cadca564d1c62edd2b40c688_sample_idx.npy
[default0]: > loading shuffle-idx mapping from /scratch/hpc-prf-lola/nikit/repos/Megatron-DeepSpeed-Microsoft/data/index-cache/3e541422cadca564d1c62edd2b40c688_shuffle_idx.npy
[default0]:    loaded indexed file in 0.069 seconds
[default0]:    total number of samples: 439466004
[default0]:    total number of epochs: 30909
[default0]: > loading doc-idx mapping from /scratch/hpc-prf-lola/nikit/repos/Megatron-DeepSpeed-Microsoft/data/index-cache/e3555f227ec98db13f639e1775e56895_doc_idx.npy
[default0]: > loading sample-idx mapping from /scratch/hpc-prf-lola/nikit/repos/Megatron-DeepSpeed-Microsoft/data/index-cache/e3555f227ec98db13f639e1775e56895_sample_idx.npy
[default0]: > loading shuffle-idx mapping from /scratch/hpc-prf-lola/nikit/repos/Megatron-DeepSpeed-Microsoft/data/index-cache/e3555f227ec98db13f639e1775e56895_shuffle_idx.npy
[default0]:    loaded indexed file in 0.091 seconds
[default0]:    total number of samples: 219726809
[default0]:    total number of epochs: 648115
[default0]:> finished creating GPT datasets ...
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Channel 00/32 :    0
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Channel 01/32 :    0
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Channel 02/32 :    0
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Channel 03/32 :    0
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Channel 04/32 :    0
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Channel 05/32 :    0
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Channel 06/32 :    0
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Channel 07/32 :    0
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Channel 08/32 :    0
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Channel 09/32 :    0
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Channel 10/32 :    0
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Channel 11/32 :    0
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Channel 12/32 :    0
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Channel 13/32 :    0
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Channel 14/32 :    0
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Channel 15/32 :    0
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Channel 16/32 :    0
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Channel 17/32 :    0
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Channel 18/32 :    0
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Channel 19/32 :    0
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Channel 20/32 :    0
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Channel 21/32 :    0
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Channel 22/32 :    0
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Channel 23/32 :    0
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Channel 24/32 :    0
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Channel 25/32 :    0
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Channel 26/32 :    0
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Channel 27/32 :    0
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Channel 28/32 :    0
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Channel 29/32 :    0
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Channel 30/32 :    0
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Channel 31/32 :    0
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Trees [0] -1/-1/-1->0->-1 [1] -1/-1/-1->0->-1 [2] -1/-1/-1->0->-1 [3] -1/-1/-1->0->-1 [4] -1/-1/-1->0->-1 [5] -1/-1/-1->0->-1 [6] -1/-1/-1->0->-1 [7] -1/-1/-1->0->-1 [8] -1/-1/-1->0->-1 [9] -1/-1/-1->0->-1 [10] -1/-1/-1->0->-1 [11] -1/-1/-1->0->-1 [12] -1/-1/-1->0->-1 [13] -1/-1/-1->0->-1 [14] -1/-1/-1->0->-1 [15] -1/-1/-1->0->-1 [16] -1/-1/-1->0->-1 [17] -1/-1/-1->0->-1 [18] -1/-1/-1->0->-1 [19] -1/-1/-1->0->-1 [20] -1/-1/-1->0->-1 [21] -1/-1/-1->0->-1 [22] -1/-1/-1->0->-1 [23] -1/-1/-1->0->-1 [24] -1/-1/-1->0->-1 [25] -1/-1/-1->0->-1 [26] -1/-1/-1->0->-1 [27] -1/-1/-1->0->-1 [28] -1/-1/-1->0->-1 [29] -1/-1/-1->0->-1 [30] -1/-1/-1->0->-1 [31] -1/-1/-1->0->-1
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Connected all rings
[default0]:n2dgx01:852351:852658 [0] NCCL INFO Connected all trees
[default0]:n2dgx01:852351:852658 [0] NCCL INFO 32 coll channels, 32 p2p channels, 32 p2p channels per peer
[default0]:n2dgx01:852351:852658 [0] NCCL INFO comm 0x149c202d9d00 rank 0 nranks 1 cudaDev 0 busId 7000 - Init COMPLETE
[default0]:[after dataloaders are built] datetime: 2023-09-01 14:23:14 
[default0]:done with setup ...
[default0]:(min, max) time across ranks (ms):
[default0]:    model-and-optimizer-setup ......................: (4948.82, 4948.82)
[default0]:    train/valid/test-data-iterators-setup ..........: (1788.82, 1788.82)
[default0]:training ...
[default0]:[before the start of training step] datetime: 2023-09-01 14:23:14 
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Channel 00/32 :    0
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Channel 01/32 :    0
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Channel 02/32 :    0
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Channel 03/32 :    0
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Channel 04/32 :    0
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Channel 05/32 :    0
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Channel 06/32 :    0
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Channel 07/32 :    0
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Channel 08/32 :    0
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Channel 09/32 :    0
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Channel 10/32 :    0
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Channel 11/32 :    0
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Channel 12/32 :    0
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Channel 13/32 :    0
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Channel 14/32 :    0
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Channel 15/32 :    0
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Channel 16/32 :    0
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Channel 17/32 :    0
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Channel 18/32 :    0
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Channel 19/32 :    0
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Channel 20/32 :    0
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Channel 21/32 :    0
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Channel 22/32 :    0
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Channel 23/32 :    0
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Channel 24/32 :    0
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Channel 25/32 :    0
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Channel 26/32 :    0
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Channel 27/32 :    0
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Channel 28/32 :    0
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Channel 29/32 :    0
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Channel 30/32 :    0
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Channel 31/32 :    0
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Trees [0] -1/-1/-1->0->-1 [1] -1/-1/-1->0->-1 [2] -1/-1/-1->0->-1 [3] -1/-1/-1->0->-1 [4] -1/-1/-1->0->-1 [5] -1/-1/-1->0->-1 [6] -1/-1/-1->0->-1 [7] -1/-1/-1->0->-1 [8] -1/-1/-1->0->-1 [9] -1/-1/-1->0->-1 [10] -1/-1/-1->0->-1 [11] -1/-1/-1->0->-1 [12] -1/-1/-1->0->-1 [13] -1/-1/-1->0->-1 [14] -1/-1/-1->0->-1 [15] -1/-1/-1->0->-1 [16] -1/-1/-1->0->-1 [17] -1/-1/-1->0->-1 [18] -1/-1/-1->0->-1 [19] -1/-1/-1->0->-1 [20] -1/-1/-1->0->-1 [21] -1/-1/-1->0->-1 [22] -1/-1/-1->0->-1 [23] -1/-1/-1->0->-1 [24] -1/-1/-1->0->-1 [25] -1/-1/-1->0->-1 [26] -1/-1/-1->0->-1 [27] -1/-1/-1->0->-1 [28] -1/-1/-1->0->-1 [29] -1/-1/-1->0->-1 [30] -1/-1/-1->0->-1 [31] -1/-1/-1->0->-1
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Connected all rings
[default0]:n2dgx01:852351:852663 [0] NCCL INFO Connected all trees
[default0]:n2dgx01:852351:852663 [0] NCCL INFO 32 coll channels, 32 p2p channels, 32 p2p channels per peer
[default0]:n2dgx01:852351:852663 [0] NCCL INFO comm 0x149a000090d0 rank 0 nranks 1 cudaDev 0 busId 7000 - Init COMPLETE
[default0]:n2dgx01:852351:852351 [0] NCCL INFO Launch mode Parallel
[default0]:[2023-09-01 14:23:19,753] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.50 | optimizer_gradients: 22.26 | optimizer_step: 41.50
[default0]:[2023-09-01 14:23:19,754] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 2605.15 | bwd_microstep: 1993.87 | bwd_inner_microstep: 1984.05 | bwd_allreduce_microstep: 9.71 | step_microstep: 167.13
[default0]:[2023-09-01 14:23:19,754] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 2605.15 (fwd_moe: 301.81, 1st_a2a: 2.94, 2nd_a2a: 2.73, top_k: 99.94)
[default0]:[2023-09-01 14:23:19,754] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1993.87 | bwd_inner: 1984.05 | bwd_allreduce: 9.71 | step: 167.13
[default0]:[2023-09-01 14:23:22,021] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.49 | optimizer_gradients: 22.20 | optimizer_step: 41.46
[default0]:[2023-09-01 14:23:22,021] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.80 | bwd_microstep: 1293.51 | bwd_inner_microstep: 1283.89 | bwd_allreduce_microstep: 9.51 | step_microstep: 166.39
[default0]:[2023-09-01 14:23:22,021] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.79 (fwd_moe: 291.47, 1st_a2a: 2.79, 2nd_a2a: 2.66, top_k: 99.73)
[default0]:[2023-09-01 14:23:22,022] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1293.51 | bwd_inner: 1283.90 | bwd_allreduce: 9.51 | step: 166.40
[default0]:[2023-09-01 14:23:24,319] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.48 | optimizer_gradients: 22.20 | optimizer_step: 41.48
[default0]:[2023-09-01 14:23:24,320] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.18 | bwd_microstep: 1296.31 | bwd_inner_microstep: 1286.60 | bwd_allreduce_microstep: 9.60 | step_microstep: 166.38
[default0]:[2023-09-01 14:23:24,320] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.18 (fwd_moe: 291.06, 1st_a2a: 2.78, 2nd_a2a: 2.78, top_k: 99.56)
[default0]:[2023-09-01 14:23:24,320] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1296.31 | bwd_inner: 1286.60 | bwd_allreduce: 9.60 | step: 166.39
[default0]:[2023-09-01 14:23:26,687] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.48 | optimizer_gradients: 22.68 | optimizer_step: 41.45
[default0]:[2023-09-01 14:23:26,687] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.24 | bwd_microstep: 1295.21 | bwd_inner_microstep: 1285.55 | bwd_allreduce_microstep: 9.55 | step_microstep: 168.00
[default0]:[2023-09-01 14:23:26,687] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.25 (fwd_moe: 290.90, 1st_a2a: 2.81, 2nd_a2a: 2.69, top_k: 99.79)
[default0]:[2023-09-01 14:23:26,687] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1295.21 | bwd_inner: 1285.56 | bwd_allreduce: 9.55 | step: 168.00
[default0]:[2023-09-01 14:23:28,918] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.49 | optimizer_gradients: 22.23 | optimizer_step: 41.52
[default0]:[2023-09-01 14:23:28,918] [INFO] [logging.py:96:log_dist] [Rank 0] step=5, skipped=0, lr=[3.4952533333333334e-08, 3.4952533333333334e-08, 3.4952533333333334e-08, 3.4952533333333334e-08, 3.4952533333333334e-08, 3.4952533333333334e-08, 3.4952533333333334e-08, 3.4952533333333334e-08, 3.4952533333333334e-08], mom=[(0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95)]
[default0]:[2023-09-01 14:23:28,919] [INFO] [timer.py:260:stop] epoch=0/micro_step=5/global_step=5, RunningAvgSamplesPerSec=3.890433429794836, CurrSamplesPerSec=3.890883200794076, MemAllocated=20.91GB, MaxMemAllocated=31.29GB
[default0]:[2023-09-01 14:23:28,919] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 593.11 | bwd_microstep: 1294.94 | bwd_inner_microstep: 1285.34 | bwd_allreduce_microstep: 9.49 | step_microstep: 167.05
[default0]:[2023-09-01 14:23:28,919] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 593.12 (fwd_moe: 290.89, 1st_a2a: 2.78, 2nd_a2a: 2.67, top_k: 99.77)
[default0]:[2023-09-01 14:23:28,919] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1294.94 | bwd_inner: 1285.34 | bwd_allreduce: 9.49 | step: 167.05
[default0]: iteration        5/54931640 | consumed samples:           40 | consumed tokens:        81920 | elapsed time per iteration (ms): 2813.7 | learning rate: 3.495E-08 | global batch size:     8 | lm loss: 1.090870E+01 | moe loss: 1.422844E-01 | loss scale: 2048.0 | actual seqlen:  2048 | number of skipped iterations:   0 | number of nan iterations:   0 | samples per second: 2.843 | TFLOPs: 41.39 |
[default0]:[Rank 0] (after 5 iterations) memory (MB) | allocated: 21408.14111328125 | max allocated: 32045.587890625 | reserved: 35672.0 | max reserved: 35672.0
[default0]:[2023-09-01 14:23:31,205] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.49 | optimizer_gradients: 22.21 | optimizer_step: 41.45
[default0]:[2023-09-01 14:23:31,206] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.94 | bwd_microstep: 1291.84 | bwd_inner_microstep: 1282.29 | bwd_allreduce_microstep: 9.45 | step_microstep: 166.20
[default0]:[2023-09-01 14:23:31,206] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.94 (fwd_moe: 290.64, 1st_a2a: 2.80, 2nd_a2a: 2.65, top_k: 99.80)
[default0]:[2023-09-01 14:23:31,206] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1291.84 | bwd_inner: 1282.29 | bwd_allreduce: 9.45 | step: 166.20
[default0]:[2023-09-01 14:23:33,459] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.50 | optimizer_gradients: 22.31 | optimizer_step: 41.42
[default0]:[2023-09-01 14:23:33,459] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 590.99 | bwd_microstep: 1292.93 | bwd_inner_microstep: 1283.23 | bwd_allreduce_microstep: 9.60 | step_microstep: 166.91
[default0]:[2023-09-01 14:23:33,460] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 590.99 (fwd_moe: 290.50, 1st_a2a: 2.80, 2nd_a2a: 2.66, top_k: 99.40)
[default0]:[2023-09-01 14:23:33,460] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1292.93 | bwd_inner: 1283.23 | bwd_allreduce: 9.60 | step: 166.92
[default0]:[2023-09-01 14:23:35,712] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.47 | optimizer_gradients: 22.20 | optimizer_step: 41.43
[default0]:[2023-09-01 14:23:35,712] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.78 | bwd_microstep: 1291.77 | bwd_inner_microstep: 1282.15 | bwd_allreduce_microstep: 9.51 | step_microstep: 166.04
[default0]:[2023-09-01 14:23:35,712] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.78 (fwd_moe: 290.09, 1st_a2a: 2.78, 2nd_a2a: 2.72, top_k: 99.41)
[default0]:[2023-09-01 14:23:35,712] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1291.76 | bwd_inner: 1282.16 | bwd_allreduce: 9.51 | step: 166.04
[default0]:[2023-09-01 14:23:37,975] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.52 | optimizer_gradients: 22.30 | optimizer_step: 41.45
[default0]:[2023-09-01 14:23:37,976] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.21 | bwd_microstep: 1296.01 | bwd_inner_microstep: 1286.19 | bwd_allreduce_microstep: 9.71 | step_microstep: 167.44
[default0]:[2023-09-01 14:23:37,976] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.21 (fwd_moe: 291.24, 1st_a2a: 2.80, 2nd_a2a: 2.71, top_k: 99.54)
[default0]:[2023-09-01 14:23:37,976] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1296.01 | bwd_inner: 1286.19 | bwd_allreduce: 9.68 | step: 167.44
[default0]:[2023-09-01 14:23:40,302] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.51 | optimizer_gradients: 22.21 | optimizer_step: 41.40
[default0]:[2023-09-01 14:23:40,303] [INFO] [logging.py:96:log_dist] [Rank 0] step=10, skipped=0, lr=[7.864320000000001e-08, 7.864320000000001e-08, 7.864320000000001e-08, 7.864320000000001e-08, 7.864320000000001e-08, 7.864320000000001e-08, 7.864320000000001e-08, 7.864320000000001e-08, 7.864320000000001e-08], mom=[(0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95)]
[default0]:[2023-09-01 14:23:40,303] [INFO] [timer.py:260:stop] epoch=0/micro_step=10/global_step=10, RunningAvgSamplesPerSec=3.894401326126741, CurrSamplesPerSec=3.8934909429984668, MemAllocated=20.91GB, MaxMemAllocated=31.29GB
[default0]:[2023-09-01 14:23:40,303] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 594.32 | bwd_microstep: 1292.47 | bwd_inner_microstep: 1282.89 | bwd_allreduce_microstep: 9.48 | step_microstep: 166.96
[default0]:[2023-09-01 14:23:40,303] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 594.32 (fwd_moe: 290.19, 1st_a2a: 2.76, 2nd_a2a: 2.66, top_k: 99.46)
[default0]:[2023-09-01 14:23:40,304] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1292.47 | bwd_inner: 1282.90 | bwd_allreduce: 9.48 | step: 166.96
[default0]: iteration       10/54931640 | consumed samples:           80 | consumed tokens:       163840 | elapsed time per iteration (ms): 2276.6 | learning rate: 7.864E-08 | global batch size:     8 | lm loss: 1.089862E+01 | moe loss: 1.408551E-01 | loss scale: 2048.0 | actual seqlen:  2048 | number of skipped iterations:   0 | number of nan iterations:   0 | samples per second: 3.514 | TFLOPs: 51.15 |
[default0]:[2023-09-01 14:23:40,553] [INFO] [profiler.py:80:start_profile] Flops profiler started
[default0]:[2023-09-01 14:23:42,677] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.50 | optimizer_gradients: 22.28 | optimizer_step: 41.51
[default0]:
[default0]:-------------------------- DeepSpeed Flops Profiler --------------------------
[default0]:Profile Summary at step 11:
[default0]:Notations:
[default0]:data parallel size (dp_size), model parallel size(mp_size),
[default0]:number of parameters (params), number of multiply-accumulate operations(MACs),
[default0]:number of floating-point operations (flops), floating-point operations per second (FLOPS),
[default0]:fwd latency (forward propagation latency), bwd latency (backward propagation latency),
[default0]:step (weights update latency), iter latency (sum of fwd, bwd and step latency)
[default0]:
[default0]:world size:                                                             1       
[default0]:data parallel size:                                                     1       
[default0]:model parallel size:                                                    1       
[default0]:batch size per GPU:                                                     8       
[default0]:expert tensor parallelism enabled:                                      0       
[default0]:params per GPU:                                                         1.44 B  
[default0]:params of model:                                                        1.44 B  
[default0]:   non-expert params of model:                                          533.86 M
[default0]:   expert params of model:                                              906.34 M
[default0]:fwd MACs per GPU:                                                       14.87 TMACs
[default0]:fwd flops per GPU:                                                      49.55 T 
[default0]:fwd flops of model = fwd flops per GPU * mp_size:                       49.55 T 
[default0]:fwd latency:                                                            614.04 ms
[default0]:fwd FLOPS per GPU = fwd flops per GPU / fwd latency:                    80.7 TFLOPS
[default0]:bwd latency:                                                            1.29 s  
[default0]:bwd FLOPS per GPU = 2 * fwd flops per GPU / bwd latency:                76.55 TFLOPS
[default0]:fwd+bwd FLOPS per GPU = 3 * fwd flops per GPU / (fwd+bwd latency):      77.89 TFLOPS
[default0]:step latency:                                                           166.46 ms
[default0]:iter latency:                                                           2.08 s  
[default0]:FLOPS per GPU = 3 * fwd flops per GPU / iter latency:                   71.64 TFLOPS
[default0]:samples/second:                                                         3.86    
[default0]:
[default0]:----------------------------- Aggregated Profile per GPU -----------------------------
[default0]:Top 1 modules in terms of params, MACs or fwd latency at different model depths:
[default0]:depth 0:
[default0]:    params      - {'GPTModel': '1.44 B'}
[default0]:    MACs        - {'GPTModel': '14.87 TMACs'}
[default0]:    fwd latency - {'GPTModel': '613.94 ms'}
[default0]:depth 1:
[default0]:    params      - {'TransformerLanguageModel': '1.44 B'}
[default0]:    MACs        - {'TransformerLanguageModel': '13.61 TMACs'}
[default0]:    fwd latency - {'TransformerLanguageModel': '580.15 ms'}
[default0]:depth 2:
[default0]:    params      - {'ParallelTransformer': '1.36 B'}
[default0]:    MACs        - {'ParallelTransformer': '13.61 TMACs'}
[default0]:    fwd latency - {'ParallelTransformer': '578.83 ms'}
[default0]:depth 3:
[default0]:    params      - {'ModuleList': '1.36 B'}
[default0]:    MACs        - {'ModuleList': '13.61 TMACs'}
[default0]:    fwd latency - {'ModuleList': '577.1 ms'}
[default0]:depth 4:
[default0]:    params      - {'ParallelTransformerLayer': '1.36 B'}
[default0]:    MACs        - {'ParallelTransformerLayer': '13.61 TMACs'}
[default0]:    fwd latency - {'ParallelTransformerLayer': '577.1 ms'}
[default0]:depth 5:
[default0]:    params      - {'MoE': '906.41 M'}
[default0]:    MACs        - {'ParallelAttention': '6.18 TMACs'}
[default0]:    fwd latency - {'MoE': '302.72 ms'}
[default0]:depth 6:
[default0]:    params      - {'MOELayer': '906.41 M'}
[default0]:    MACs        - {'ColumnParallelLinear': '4.64 TMACs'}
[default0]:    fwd latency - {'MOELayer': '302.26 ms'}
[default0]:depth 7:
[default0]:    params      - {'Experts': '906.34 M'}
[default0]:    MACs        - {'Experts': '3.71 TMACs'}
[default0]:    fwd latency - {'TopKGate': '102.7 ms'}
[default0]:depth 8:
[default0]:    params      - {'ModuleList': '906.34 M'}
[default0]:    MACs        - {'ModuleList': '3.71 TMACs'}
[default0]:    fwd latency - {'ModuleList': '65.88 ms'}
[default0]:depth 9:
[default0]:    params      - {'ParallelMLP': '906.34 M'}
[default0]:    MACs        - {'ParallelMLP': '3.71 TMACs'}
[default0]:    fwd latency - {'ParallelMLP': '65.88 ms'}
[default0]:
[default0]:------------------------------ Detailed Profile per GPU ------------------------------
[default0]:Each module profile is listed after its name in the following order: 
[default0]:params, percentage of total params, MACs, percentage of total MACs, fwd latency, percentage of total fwd latency, fwd FLOPS
[default0]:
[default0]:Note: 1. A module can have torch.nn.module or torch.nn.functional to compute logits (e.g. CrossEntropyLoss). They are not counted as submodules, thus not to be printed out. However they make up the difference between a parent's MACs (or latency) and the sum of its submodules'.
[default0]:2. Number of floating-point operations is a theoretical estimation, thus FLOPS computed using that could be larger than the maximum system throughput.
[default0]:3. The fwd latency listed in the top module's profile is directly captured at the module forward function in PyTorch, thus it's less than the fwd latency shown above which is captured in DeepSpeed.
[default0]:
[default0]:GPTModel(
[default0]:  1.44 B = 100% Params, 14.87 TMACs = 100% MACs, 613.94 ms = 100% latency, 80.71 TFLOPS
[default0]:  (language_model): TransformerLanguageModel(
[default0]:    1.44 B = 100% Params, 13.61 TMACs = 91.49% MACs, 580.15 ms = 94.5% latency, 81.05 TFLOPS
[default0]:    (embedding): Embedding(
[default0]:      80.41 M = 5.58% Params, 0 MACs = 0% MACs, 1.26 ms = 0.21% latency, 0 FLOPS
[default0]:      (word_embeddings): VocabParallelEmbedding(77.27 M = 5.37% Params, 0 MACs = 0% MACs, 390.29 us = 0.06% latency, 0 FLOPS)
[default0]:      (position_embeddings): Embedding(3.15 M = 0.22% Params, 0 MACs = 0% MACs, 341.42 us = 0.06% latency, 0 FLOPS, 2048, 1536)
[default0]:      (embedding_dropout): Dropout(0 = 0% Params, 0 MACs = 0% MACs, 170.47 us = 0.03% latency, 0 FLOPS, p=0.1, inplace=False)
[default0]:    )
[default0]:    (encoder): ParallelTransformer(
[default0]:      1.36 B = 94.42% Params, 13.61 TMACs = 91.49% MACs, 578.83 ms = 94.28% latency, 81.24 TFLOPS
[default0]:      (layers): ModuleList(
[default0]:        1.36 B = 94.42% Params, 13.61 TMACs = 91.49% MACs, 577.1 ms = 94% latency, 81.48 TFLOPS
[default0]:        (0): ParallelTransformerLayer(
[default0]:          28.33 M = 1.97% Params, 566.94 GMACs = 3.81% MACs, 13.87 ms = 2.26% latency, 81.79 TFLOPS
[default0]:          (input_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 185.25 us = 0.03% latency, 0 FLOPS)
[default0]:          (self_attention): ParallelAttention(
[default0]:            9.44 M = 0.66% Params, 257.7 GMACs = 1.73% MACs, 8.42 ms = 1.37% latency, 61.25 TFLOPS
[default0]:            (query_key_value): ColumnParallelLinear(7.08 M = 0.49% Params, 115.96 GMACs = 0.78% MACs, 1.5 ms = 0.24% latency, 154.73 TFLOPS)
[default0]:            (core_attention): CoreAttention(
[default0]:              0 = 0% Params, 103.08 GMACs = 0.69% MACs, 6.36 ms = 1.04% latency, 32.48 TFLOPS
[default0]:              (scale_mask_softmax): FusedScaleMaskSoftmax(0 = 0% Params, 0 MACs = 0% MACs, 1.45 ms = 0.24% latency, 0 FLOPS)
[default0]:              (attention_dropout): Dropout(0 = 0% Params, 0 MACs = 0% MACs, 2.39 ms = 0.39% latency, 0 FLOPS, p=0.1, inplace=False)
[default0]:            )
[default0]:            (dense): RowParallelLinear(2.36 M = 0.16% Params, 38.65 GMACs = 0.26% MACs, 460.15 us = 0.07% latency, 168.01 TFLOPS)
[default0]:          )
[default0]:          (post_attention_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 163.79 us = 0.03% latency, 0 FLOPS)
[default0]:          (mlp): ParallelMLP(
[default0]:            18.88 M = 1.31% Params, 309.24 GMACs = 2.08% MACs, 4.42 ms = 0.72% latency, 139.93 TFLOPS
[default0]:            (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 154.62 GMACs = 1.04% MACs, 1.4 ms = 0.23% latency, 220.14 TFLOPS)
[default0]:            (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 154.62 GMACs = 1.04% MACs, 1.4 ms = 0.23% latency, 220.81 TFLOPS)
[default0]:          )
[default0]:        )
[default0]:        (1): ParallelTransformerLayer(
[default0]:          84.98 M = 5.9% Params, 567.04 GMACs = 3.81% MACs, 34.96 ms = 5.69% latency, 79.63 TFLOPS
[default0]:          (input_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 163.79 us = 0.03% latency, 0 FLOPS)
[default0]:          (self_attention): ParallelAttention(
[default0]:            9.44 M = 0.66% Params, 257.7 GMACs = 1.73% MACs, 8.24 ms = 1.34% latency, 62.59 TFLOPS
[default0]:            (query_key_value): ColumnParallelLinear(7.08 M = 0.49% Params, 115.96 GMACs = 0.78% MACs, 1.44 ms = 0.23% latency, 161.56 TFLOPS)
[default0]:            (core_attention): CoreAttention(
[default0]:              0 = 0% Params, 103.08 GMACs = 0.69% MACs, 6.26 ms = 1.02% latency, 33.01 TFLOPS
[default0]:              (scale_mask_softmax): FusedScaleMaskSoftmax(0 = 0% Params, 0 MACs = 0% MACs, 1.43 ms = 0.23% latency, 0 FLOPS)
[default0]:              (attention_dropout): Dropout(0 = 0% Params, 0 MACs = 0% MACs, 2.39 ms = 0.39% latency, 0 FLOPS, p=0.1, inplace=False)
[default0]:            )
[default0]:            (dense): RowParallelLinear(2.36 M = 0.16% Params, 38.65 GMACs = 0.26% MACs, 453.95 us = 0.07% latency, 170.3 TFLOPS)
[default0]:          )
[default0]:          (post_attention_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 162.36 us = 0.03% latency, 0 FLOPS)
[default0]:          (mlp): MoE(
[default0]:            75.53 M = 5.24% Params, 309.34 GMACs = 2.08% MACs, 25.64 ms = 4.18% latency, 88.45 TFLOPS
[default0]:            (deepspeed_moe): MOELayer(
[default0]:              75.53 M = 5.24% Params, 309.34 GMACs = 2.08% MACs, 25.6 ms = 4.17% latency, 88.58 TFLOPS
[default0]:              (gate): TopKGate(
[default0]:                6.14 K = 0% Params, 100.66 MMACs = 0% MACs, 8.87 ms = 1.44% latency, 52.96 GFLOPS
[default0]:                (wg): Linear(6.14 K = 0% Params, 100.66 MMACs = 0% MACs, 232.22 us = 0.04% latency, 866.97 GFLOPS, in_features=1536, out_features=4, bias=False)
[default0]:              )
[default0]:              (experts): Experts(
[default0]:                75.53 M = 5.24% Params, 309.24 GMACs = 2.08% MACs, 5.74 ms = 0.94% latency, 107.67 TFLOPS
[default0]:                (deepspeed_experts): ModuleList(
[default0]:                  75.53 M = 5.24% Params, 309.24 GMACs = 2.08% MACs, 5.5 ms = 0.9% latency, 112.51 TFLOPS
[default0]:                  (0): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.4 ms = 0.23% latency, 110.35 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 450.85 us = 0.07% latency, 171.47 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 441.31 us = 0.07% latency, 175.18 TFLOPS)
[default0]:                  )
[default0]:                  (1): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.37 ms = 0.22% latency, 112.96 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 437.02 us = 0.07% latency, 176.9 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 435.83 us = 0.07% latency, 177.38 TFLOPS)
[default0]:                  )
[default0]:                  (2): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.36 ms = 0.22% latency, 113.38 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 436.78 us = 0.07% latency, 177 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 433.92 us = 0.07% latency, 178.16 TFLOPS)
[default0]:                  )
[default0]:                  (3): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.36 ms = 0.22% latency, 113.42 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 437.02 us = 0.07% latency, 176.9 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 435.11 us = 0.07% latency, 177.68 TFLOPS)
[default0]:                  )
[default0]:                )
[default0]:              )
[default0]:            )
[default0]:          )
[default0]:        )
[default0]:        (2): ParallelTransformerLayer(
[default0]:          28.33 M = 1.97% Params, 566.94 GMACs = 3.81% MACs, 13.66 ms = 2.23% latency, 83.02 TFLOPS
[default0]:          (input_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 164.03 us = 0.03% latency, 0 FLOPS)
[default0]:          (self_attention): ParallelAttention(
[default0]:            9.44 M = 0.66% Params, 257.7 GMACs = 1.73% MACs, 8.24 ms = 1.34% latency, 62.6 TFLOPS
[default0]:            (query_key_value): ColumnParallelLinear(7.08 M = 0.49% Params, 115.96 GMACs = 0.78% MACs, 1.43 ms = 0.23% latency, 162.67 TFLOPS)
[default0]:            (core_attention): CoreAttention(
[default0]:              0 = 0% Params, 103.08 GMACs = 0.69% MACs, 6.27 ms = 1.02% latency, 32.96 TFLOPS
[default0]:              (scale_mask_softmax): FusedScaleMaskSoftmax(0 = 0% Params, 0 MACs = 0% MACs, 1.42 ms = 0.23% latency, 0 FLOPS)
[default0]:              (attention_dropout): Dropout(0 = 0% Params, 0 MACs = 0% MACs, 2.4 ms = 0.39% latency, 0 FLOPS, p=0.1, inplace=False)
[default0]:            )
[default0]:            (dense): RowParallelLinear(2.36 M = 0.16% Params, 38.65 GMACs = 0.26% MACs, 453.95 us = 0.07% latency, 170.3 TFLOPS)
[default0]:          )
[default0]:          (post_attention_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 161.41 us = 0.03% latency, 0 FLOPS)
[default0]:          (mlp): ParallelMLP(
[default0]:            18.88 M = 1.31% Params, 309.24 GMACs = 2.08% MACs, 4.48 ms = 0.73% latency, 138 TFLOPS
[default0]:            (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 154.62 GMACs = 1.04% MACs, 1.48 ms = 0.24% latency, 209.3 TFLOPS)
[default0]:            (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 154.62 GMACs = 1.04% MACs, 1.39 ms = 0.23% latency, 221.68 TFLOPS)
[default0]:          )
[default0]:        )
[default0]:        (3): ParallelTransformerLayer(
[default0]:          84.98 M = 5.9% Params, 567.04 GMACs = 3.81% MACs, 34.59 ms = 5.63% latency, 80.48 TFLOPS
[default0]:          (input_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 161.65 us = 0.03% latency, 0 FLOPS)
[default0]:          (self_attention): ParallelAttention(
[default0]:            9.44 M = 0.66% Params, 257.7 GMACs = 1.73% MACs, 8.25 ms = 1.34% latency, 62.55 TFLOPS
[default0]:            (query_key_value): ColumnParallelLinear(7.08 M = 0.49% Params, 115.96 GMACs = 0.78% MACs, 1.43 ms = 0.23% latency, 162.67 TFLOPS)
[default0]:            (core_attention): CoreAttention(
[default0]:              0 = 0% Params, 103.08 GMACs = 0.69% MACs, 6.27 ms = 1.02% latency, 32.95 TFLOPS
[default0]:              (scale_mask_softmax): FusedScaleMaskSoftmax(0 = 0% Params, 0 MACs = 0% MACs, 1.42 ms = 0.23% latency, 0 FLOPS)
[default0]:              (attention_dropout): Dropout(0 = 0% Params, 0 MACs = 0% MACs, 2.41 ms = 0.39% latency, 0 FLOPS, p=0.1, inplace=False)
[default0]:            )
[default0]:            (dense): RowParallelLinear(2.36 M = 0.16% Params, 38.65 GMACs = 0.26% MACs, 453.23 us = 0.07% latency, 170.57 TFLOPS)
[default0]:          )
[default0]:          (post_attention_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 162.12 us = 0.03% latency, 0 FLOPS)
[default0]:          (mlp): MoE(
[default0]:            75.53 M = 5.24% Params, 309.34 GMACs = 2.08% MACs, 25.27 ms = 4.12% latency, 89.74 TFLOPS
[default0]:            (deepspeed_moe): MOELayer(
[default0]:              75.53 M = 5.24% Params, 309.34 GMACs = 2.08% MACs, 25.24 ms = 4.11% latency, 89.87 TFLOPS
[default0]:              (gate): TopKGate(
[default0]:                6.14 K = 0% Params, 100.66 MMACs = 0% MACs, 8.55 ms = 1.39% latency, 54.95 GFLOPS
[default0]:                (wg): Linear(6.14 K = 0% Params, 100.66 MMACs = 0% MACs, 234.84 us = 0.04% latency, 857.28 GFLOPS, in_features=1536, out_features=4, bias=False)
[default0]:              )
[default0]:              (experts): Experts(
[default0]:                75.53 M = 5.24% Params, 309.24 GMACs = 2.08% MACs, 5.8 ms = 0.95% latency, 106.58 TFLOPS
[default0]:                (deepspeed_experts): ModuleList(
[default0]:                  75.53 M = 5.24% Params, 309.24 GMACs = 2.08% MACs, 5.57 ms = 0.91% latency, 111.03 TFLOPS
[default0]:                  (0): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.39 ms = 0.23% latency, 110.91 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 456.33 us = 0.07% latency, 169.41 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 438.21 us = 0.07% latency, 176.42 TFLOPS)
[default0]:                  )
[default0]:                  (1): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.36 ms = 0.22% latency, 113.36 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 436.31 us = 0.07% latency, 177.19 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 435.11 us = 0.07% latency, 177.68 TFLOPS)
[default0]:                  )
[default0]:                  (2): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.43 ms = 0.23% latency, 108.5 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 437.02 us = 0.07% latency, 176.9 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 495.67 us = 0.08% latency, 155.97 TFLOPS)
[default0]:                  )
[default0]:                  (3): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.39 ms = 0.23% latency, 111.47 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 449.66 us = 0.07% latency, 171.93 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 439.64 us = 0.07% latency, 175.85 TFLOPS)
[default0]:                  )
[default0]:                )
[default0]:              )
[default0]:            )
[default0]:          )
[default0]:        )
[default0]:        (4): ParallelTransformerLayer(
[default0]:          28.33 M = 1.97% Params, 566.94 GMACs = 3.81% MACs, 13.56 ms = 2.21% latency, 83.67 TFLOPS
[default0]:          (input_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 162.36 us = 0.03% latency, 0 FLOPS)
[default0]:          (self_attention): ParallelAttention(
[default0]:            9.44 M = 0.66% Params, 257.7 GMACs = 1.73% MACs, 8.22 ms = 1.34% latency, 62.75 TFLOPS
[default0]:            (query_key_value): ColumnParallelLinear(7.08 M = 0.49% Params, 115.96 GMACs = 0.78% MACs, 1.43 ms = 0.23% latency, 162.62 TFLOPS)
[default0]:            (core_attention): CoreAttention(
[default0]:              0 = 0% Params, 103.08 GMACs = 0.69% MACs, 6.25 ms = 1.02% latency, 33.07 TFLOPS
[default0]:              (scale_mask_softmax): FusedScaleMaskSoftmax(0 = 0% Params, 0 MACs = 0% MACs, 1.42 ms = 0.23% latency, 0 FLOPS)
[default0]:              (attention_dropout): Dropout(0 = 0% Params, 0 MACs = 0% MACs, 2.37 ms = 0.39% latency, 0 FLOPS, p=0.1, inplace=False)
[default0]:            )
[default0]:            (dense): RowParallelLinear(2.36 M = 0.16% Params, 38.65 GMACs = 0.26% MACs, 453.47 us = 0.07% latency, 170.48 TFLOPS)
[default0]:          )
[default0]:          (post_attention_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 161.65 us = 0.03% latency, 0 FLOPS)
[default0]:          (mlp): ParallelMLP(
[default0]:            18.88 M = 1.31% Params, 309.24 GMACs = 2.08% MACs, 4.4 ms = 0.72% latency, 140.58 TFLOPS
[default0]:            (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 154.62 GMACs = 1.04% MACs, 1.4 ms = 0.23% latency, 220.36 TFLOPS)
[default0]:            (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 154.62 GMACs = 1.04% MACs, 1.4 ms = 0.23% latency, 221.38 TFLOPS)
[default0]:          )
[default0]:        )
[default0]:        (5): ParallelTransformerLayer(
[default0]:          84.98 M = 5.9% Params, 567.04 GMACs = 3.81% MACs, 34.33 ms = 5.59% latency, 81.09 TFLOPS
[default0]:          (input_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 163.08 us = 0.03% latency, 0 FLOPS)
[default0]:          (self_attention): ParallelAttention(
[default0]:            9.44 M = 0.66% Params, 257.7 GMACs = 1.73% MACs, 8.1 ms = 1.32% latency, 63.66 TFLOPS
[default0]:            (query_key_value): ColumnParallelLinear(7.08 M = 0.49% Params, 115.96 GMACs = 0.78% MACs, 1.42 ms = 0.23% latency, 162.86 TFLOPS)
[default0]:            (core_attention): CoreAttention(
[default0]:              0 = 0% Params, 103.08 GMACs = 0.69% MACs, 6.13 ms = 1% latency, 33.7 TFLOPS
[default0]:              (scale_mask_softmax): FusedScaleMaskSoftmax(0 = 0% Params, 0 MACs = 0% MACs, 1.42 ms = 0.23% latency, 0 FLOPS)
[default0]:              (attention_dropout): Dropout(0 = 0% Params, 0 MACs = 0% MACs, 2.27 ms = 0.37% latency, 0 FLOPS, p=0.1, inplace=False)
[default0]:            )
[default0]:            (dense): RowParallelLinear(2.36 M = 0.16% Params, 38.65 GMACs = 0.26% MACs, 456.57 us = 0.07% latency, 169.33 TFLOPS)
[default0]:          )
[default0]:          (post_attention_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 161.89 us = 0.03% latency, 0 FLOPS)
[default0]:          (mlp): MoE(
[default0]:            75.53 M = 5.24% Params, 309.34 GMACs = 2.08% MACs, 25.16 ms = 4.1% latency, 90.15 TFLOPS
[default0]:            (deepspeed_moe): MOELayer(
[default0]:              75.53 M = 5.24% Params, 309.34 GMACs = 2.08% MACs, 25.12 ms = 4.09% latency, 90.28 TFLOPS
[default0]:              (gate): TopKGate(
[default0]:                6.14 K = 0% Params, 100.66 MMACs = 0% MACs, 8.52 ms = 1.39% latency, 55.17 GFLOPS
[default0]:                (wg): Linear(6.14 K = 0% Params, 100.66 MMACs = 0% MACs, 215.53 us = 0.04% latency, 934.1 GFLOPS, in_features=1536, out_features=4, bias=False)
[default0]:              )
[default0]:              (experts): Experts(
[default0]:                75.53 M = 5.24% Params, 309.24 GMACs = 2.08% MACs, 5.72 ms = 0.93% latency, 108.21 TFLOPS
[default0]:                (deepspeed_experts): ModuleList(
[default0]:                  75.53 M = 5.24% Params, 309.24 GMACs = 2.08% MACs, 5.48 ms = 0.89% latency, 112.85 TFLOPS
[default0]:                  (0): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.38 ms = 0.22% latency, 112.1 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 444.89 us = 0.07% latency, 173.77 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 435.83 us = 0.07% latency, 177.38 TFLOPS)
[default0]:                  )
[default0]:                  (1): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.37 ms = 0.22% latency, 112.63 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 441.31 us = 0.07% latency, 175.18 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 435.35 us = 0.07% latency, 177.58 TFLOPS)
[default0]:                  )
[default0]:                  (2): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.36 ms = 0.22% latency, 113.64 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 433.44 us = 0.07% latency, 178.36 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 435.11 us = 0.07% latency, 177.68 TFLOPS)
[default0]:                  )
[default0]:                  (3): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.37 ms = 0.22% latency, 113.06 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 435.83 us = 0.07% latency, 177.38 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 438.69 us = 0.07% latency, 176.23 TFLOPS)
[default0]:                  )
[default0]:                )
[default0]:              )
[default0]:            )
[default0]:          )
[default0]:        )
[default0]:        (6): ParallelTransformerLayer(
[default0]:          28.33 M = 1.97% Params, 566.94 GMACs = 3.81% MACs, 13.5 ms = 2.2% latency, 84.01 TFLOPS
[default0]:          (input_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 163.08 us = 0.03% latency, 0 FLOPS)
[default0]:          (self_attention): ParallelAttention(
[default0]:            9.44 M = 0.66% Params, 257.7 GMACs = 1.73% MACs, 8.17 ms = 1.33% latency, 63.16 TFLOPS
[default0]:            (query_key_value): ColumnParallelLinear(7.08 M = 0.49% Params, 115.96 GMACs = 0.78% MACs, 1.43 ms = 0.23% latency, 162.62 TFLOPS)
[default0]:            (core_attention): CoreAttention(
[default0]:              0 = 0% Params, 103.08 GMACs = 0.69% MACs, 6.2 ms = 1.01% latency, 33.36 TFLOPS
[default0]:              (scale_mask_softmax): FusedScaleMaskSoftmax(0 = 0% Params, 0 MACs = 0% MACs, 1.42 ms = 0.23% latency, 0 FLOPS)
[default0]:              (attention_dropout): Dropout(0 = 0% Params, 0 MACs = 0% MACs, 2.32 ms = 0.38% latency, 0 FLOPS, p=0.1, inplace=False)
[default0]:            )
[default0]:            (dense): RowParallelLinear(2.36 M = 0.16% Params, 38.65 GMACs = 0.26% MACs, 452.28 us = 0.07% latency, 170.93 TFLOPS)
[default0]:          )
[default0]:          (post_attention_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 162.6 us = 0.03% latency, 0 FLOPS)
[default0]:          (mlp): ParallelMLP(
[default0]:            18.88 M = 1.31% Params, 309.24 GMACs = 2.08% MACs, 4.39 ms = 0.72% latency, 140.78 TFLOPS
[default0]:            (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 154.62 GMACs = 1.04% MACs, 1.4 ms = 0.23% latency, 220.62 TFLOPS)
[default0]:            (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 154.62 GMACs = 1.04% MACs, 1.39 ms = 0.23% latency, 221.87 TFLOPS)
[default0]:          )
[default0]:        )
[default0]:        (7): ParallelTransformerLayer(
[default0]:          84.98 M = 5.9% Params, 567.04 GMACs = 3.81% MACs, 34.45 ms = 5.61% latency, 80.81 TFLOPS
[default0]:          (input_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 162.84 us = 0.03% latency, 0 FLOPS)
[default0]:          (self_attention): ParallelAttention(
[default0]:            9.44 M = 0.66% Params, 257.7 GMACs = 1.73% MACs, 8.2 ms = 1.34% latency, 62.9 TFLOPS
[default0]:            (query_key_value): ColumnParallelLinear(7.08 M = 0.49% Params, 115.96 GMACs = 0.78% MACs, 1.42 ms = 0.23% latency, 163.27 TFLOPS)
[default0]:            (core_attention): CoreAttention(
[default0]:              0 = 0% Params, 103.08 GMACs = 0.69% MACs, 6.24 ms = 1.02% latency, 33.13 TFLOPS
[default0]:              (scale_mask_softmax): FusedScaleMaskSoftmax(0 = 0% Params, 0 MACs = 0% MACs, 1.42 ms = 0.23% latency, 0 FLOPS)
[default0]:              (attention_dropout): Dropout(0 = 0% Params, 0 MACs = 0% MACs, 2.38 ms = 0.39% latency, 0 FLOPS, p=0.1, inplace=False)
[default0]:            )
[default0]:            (dense): RowParallelLinear(2.36 M = 0.16% Params, 38.65 GMACs = 0.26% MACs, 453.95 us = 0.07% latency, 170.3 TFLOPS)
[default0]:          )
[default0]:          (post_attention_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 161.17 us = 0.03% latency, 0 FLOPS)
[default0]:          (mlp): MoE(
[default0]:            75.53 M = 5.24% Params, 309.34 GMACs = 2.08% MACs, 25.18 ms = 4.1% latency, 90.09 TFLOPS
[default0]:            (deepspeed_moe): MOELayer(
[default0]:              75.53 M = 5.24% Params, 309.34 GMACs = 2.08% MACs, 25.14 ms = 4.09% latency, 90.22 TFLOPS
[default0]:              (gate): TopKGate(
[default0]:                6.14 K = 0% Params, 100.66 MMACs = 0% MACs, 8.52 ms = 1.39% latency, 55.13 GFLOPS
[default0]:                (wg): Linear(6.14 K = 0% Params, 100.66 MMACs = 0% MACs, 218.39 us = 0.04% latency, 921.86 GFLOPS, in_features=1536, out_features=4, bias=False)
[default0]:              )
[default0]:              (experts): Experts(
[default0]:                75.53 M = 5.24% Params, 309.24 GMACs = 2.08% MACs, 5.71 ms = 0.93% latency, 108.33 TFLOPS
[default0]:                (deepspeed_experts): ModuleList(
[default0]:                  75.53 M = 5.24% Params, 309.24 GMACs = 2.08% MACs, 5.48 ms = 0.89% latency, 112.88 TFLOPS
[default0]:                  (0): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.39 ms = 0.23% latency, 110.95 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 450.61 us = 0.07% latency, 171.57 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 438.21 us = 0.07% latency, 176.42 TFLOPS)
[default0]:                  )
[default0]:                  (1): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.36 ms = 0.22% latency, 113.34 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 436.07 us = 0.07% latency, 177.29 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 433.68 us = 0.07% latency, 178.26 TFLOPS)
[default0]:                  )
[default0]:                  (2): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.36 ms = 0.22% latency, 113.5 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 433.92 us = 0.07% latency, 178.16 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 436.78 us = 0.07% latency, 177 TFLOPS)
[default0]:                  )
[default0]:                  (3): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.36 ms = 0.22% latency, 113.8 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 431.54 us = 0.07% latency, 179.15 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 432.97 us = 0.07% latency, 178.56 TFLOPS)
[default0]:                  )
[default0]:                )
[default0]:              )
[default0]:            )
[default0]:          )
[default0]:        )
[default0]:        (8): ParallelTransformerLayer(
[default0]:          28.33 M = 1.97% Params, 566.94 GMACs = 3.81% MACs, 13.55 ms = 2.21% latency, 83.72 TFLOPS
[default0]:          (input_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 162.12 us = 0.03% latency, 0 FLOPS)
[default0]:          (self_attention): ParallelAttention(
[default0]:            9.44 M = 0.66% Params, 257.7 GMACs = 1.73% MACs, 8.2 ms = 1.34% latency, 62.94 TFLOPS
[default0]:            (query_key_value): ColumnParallelLinear(7.08 M = 0.49% Params, 115.96 GMACs = 0.78% MACs, 1.43 ms = 0.23% latency, 162.59 TFLOPS)
[default0]:            (core_attention): CoreAttention(
[default0]:              0 = 0% Params, 103.08 GMACs = 0.69% MACs, 6.23 ms = 1.01% latency, 33.2 TFLOPS
[default0]:              (scale_mask_softmax): FusedScaleMaskSoftmax(0 = 0% Params, 0 MACs = 0% MACs, 1.42 ms = 0.23% latency, 0 FLOPS)
[default0]:              (attention_dropout): Dropout(0 = 0% Params, 0 MACs = 0% MACs, 2.36 ms = 0.38% latency, 0 FLOPS, p=0.1, inplace=False)
[default0]:            )
[default0]:            (dense): RowParallelLinear(2.36 M = 0.16% Params, 38.65 GMACs = 0.26% MACs, 452.28 us = 0.07% latency, 170.93 TFLOPS)
[default0]:          )
[default0]:          (post_attention_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 163.32 us = 0.03% latency, 0 FLOPS)
[default0]:          (mlp): ParallelMLP(
[default0]:            18.88 M = 1.31% Params, 309.24 GMACs = 2.08% MACs, 4.41 ms = 0.72% latency, 140.11 TFLOPS
[default0]:            (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 154.62 GMACs = 1.04% MACs, 1.4 ms = 0.23% latency, 220.51 TFLOPS)
[default0]:            (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 154.62 GMACs = 1.04% MACs, 1.4 ms = 0.23% latency, 220.47 TFLOPS)
[default0]:          )
[default0]:        )
[default0]:        (9): ParallelTransformerLayer(
[default0]:          84.98 M = 5.9% Params, 567.04 GMACs = 3.81% MACs, 34.43 ms = 5.61% latency, 80.86 TFLOPS
[default0]:          (input_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 163.08 us = 0.03% latency, 0 FLOPS)
[default0]:          (self_attention): ParallelAttention(
[default0]:            9.44 M = 0.66% Params, 257.7 GMACs = 1.73% MACs, 8.21 ms = 1.34% latency, 62.83 TFLOPS
[default0]:            (query_key_value): ColumnParallelLinear(7.08 M = 0.49% Params, 115.96 GMACs = 0.78% MACs, 1.42 ms = 0.23% latency, 163.05 TFLOPS)
[default0]:            (core_attention): CoreAttention(
[default0]:              0 = 0% Params, 103.08 GMACs = 0.69% MACs, 6.23 ms = 1.02% latency, 33.16 TFLOPS
[default0]:              (scale_mask_softmax): FusedScaleMaskSoftmax(0 = 0% Params, 0 MACs = 0% MACs, 1.42 ms = 0.23% latency, 0 FLOPS)
[default0]:              (attention_dropout): Dropout(0 = 0% Params, 0 MACs = 0% MACs, 2.37 ms = 0.39% latency, 0 FLOPS, p=0.1, inplace=False)
[default0]:            )
[default0]:            (dense): RowParallelLinear(2.36 M = 0.16% Params, 38.65 GMACs = 0.26% MACs, 462.06 us = 0.08% latency, 167.32 TFLOPS)
[default0]:          )
[default0]:          (post_attention_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 161.89 us = 0.03% latency, 0 FLOPS)
[default0]:          (mlp): MoE(
[default0]:            75.53 M = 5.24% Params, 309.34 GMACs = 2.08% MACs, 25.15 ms = 4.1% latency, 90.18 TFLOPS
[default0]:            (deepspeed_moe): MOELayer(
[default0]:              75.53 M = 5.24% Params, 309.34 GMACs = 2.08% MACs, 25.11 ms = 4.09% latency, 90.34 TFLOPS
[default0]:              (gate): TopKGate(
[default0]:                6.14 K = 0% Params, 100.66 MMACs = 0% MACs, 8.51 ms = 1.39% latency, 55.19 GFLOPS
[default0]:                (wg): Linear(6.14 K = 0% Params, 100.66 MMACs = 0% MACs, 215.53 us = 0.04% latency, 934.1 GFLOPS, in_features=1536, out_features=4, bias=False)
[default0]:              )
[default0]:              (experts): Experts(
[default0]:                75.53 M = 5.24% Params, 309.24 GMACs = 2.08% MACs, 5.7 ms = 0.93% latency, 108.59 TFLOPS
[default0]:                (deepspeed_experts): ModuleList(
[default0]:                  75.53 M = 5.24% Params, 309.24 GMACs = 2.08% MACs, 5.46 ms = 0.89% latency, 113.21 TFLOPS
[default0]:                  (0): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.38 ms = 0.22% latency, 112.12 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 442.74 us = 0.07% latency, 174.61 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 436.78 us = 0.07% latency, 177 TFLOPS)
[default0]:                  )
[default0]:                  (1): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.36 ms = 0.22% latency, 114 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 431.06 us = 0.07% latency, 179.35 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 432.25 us = 0.07% latency, 178.85 TFLOPS)
[default0]:                  )
[default0]:                  (2): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.37 ms = 0.22% latency, 113.2 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 435.83 us = 0.07% latency, 177.38 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 434.64 us = 0.07% latency, 177.87 TFLOPS)
[default0]:                  )
[default0]:                  (3): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.36 ms = 0.22% latency, 113.54 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 433.68 us = 0.07% latency, 178.26 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 437.97 us = 0.07% latency, 176.52 TFLOPS)
[default0]:                  )
[default0]:                )
[default0]:              )
[default0]:            )
[default0]:          )
[default0]:        )
[default0]:        (10): ParallelTransformerLayer(
[default0]:          28.33 M = 1.97% Params, 566.94 GMACs = 3.81% MACs, 13.54 ms = 2.21% latency, 83.79 TFLOPS
[default0]:          (input_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 162.12 us = 0.03% latency, 0 FLOPS)
[default0]:          (self_attention): ParallelAttention(
[default0]:            9.44 M = 0.66% Params, 257.7 GMACs = 1.73% MACs, 8.2 ms = 1.34% latency, 62.91 TFLOPS
[default0]:            (query_key_value): ColumnParallelLinear(7.08 M = 0.49% Params, 115.96 GMACs = 0.78% MACs, 1.43 ms = 0.23% latency, 162.56 TFLOPS)
[default0]:            (core_attention): CoreAttention(
[default0]:              0 = 0% Params, 103.08 GMACs = 0.69% MACs, 6.23 ms = 1.01% latency, 33.18 TFLOPS
[default0]:              (scale_mask_softmax): FusedScaleMaskSoftmax(0 = 0% Params, 0 MACs = 0% MACs, 1.42 ms = 0.23% latency, 0 FLOPS)
[default0]:              (attention_dropout): Dropout(0 = 0% Params, 0 MACs = 0% MACs, 2.36 ms = 0.39% latency, 0 FLOPS, p=0.1, inplace=False)
[default0]:            )
[default0]:            (dense): RowParallelLinear(2.36 M = 0.16% Params, 38.65 GMACs = 0.26% MACs, 453 us = 0.07% latency, 170.66 TFLOPS)
[default0]:          )
[default0]:          (post_attention_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 162.12 us = 0.03% latency, 0 FLOPS)
[default0]:          (mlp): ParallelMLP(
[default0]:            18.88 M = 1.31% Params, 309.24 GMACs = 2.08% MACs, 4.4 ms = 0.72% latency, 140.5 TFLOPS
[default0]:            (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 154.62 GMACs = 1.04% MACs, 1.41 ms = 0.23% latency, 220.02 TFLOPS)
[default0]:            (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 154.62 GMACs = 1.04% MACs, 1.4 ms = 0.23% latency, 221.34 TFLOPS)
[default0]:          )
[default0]:        )
[default0]:        (11): ParallelTransformerLayer(
[default0]:          84.98 M = 5.9% Params, 567.04 GMACs = 3.81% MACs, 34.47 ms = 5.61% latency, 80.76 TFLOPS
[default0]:          (input_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 162.12 us = 0.03% latency, 0 FLOPS)
[default0]:          (self_attention): ParallelAttention(
[default0]:            9.44 M = 0.66% Params, 257.7 GMACs = 1.73% MACs, 8.21 ms = 1.34% latency, 62.86 TFLOPS
[default0]:            (query_key_value): ColumnParallelLinear(7.08 M = 0.49% Params, 115.96 GMACs = 0.78% MACs, 1.42 ms = 0.23% latency, 162.97 TFLOPS)
[default0]:            (core_attention): CoreAttention(
[default0]:              0 = 0% Params, 103.08 GMACs = 0.69% MACs, 6.24 ms = 1.02% latency, 33.12 TFLOPS
[default0]:              (scale_mask_softmax): FusedScaleMaskSoftmax(0 = 0% Params, 0 MACs = 0% MACs, 1.42 ms = 0.23% latency, 0 FLOPS)
[default0]:              (attention_dropout): Dropout(0 = 0% Params, 0 MACs = 0% MACs, 2.37 ms = 0.39% latency, 0 FLOPS, p=0.1, inplace=False)
[default0]:            )
[default0]:            (dense): RowParallelLinear(2.36 M = 0.16% Params, 38.65 GMACs = 0.26% MACs, 453.47 us = 0.07% latency, 170.48 TFLOPS)
[default0]:          )
[default0]:          (post_attention_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 169.04 us = 0.03% latency, 0 FLOPS)
[default0]:          (mlp): MoE(
[default0]:            75.53 M = 5.24% Params, 309.34 GMACs = 2.08% MACs, 25.18 ms = 4.1% latency, 90.06 TFLOPS
[default0]:            (deepspeed_moe): MOELayer(
[default0]:              75.53 M = 5.24% Params, 309.34 GMACs = 2.08% MACs, 25.15 ms = 4.1% latency, 90.2 TFLOPS
[default0]:              (gate): TopKGate(
[default0]:                6.14 K = 0% Params, 100.66 MMACs = 0% MACs, 8.52 ms = 1.39% latency, 55.11 GFLOPS
[default0]:                (wg): Linear(6.14 K = 0% Params, 100.66 MMACs = 0% MACs, 215.05 us = 0.04% latency, 936.17 GFLOPS, in_features=1536, out_features=4, bias=False)
[default0]:              )
[default0]:              (experts): Experts(
[default0]:                75.53 M = 5.24% Params, 309.24 GMACs = 2.08% MACs, 5.73 ms = 0.93% latency, 108.01 TFLOPS
[default0]:                (deepspeed_experts): ModuleList(
[default0]:                  75.53 M = 5.24% Params, 309.24 GMACs = 2.08% MACs, 5.49 ms = 0.89% latency, 112.72 TFLOPS
[default0]:                  (0): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.39 ms = 0.23% latency, 111.53 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 450.61 us = 0.07% latency, 171.57 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 437.5 us = 0.07% latency, 176.71 TFLOPS)
[default0]:                  )
[default0]:                  (1): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.37 ms = 0.22% latency, 112.81 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 436.07 us = 0.07% latency, 177.29 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 441.07 us = 0.07% latency, 175.28 TFLOPS)
[default0]:                  )
[default0]:                  (2): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.37 ms = 0.22% latency, 113.02 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 436.31 us = 0.07% latency, 177.19 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 434.4 us = 0.07% latency, 177.97 TFLOPS)
[default0]:                  )
[default0]:                  (3): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.36 ms = 0.22% latency, 113.56 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 431.78 us = 0.07% latency, 179.05 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 433.92 us = 0.07% latency, 178.16 TFLOPS)
[default0]:                  )
[default0]:                )
[default0]:              )
[default0]:            )
[default0]:          )
[default0]:        )
[default0]:        (12): ParallelTransformerLayer(
[default0]:          28.33 M = 1.97% Params, 566.94 GMACs = 3.81% MACs, 13.62 ms = 2.22% latency, 83.31 TFLOPS
[default0]:          (input_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 164.27 us = 0.03% latency, 0 FLOPS)
[default0]:          (self_attention): ParallelAttention(
[default0]:            9.44 M = 0.66% Params, 257.7 GMACs = 1.73% MACs, 8.27 ms = 1.35% latency, 62.36 TFLOPS
[default0]:            (query_key_value): ColumnParallelLinear(7.08 M = 0.49% Params, 115.96 GMACs = 0.78% MACs, 1.44 ms = 0.23% latency, 161.38 TFLOPS)
[default0]:            (core_attention): CoreAttention(
[default0]:              0 = 0% Params, 103.08 GMACs = 0.69% MACs, 6.29 ms = 1.02% latency, 32.87 TFLOPS
[default0]:              (scale_mask_softmax): FusedScaleMaskSoftmax(0 = 0% Params, 0 MACs = 0% MACs, 1.42 ms = 0.23% latency, 0 FLOPS)
[default0]:              (attention_dropout): Dropout(0 = 0% Params, 0 MACs = 0% MACs, 2.41 ms = 0.39% latency, 0 FLOPS, p=0.1, inplace=False)
[default0]:            )
[default0]:            (dense): RowParallelLinear(2.36 M = 0.16% Params, 38.65 GMACs = 0.26% MACs, 453.23 us = 0.07% latency, 170.57 TFLOPS)
[default0]:          )
[default0]:          (post_attention_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 163.08 us = 0.03% latency, 0 FLOPS)
[default0]:          (mlp): ParallelMLP(
[default0]:            18.88 M = 1.31% Params, 309.24 GMACs = 2.08% MACs, 4.4 ms = 0.72% latency, 140.49 TFLOPS
[default0]:            (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 154.62 GMACs = 1.04% MACs, 1.41 ms = 0.23% latency, 220.06 TFLOPS)
[default0]:            (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 154.62 GMACs = 1.04% MACs, 1.4 ms = 0.23% latency, 221.38 TFLOPS)
[default0]:          )
[default0]:        )
[default0]:        (13): ParallelTransformerLayer(
[default0]:          84.98 M = 5.9% Params, 567.04 GMACs = 3.81% MACs, 34.57 ms = 5.63% latency, 80.54 TFLOPS
[default0]:          (input_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 162.36 us = 0.03% latency, 0 FLOPS)
[default0]:          (self_attention): ParallelAttention(
[default0]:            9.44 M = 0.66% Params, 257.7 GMACs = 1.73% MACs, 8.3 ms = 1.35% latency, 62.18 TFLOPS
[default0]:            (query_key_value): ColumnParallelLinear(7.08 M = 0.49% Params, 115.96 GMACs = 0.78% MACs, 1.42 ms = 0.23% latency, 162.78 TFLOPS)
[default0]:            (core_attention): CoreAttention(
[default0]:              0 = 0% Params, 103.08 GMACs = 0.69% MACs, 6.33 ms = 1.03% latency, 32.66 TFLOPS
[default0]:              (scale_mask_softmax): FusedScaleMaskSoftmax(0 = 0% Params, 0 MACs = 0% MACs, 1.42 ms = 0.23% latency, 0 FLOPS)
[default0]:              (attention_dropout): Dropout(0 = 0% Params, 0 MACs = 0% MACs, 2.33 ms = 0.38% latency, 0 FLOPS, p=0.1, inplace=False)
[default0]:            )
[default0]:            (dense): RowParallelLinear(2.36 M = 0.16% Params, 38.65 GMACs = 0.26% MACs, 452.04 us = 0.07% latency, 171.02 TFLOPS)
[default0]:          )
[default0]:          (post_attention_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 163.56 us = 0.03% latency, 0 FLOPS)
[default0]:          (mlp): MoE(
[default0]:            75.53 M = 5.24% Params, 309.34 GMACs = 2.08% MACs, 25.2 ms = 4.1% latency, 90.02 TFLOPS
[default0]:            (deepspeed_moe): MOELayer(
[default0]:              75.53 M = 5.24% Params, 309.34 GMACs = 2.08% MACs, 25.16 ms = 4.1% latency, 90.15 TFLOPS
[default0]:              (gate): TopKGate(
[default0]:                6.14 K = 0% Params, 100.66 MMACs = 0% MACs, 8.54 ms = 1.39% latency, 54.99 GFLOPS
[default0]:                (wg): Linear(6.14 K = 0% Params, 100.66 MMACs = 0% MACs, 215.53 us = 0.04% latency, 934.1 GFLOPS, in_features=1536, out_features=4, bias=False)
[default0]:              )
[default0]:              (experts): Experts(
[default0]:                75.53 M = 5.24% Params, 309.24 GMACs = 2.08% MACs, 5.72 ms = 0.93% latency, 108.14 TFLOPS
[default0]:                (deepspeed_experts): ModuleList(
[default0]:                  75.53 M = 5.24% Params, 309.24 GMACs = 2.08% MACs, 5.48 ms = 0.89% latency, 112.77 TFLOPS
[default0]:                  (0): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.39 ms = 0.23% latency, 111.26 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 445.13 us = 0.07% latency, 173.68 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 443.46 us = 0.07% latency, 174.33 TFLOPS)
[default0]:                  )
[default0]:                  (1): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.37 ms = 0.22% latency, 112.77 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 436.54 us = 0.07% latency, 177.09 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 440.6 us = 0.07% latency, 175.46 TFLOPS)
[default0]:                  )
[default0]:                  (2): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.36 ms = 0.22% latency, 113.38 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 437.02 us = 0.07% latency, 176.9 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 433.92 us = 0.07% latency, 178.16 TFLOPS)
[default0]:                  )
[default0]:                  (3): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.36 ms = 0.22% latency, 113.7 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 436.07 us = 0.07% latency, 177.29 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 434.64 us = 0.07% latency, 177.87 TFLOPS)
[default0]:                  )
[default0]:                )
[default0]:              )
[default0]:            )
[default0]:          )
[default0]:        )
[default0]:        (14): ParallelTransformerLayer(
[default0]:          28.33 M = 1.97% Params, 566.94 GMACs = 3.81% MACs, 13.49 ms = 2.2% latency, 84.08 TFLOPS
[default0]:          (input_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 164.75 us = 0.03% latency, 0 FLOPS)
[default0]:          (self_attention): ParallelAttention(
[default0]:            9.44 M = 0.66% Params, 257.7 GMACs = 1.73% MACs, 8.15 ms = 1.33% latency, 63.28 TFLOPS
[default0]:            (query_key_value): ColumnParallelLinear(7.08 M = 0.49% Params, 115.96 GMACs = 0.78% MACs, 1.43 ms = 0.23% latency, 162.54 TFLOPS)
[default0]:            (core_attention): CoreAttention(
[default0]:              0 = 0% Params, 103.08 GMACs = 0.69% MACs, 6.18 ms = 1.01% latency, 33.45 TFLOPS
[default0]:              (scale_mask_softmax): FusedScaleMaskSoftmax(0 = 0% Params, 0 MACs = 0% MACs, 1.42 ms = 0.23% latency, 0 FLOPS)
[default0]:              (attention_dropout): Dropout(0 = 0% Params, 0 MACs = 0% MACs, 2.31 ms = 0.38% latency, 0 FLOPS, p=0.1, inplace=False)
[default0]:            )
[default0]:            (dense): RowParallelLinear(2.36 M = 0.16% Params, 38.65 GMACs = 0.26% MACs, 454.66 us = 0.07% latency, 170.04 TFLOPS)
[default0]:          )
[default0]:          (post_attention_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 163.08 us = 0.03% latency, 0 FLOPS)
[default0]:          (mlp): ParallelMLP(
[default0]:            18.88 M = 1.31% Params, 309.24 GMACs = 2.08% MACs, 4.4 ms = 0.72% latency, 140.64 TFLOPS
[default0]:            (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 154.62 GMACs = 1.04% MACs, 1.4 ms = 0.23% latency, 220.21 TFLOPS)
[default0]:            (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 154.62 GMACs = 1.04% MACs, 1.4 ms = 0.23% latency, 221.6 TFLOPS)
[default0]:          )
[default0]:        )
[default0]:        (15): ParallelTransformerLayer(
[default0]:          84.98 M = 5.9% Params, 567.04 GMACs = 3.81% MACs, 34.45 ms = 5.61% latency, 80.81 TFLOPS
[default0]:          (input_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 165.94 us = 0.03% latency, 0 FLOPS)
[default0]:          (self_attention): ParallelAttention(
[default0]:            9.44 M = 0.66% Params, 257.7 GMACs = 1.73% MACs, 8.2 ms = 1.34% latency, 62.9 TFLOPS
[default0]:            (query_key_value): ColumnParallelLinear(7.08 M = 0.49% Params, 115.96 GMACs = 0.78% MACs, 1.43 ms = 0.23% latency, 162.13 TFLOPS)
[default0]:            (core_attention): CoreAttention(
[default0]:              0 = 0% Params, 103.08 GMACs = 0.69% MACs, 6.23 ms = 1.01% latency, 33.18 TFLOPS
[default0]:              (scale_mask_softmax): FusedScaleMaskSoftmax(0 = 0% Params, 0 MACs = 0% MACs, 1.42 ms = 0.23% latency, 0 FLOPS)
[default0]:              (attention_dropout): Dropout(0 = 0% Params, 0 MACs = 0% MACs, 2.37 ms = 0.39% latency, 0 FLOPS, p=0.1, inplace=False)
[default0]:            )
[default0]:            (dense): RowParallelLinear(2.36 M = 0.16% Params, 38.65 GMACs = 0.26% MACs, 451.33 us = 0.07% latency, 171.29 TFLOPS)
[default0]:          )
[default0]:          (post_attention_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 162.6 us = 0.03% latency, 0 FLOPS)
[default0]:          (mlp): MoE(
[default0]:            75.53 M = 5.24% Params, 309.34 GMACs = 2.08% MACs, 25.17 ms = 4.1% latency, 90.1 TFLOPS
[default0]:            (deepspeed_moe): MOELayer(
[default0]:              75.53 M = 5.24% Params, 309.34 GMACs = 2.08% MACs, 25.14 ms = 4.09% latency, 90.23 TFLOPS
[default0]:              (gate): TopKGate(
[default0]:                6.14 K = 0% Params, 100.66 MMACs = 0% MACs, 8.54 ms = 1.39% latency, 55.02 GFLOPS
[default0]:                (wg): Linear(6.14 K = 0% Params, 100.66 MMACs = 0% MACs, 215.05 us = 0.04% latency, 936.17 GFLOPS, in_features=1536, out_features=4, bias=False)
[default0]:              )
[default0]:              (experts): Experts(
[default0]:                75.53 M = 5.24% Params, 309.24 GMACs = 2.08% MACs, 5.71 ms = 0.93% latency, 108.29 TFLOPS
[default0]:                (deepspeed_experts): ModuleList(
[default0]:                  75.53 M = 5.24% Params, 309.24 GMACs = 2.08% MACs, 5.48 ms = 0.89% latency, 112.94 TFLOPS
[default0]:                  (0): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.39 ms = 0.23% latency, 111.56 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 447.51 us = 0.07% latency, 172.75 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 437.5 us = 0.07% latency, 176.71 TFLOPS)
[default0]:                  )
[default0]:                  (1): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.36 ms = 0.22% latency, 113.4 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 431.06 us = 0.07% latency, 179.35 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 434.64 us = 0.07% latency, 177.87 TFLOPS)
[default0]:                  )
[default0]:                  (2): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.37 ms = 0.22% latency, 113.08 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 440.6 us = 0.07% latency, 175.46 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 434.4 us = 0.07% latency, 177.97 TFLOPS)
[default0]:                  )
[default0]:                  (3): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.36 ms = 0.22% latency, 113.76 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 436.54 us = 0.07% latency, 177.09 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 433.21 us = 0.07% latency, 178.46 TFLOPS)
[default0]:                  )
[default0]:                )
[default0]:              )
[default0]:            )
[default0]:          )
[default0]:        )
[default0]:        (16): ParallelTransformerLayer(
[default0]:          28.33 M = 1.97% Params, 566.94 GMACs = 3.81% MACs, 13.55 ms = 2.21% latency, 83.69 TFLOPS
[default0]:          (input_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 163.32 us = 0.03% latency, 0 FLOPS)
[default0]:          (self_attention): ParallelAttention(
[default0]:            9.44 M = 0.66% Params, 257.7 GMACs = 1.73% MACs, 8.21 ms = 1.34% latency, 62.87 TFLOPS
[default0]:            (query_key_value): ColumnParallelLinear(7.08 M = 0.49% Params, 115.96 GMACs = 0.78% MACs, 1.43 ms = 0.23% latency, 162.45 TFLOPS)
[default0]:            (core_attention): CoreAttention(
[default0]:              0 = 0% Params, 103.08 GMACs = 0.69% MACs, 6.23 ms = 1.01% latency, 33.19 TFLOPS
[default0]:              (scale_mask_softmax): FusedScaleMaskSoftmax(0 = 0% Params, 0 MACs = 0% MACs, 1.42 ms = 0.23% latency, 0 FLOPS)
[default0]:              (attention_dropout): Dropout(0 = 0% Params, 0 MACs = 0% MACs, 2.35 ms = 0.38% latency, 0 FLOPS, p=0.1, inplace=False)
[default0]:            )
[default0]:            (dense): RowParallelLinear(2.36 M = 0.16% Params, 38.65 GMACs = 0.26% MACs, 459.67 us = 0.07% latency, 168.18 TFLOPS)
[default0]:          )
[default0]:          (post_attention_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 162.84 us = 0.03% latency, 0 FLOPS)
[default0]:          (mlp): ParallelMLP(
[default0]:            18.88 M = 1.31% Params, 309.24 GMACs = 2.08% MACs, 4.4 ms = 0.72% latency, 140.52 TFLOPS
[default0]:            (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 154.62 GMACs = 1.04% MACs, 1.41 ms = 0.23% latency, 220.1 TFLOPS)
[default0]:            (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 154.62 GMACs = 1.04% MACs, 1.4 ms = 0.23% latency, 221.04 TFLOPS)
[default0]:          )
[default0]:        )
[default0]:        (17): ParallelTransformerLayer(
[default0]:          84.98 M = 5.9% Params, 567.04 GMACs = 3.81% MACs, 34.4 ms = 5.6% latency, 80.93 TFLOPS
[default0]:          (input_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 160.93 us = 0.03% latency, 0 FLOPS)
[default0]:          (self_attention): ParallelAttention(
[default0]:            9.44 M = 0.66% Params, 257.7 GMACs = 1.73% MACs, 8.15 ms = 1.33% latency, 63.29 TFLOPS
[default0]:            (query_key_value): ColumnParallelLinear(7.08 M = 0.49% Params, 115.96 GMACs = 0.78% MACs, 1.42 ms = 0.23% latency, 162.81 TFLOPS)
[default0]:            (core_attention): CoreAttention(
[default0]:              0 = 0% Params, 103.08 GMACs = 0.69% MACs, 6.18 ms = 1.01% latency, 33.44 TFLOPS
[default0]:              (scale_mask_softmax): FusedScaleMaskSoftmax(0 = 0% Params, 0 MACs = 0% MACs, 1.42 ms = 0.23% latency, 0 FLOPS)
[default0]:              (attention_dropout): Dropout(0 = 0% Params, 0 MACs = 0% MACs, 2.31 ms = 0.38% latency, 0 FLOPS, p=0.1, inplace=False)
[default0]:            )
[default0]:            (dense): RowParallelLinear(2.36 M = 0.16% Params, 38.65 GMACs = 0.26% MACs, 453.71 us = 0.07% latency, 170.39 TFLOPS)
[default0]:          )
[default0]:          (post_attention_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 164.27 us = 0.03% latency, 0 FLOPS)
[default0]:          (mlp): MoE(
[default0]:            75.53 M = 5.24% Params, 309.34 GMACs = 2.08% MACs, 25.17 ms = 4.1% latency, 90.12 TFLOPS
[default0]:            (deepspeed_moe): MOELayer(
[default0]:              75.53 M = 5.24% Params, 309.34 GMACs = 2.08% MACs, 25.13 ms = 4.09% latency, 90.25 TFLOPS
[default0]:              (gate): TopKGate(
[default0]:                6.14 K = 0% Params, 100.66 MMACs = 0% MACs, 8.53 ms = 1.39% latency, 55.09 GFLOPS
[default0]:                (wg): Linear(6.14 K = 0% Params, 100.66 MMACs = 0% MACs, 220.06 us = 0.04% latency, 914.87 GFLOPS, in_features=1536, out_features=4, bias=False)
[default0]:              )
[default0]:              (experts): Experts(
[default0]:                75.53 M = 5.24% Params, 309.24 GMACs = 2.08% MACs, 5.72 ms = 0.93% latency, 108.2 TFLOPS
[default0]:                (deepspeed_experts): ModuleList(
[default0]:                  75.53 M = 5.24% Params, 309.24 GMACs = 2.08% MACs, 5.48 ms = 0.89% latency, 112.77 TFLOPS
[default0]:                  (0): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.39 ms = 0.23% latency, 111.16 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 448.23 us = 0.07% latency, 172.48 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 440.12 us = 0.07% latency, 175.66 TFLOPS)
[default0]:                  )
[default0]:                  (1): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.37 ms = 0.22% latency, 113.1 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 437.5 us = 0.07% latency, 176.71 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 435.59 us = 0.07% latency, 177.48 TFLOPS)
[default0]:                  )
[default0]:                  (2): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.36 ms = 0.22% latency, 113.68 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 437.02 us = 0.07% latency, 176.9 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 431.78 us = 0.07% latency, 179.05 TFLOPS)
[default0]:                  )
[default0]:                  (3): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.37 ms = 0.22% latency, 113.18 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 436.31 us = 0.07% latency, 177.19 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 437.02 us = 0.07% latency, 176.9 TFLOPS)
[default0]:                  )
[default0]:                )
[default0]:              )
[default0]:            )
[default0]:          )
[default0]:        )
[default0]:        (18): ParallelTransformerLayer(
[default0]:          28.33 M = 1.97% Params, 566.94 GMACs = 3.81% MACs, 13.6 ms = 2.21% latency, 83.43 TFLOPS
[default0]:          (input_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 163.56 us = 0.03% latency, 0 FLOPS)
[default0]:          (self_attention): ParallelAttention(
[default0]:            9.44 M = 0.66% Params, 257.7 GMACs = 1.73% MACs, 8.26 ms = 1.35% latency, 62.46 TFLOPS
[default0]:            (query_key_value): ColumnParallelLinear(7.08 M = 0.49% Params, 115.96 GMACs = 0.78% MACs, 1.43 ms = 0.23% latency, 162.7 TFLOPS)
[default0]:            (core_attention): CoreAttention(
[default0]:              0 = 0% Params, 103.08 GMACs = 0.69% MACs, 6.29 ms = 1.02% latency, 32.86 TFLOPS
[default0]:              (scale_mask_softmax): FusedScaleMaskSoftmax(0 = 0% Params, 0 MACs = 0% MACs, 1.43 ms = 0.23% latency, 0 FLOPS)
[default0]:              (attention_dropout): Dropout(0 = 0% Params, 0 MACs = 0% MACs, 2.42 ms = 0.39% latency, 0 FLOPS, p=0.1, inplace=False)
[default0]:            )
[default0]:            (dense): RowParallelLinear(2.36 M = 0.16% Params, 38.65 GMACs = 0.26% MACs, 453.71 us = 0.07% latency, 170.39 TFLOPS)
[default0]:          )
[default0]:          (post_attention_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 164.03 us = 0.03% latency, 0 FLOPS)
[default0]:          (mlp): ParallelMLP(
[default0]:            18.88 M = 1.31% Params, 309.24 GMACs = 2.08% MACs, 4.4 ms = 0.72% latency, 140.65 TFLOPS
[default0]:            (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 154.62 GMACs = 1.04% MACs, 1.4 ms = 0.23% latency, 220.21 TFLOPS)
[default0]:            (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 154.62 GMACs = 1.04% MACs, 1.39 ms = 0.23% latency, 221.79 TFLOPS)
[default0]:          )
[default0]:        )
[default0]:        (19): ParallelTransformerLayer(
[default0]:          84.98 M = 5.9% Params, 567.04 GMACs = 3.81% MACs, 34.44 ms = 5.61% latency, 80.84 TFLOPS
[default0]:          (input_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 162.6 us = 0.03% latency, 0 FLOPS)
[default0]:          (self_attention): ParallelAttention(
[default0]:            9.44 M = 0.66% Params, 257.7 GMACs = 1.73% MACs, 8.19 ms = 1.33% latency, 62.99 TFLOPS
[default0]:            (query_key_value): ColumnParallelLinear(7.08 M = 0.49% Params, 115.96 GMACs = 0.78% MACs, 1.43 ms = 0.23% latency, 162.26 TFLOPS)
[default0]:            (core_attention): CoreAttention(
[default0]:              0 = 0% Params, 103.08 GMACs = 0.69% MACs, 6.22 ms = 1.01% latency, 33.24 TFLOPS
[default0]:              (scale_mask_softmax): FusedScaleMaskSoftmax(0 = 0% Params, 0 MACs = 0% MACs, 1.42 ms = 0.23% latency, 0 FLOPS)
[default0]:              (attention_dropout): Dropout(0 = 0% Params, 0 MACs = 0% MACs, 2.36 ms = 0.38% latency, 0 FLOPS, p=0.1, inplace=False)
[default0]:            )
[default0]:            (dense): RowParallelLinear(2.36 M = 0.16% Params, 38.65 GMACs = 0.26% MACs, 453.71 us = 0.07% latency, 170.39 TFLOPS)
[default0]:          )
[default0]:          (post_attention_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 162.36 us = 0.03% latency, 0 FLOPS)
[default0]:          (mlp): MoE(
[default0]:            75.53 M = 5.24% Params, 309.34 GMACs = 2.08% MACs, 25.17 ms = 4.1% latency, 90.1 TFLOPS
[default0]:            (deepspeed_moe): MOELayer(
[default0]:              75.53 M = 5.24% Params, 309.34 GMACs = 2.08% MACs, 25.14 ms = 4.09% latency, 90.23 TFLOPS
[default0]:              (gate): TopKGate(
[default0]:                6.14 K = 0% Params, 100.66 MMACs = 0% MACs, 8.52 ms = 1.39% latency, 55.13 GFLOPS
[default0]:                (wg): Linear(6.14 K = 0% Params, 100.66 MMACs = 0% MACs, 214.34 us = 0.03% latency, 939.29 GFLOPS, in_features=1536, out_features=4, bias=False)
[default0]:              )
[default0]:              (experts): Experts(
[default0]:                75.53 M = 5.24% Params, 309.24 GMACs = 2.08% MACs, 5.73 ms = 0.93% latency, 107.96 TFLOPS
[default0]:                (deepspeed_experts): ModuleList(
[default0]:                  75.53 M = 5.24% Params, 309.24 GMACs = 2.08% MACs, 5.5 ms = 0.9% latency, 112.5 TFLOPS
[default0]:                  (0): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.39 ms = 0.23% latency, 111.16 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 452.52 us = 0.07% latency, 170.84 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 437.97 us = 0.07% latency, 176.52 TFLOPS)
[default0]:                  )
[default0]:                  (1): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.37 ms = 0.22% latency, 113.22 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 435.83 us = 0.07% latency, 177.38 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 433.68 us = 0.07% latency, 178.26 TFLOPS)
[default0]:                  )
[default0]:                  (2): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.37 ms = 0.22% latency, 112.9 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 439.64 us = 0.07% latency, 175.85 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 438.69 us = 0.07% latency, 176.23 TFLOPS)
[default0]:                  )
[default0]:                  (3): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.37 ms = 0.22% latency, 112.75 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 436.78 us = 0.07% latency, 177 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 433.68 us = 0.07% latency, 178.26 TFLOPS)
[default0]:                  )
[default0]:                )
[default0]:              )
[default0]:            )
[default0]:          )
[default0]:        )
[default0]:        (20): ParallelTransformerLayer(
[default0]:          28.33 M = 1.97% Params, 566.94 GMACs = 3.81% MACs, 13.59 ms = 2.21% latency, 83.5 TFLOPS
[default0]:          (input_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 162.36 us = 0.03% latency, 0 FLOPS)
[default0]:          (self_attention): ParallelAttention(
[default0]:            9.44 M = 0.66% Params, 257.7 GMACs = 1.73% MACs, 8.22 ms = 1.34% latency, 62.74 TFLOPS
[default0]:            (query_key_value): ColumnParallelLinear(7.08 M = 0.49% Params, 115.96 GMACs = 0.78% MACs, 1.43 ms = 0.23% latency, 162.51 TFLOPS)
[default0]:            (core_attention): CoreAttention(
[default0]:              0 = 0% Params, 103.08 GMACs = 0.69% MACs, 6.25 ms = 1.02% latency, 33.06 TFLOPS
[default0]:              (scale_mask_softmax): FusedScaleMaskSoftmax(0 = 0% Params, 0 MACs = 0% MACs, 1.42 ms = 0.23% latency, 0 FLOPS)
[default0]:              (attention_dropout): Dropout(0 = 0% Params, 0 MACs = 0% MACs, 2.39 ms = 0.39% latency, 0 FLOPS, p=0.1, inplace=False)
[default0]:            )
[default0]:            (dense): RowParallelLinear(2.36 M = 0.16% Params, 38.65 GMACs = 0.26% MACs, 450.85 us = 0.07% latency, 171.47 TFLOPS)
[default0]:          )
[default0]:          (post_attention_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 163.32 us = 0.03% latency, 0 FLOPS)
[default0]:          (mlp): ParallelMLP(
[default0]:            18.88 M = 1.31% Params, 309.24 GMACs = 2.08% MACs, 4.42 ms = 0.72% latency, 140.04 TFLOPS
[default0]:            (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 154.62 GMACs = 1.04% MACs, 1.41 ms = 0.23% latency, 219.95 TFLOPS)
[default0]:            (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 154.62 GMACs = 1.04% MACs, 1.4 ms = 0.23% latency, 220.47 TFLOPS)
[default0]:          )
[default0]:        )
[default0]:        (21): ParallelTransformerLayer(
[default0]:          84.98 M = 5.9% Params, 567.04 GMACs = 3.81% MACs, 34.52 ms = 5.62% latency, 80.65 TFLOPS
[default0]:          (input_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 161.89 us = 0.03% latency, 0 FLOPS)
[default0]:          (self_attention): ParallelAttention(
[default0]:            9.44 M = 0.66% Params, 257.7 GMACs = 1.73% MACs, 8.2 ms = 1.34% latency, 62.94 TFLOPS
[default0]:            (query_key_value): ColumnParallelLinear(7.08 M = 0.49% Params, 115.96 GMACs = 0.78% MACs, 1.42 ms = 0.23% latency, 162.81 TFLOPS)
[default0]:            (core_attention): CoreAttention(
[default0]:              0 = 0% Params, 103.08 GMACs = 0.69% MACs, 6.23 ms = 1.02% latency, 33.17 TFLOPS
[default0]:              (scale_mask_softmax): FusedScaleMaskSoftmax(0 = 0% Params, 0 MACs = 0% MACs, 1.43 ms = 0.23% latency, 0 FLOPS)
[default0]:              (attention_dropout): Dropout(0 = 0% Params, 0 MACs = 0% MACs, 2.36 ms = 0.38% latency, 0 FLOPS, p=0.1, inplace=False)
[default0]:            )
[default0]:            (dense): RowParallelLinear(2.36 M = 0.16% Params, 38.65 GMACs = 0.26% MACs, 450.85 us = 0.07% latency, 171.47 TFLOPS)
[default0]:          )
[default0]:          (post_attention_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 168.09 us = 0.03% latency, 0 FLOPS)
[default0]:          (mlp): MoE(
[default0]:            75.53 M = 5.24% Params, 309.34 GMACs = 2.08% MACs, 25.24 ms = 4.11% latency, 89.88 TFLOPS
[default0]:            (deepspeed_moe): MOELayer(
[default0]:              75.53 M = 5.24% Params, 309.34 GMACs = 2.08% MACs, 25.19 ms = 4.1% latency, 90.03 TFLOPS
[default0]:              (gate): TopKGate(
[default0]:                6.14 K = 0% Params, 100.66 MMACs = 0% MACs, 8.55 ms = 1.39% latency, 54.92 GFLOPS
[default0]:                (wg): Linear(6.14 K = 0% Params, 100.66 MMACs = 0% MACs, 215.29 us = 0.04% latency, 935.13 GFLOPS, in_features=1536, out_features=4, bias=False)
[default0]:              )
[default0]:              (experts): Experts(
[default0]:                75.53 M = 5.24% Params, 309.24 GMACs = 2.08% MACs, 5.72 ms = 0.93% latency, 108.21 TFLOPS
[default0]:                (deepspeed_experts): ModuleList(
[default0]:                  75.53 M = 5.24% Params, 309.24 GMACs = 2.08% MACs, 5.48 ms = 0.89% latency, 112.79 TFLOPS
[default0]:                  (0): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.38 ms = 0.23% latency, 111.87 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 445.13 us = 0.07% latency, 173.68 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 436.31 us = 0.07% latency, 177.19 TFLOPS)
[default0]:                  )
[default0]:                  (1): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.36 ms = 0.22% latency, 113.46 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 436.54 us = 0.07% latency, 177.09 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 432.97 us = 0.07% latency, 178.56 TFLOPS)
[default0]:                  )
[default0]:                  (2): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.36 ms = 0.22% latency, 113.36 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 438.21 us = 0.07% latency, 176.42 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 433.68 us = 0.07% latency, 178.26 TFLOPS)
[default0]:                  )
[default0]:                  (3): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.37 ms = 0.22% latency, 112.49 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 436.54 us = 0.07% latency, 177.09 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 438.21 us = 0.07% latency, 176.42 TFLOPS)
[default0]:                  )
[default0]:                )
[default0]:              )
[default0]:            )
[default0]:          )
[default0]:        )
[default0]:        (22): ParallelTransformerLayer(
[default0]:          28.33 M = 1.97% Params, 566.94 GMACs = 3.81% MACs, 13.56 ms = 2.21% latency, 83.65 TFLOPS
[default0]:          (input_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 163.56 us = 0.03% latency, 0 FLOPS)
[default0]:          (self_attention): ParallelAttention(
[default0]:            9.44 M = 0.66% Params, 257.7 GMACs = 1.73% MACs, 8.22 ms = 1.34% latency, 62.77 TFLOPS
[default0]:            (query_key_value): ColumnParallelLinear(7.08 M = 0.49% Params, 115.96 GMACs = 0.78% MACs, 1.43 ms = 0.23% latency, 162.54 TFLOPS)
[default0]:            (core_attention): CoreAttention(
[default0]:              0 = 0% Params, 103.08 GMACs = 0.69% MACs, 6.25 ms = 1.02% latency, 33.09 TFLOPS
[default0]:              (scale_mask_softmax): FusedScaleMaskSoftmax(0 = 0% Params, 0 MACs = 0% MACs, 1.42 ms = 0.23% latency, 0 FLOPS)
[default0]:              (attention_dropout): Dropout(0 = 0% Params, 0 MACs = 0% MACs, 2.38 ms = 0.39% latency, 0 FLOPS, p=0.1, inplace=False)
[default0]:            )
[default0]:            (dense): RowParallelLinear(2.36 M = 0.16% Params, 38.65 GMACs = 0.26% MACs, 453.71 us = 0.07% latency, 170.39 TFLOPS)
[default0]:          )
[default0]:          (post_attention_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 162.12 us = 0.03% latency, 0 FLOPS)
[default0]:          (mlp): ParallelMLP(
[default0]:            18.88 M = 1.31% Params, 309.24 GMACs = 2.08% MACs, 4.4 ms = 0.72% latency, 140.68 TFLOPS
[default0]:            (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 154.62 GMACs = 1.04% MACs, 1.4 ms = 0.23% latency, 220.32 TFLOPS)
[default0]:            (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 154.62 GMACs = 1.04% MACs, 1.39 ms = 0.23% latency, 221.94 TFLOPS)
[default0]:          )
[default0]:        )
[default0]:        (23): ParallelTransformerLayer(
[default0]:          84.98 M = 5.9% Params, 567.04 GMACs = 3.81% MACs, 34.38 ms = 5.6% latency, 80.98 TFLOPS
[default0]:          (input_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 161.89 us = 0.03% latency, 0 FLOPS)
[default0]:          (self_attention): ParallelAttention(
[default0]:            9.44 M = 0.66% Params, 257.7 GMACs = 1.73% MACs, 8.12 ms = 1.32% latency, 63.56 TFLOPS
[default0]:            (query_key_value): ColumnParallelLinear(7.08 M = 0.49% Params, 115.96 GMACs = 0.78% MACs, 1.43 ms = 0.23% latency, 162.62 TFLOPS)
[default0]:            (core_attention): CoreAttention(
[default0]:              0 = 0% Params, 103.08 GMACs = 0.69% MACs, 6.14 ms = 1% latency, 33.64 TFLOPS
[default0]:              (scale_mask_softmax): FusedScaleMaskSoftmax(0 = 0% Params, 0 MACs = 0% MACs, 1.42 ms = 0.23% latency, 0 FLOPS)
[default0]:              (attention_dropout): Dropout(0 = 0% Params, 0 MACs = 0% MACs, 2.27 ms = 0.37% latency, 0 FLOPS, p=0.1, inplace=False)
[default0]:            )
[default0]:            (dense): RowParallelLinear(2.36 M = 0.16% Params, 38.65 GMACs = 0.26% MACs, 454.66 us = 0.07% latency, 170.04 TFLOPS)
[default0]:          )
[default0]:          (post_attention_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 162.12 us = 0.03% latency, 0 FLOPS)
[default0]:          (mlp): MoE(
[default0]:            75.53 M = 5.24% Params, 309.34 GMACs = 2.08% MACs, 25.18 ms = 4.1% latency, 90.07 TFLOPS
[default0]:            (deepspeed_moe): MOELayer(
[default0]:              75.53 M = 5.24% Params, 309.34 GMACs = 2.08% MACs, 25.15 ms = 4.1% latency, 90.2 TFLOPS
[default0]:              (gate): TopKGate(
[default0]:                6.14 K = 0% Params, 100.66 MMACs = 0% MACs, 8.52 ms = 1.39% latency, 55.15 GFLOPS
[default0]:                (wg): Linear(6.14 K = 0% Params, 100.66 MMACs = 0% MACs, 216.25 us = 0.04% latency, 931.01 GFLOPS, in_features=1536, out_features=4, bias=False)
[default0]:              )
[default0]:              (experts): Experts(
[default0]:                75.53 M = 5.24% Params, 309.24 GMACs = 2.08% MACs, 5.72 ms = 0.93% latency, 108.22 TFLOPS
[default0]:                (deepspeed_experts): ModuleList(
[default0]:                  75.53 M = 5.24% Params, 309.24 GMACs = 2.08% MACs, 5.48 ms = 0.89% latency, 112.84 TFLOPS
[default0]:                  (0): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.39 ms = 0.23% latency, 111.54 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 449.9 us = 0.07% latency, 171.84 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 434.88 us = 0.07% latency, 177.77 TFLOPS)
[default0]:                  )
[default0]:                  (1): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.37 ms = 0.22% latency, 112.59 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 437.02 us = 0.07% latency, 176.9 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 434.4 us = 0.07% latency, 177.97 TFLOPS)
[default0]:                  )
[default0]:                  (2): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.36 ms = 0.22% latency, 113.76 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 432.73 us = 0.07% latency, 178.66 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 434.88 us = 0.07% latency, 177.77 TFLOPS)
[default0]:                  )
[default0]:                  (3): ParallelMLP(
[default0]:                    18.88 M = 1.31% Params, 77.31 GMACs = 0.52% MACs, 1.36 ms = 0.22% latency, 113.52 TFLOPS
[default0]:                    (dense_h_to_4h): ColumnParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 437.02 us = 0.07% latency, 176.9 TFLOPS)
[default0]:                    (dense_4h_to_h): RowParallelLinear(9.44 M = 0.66% Params, 38.65 GMACs = 0.26% MACs, 432.97 us = 0.07% latency, 178.56 TFLOPS)
[default0]:                  )
[default0]:                )
[default0]:              )
[default0]:            )
[default0]:          )
[default0]:        )
[default0]:      )
[default0]:      (final_layernorm): MixedFusedLayerNorm(3.07 K = 0% Params, 0 MACs = 0% MACs, 162.6 us = 0.03% latency, 0 FLOPS)
[default0]:    )
[default0]:  )
[default0]:)
[default0]:------------------------------------------------------------------------------
[default0]:[2023-09-01 14:23:42,716] [INFO] [profiler.py:226:end_profile] Flops profiler finished
[default0]:[2023-09-01 14:23:42,716] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 614.05 | bwd_microstep: 1294.64 | bwd_inner_microstep: 1284.94 | bwd_allreduce_microstep: 9.60 | step_microstep: 166.46
[default0]:[2023-09-01 14:23:42,716] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 (fwd_moe: 290.71, 1st_a2a: 2.87, 2nd_a2a: 2.68, top_k: 99.86)
[default0]:[2023-09-01 14:23:42,716] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 0.00 | bwd_inner: 1284.94 | bwd_allreduce: 9.60 | step: 0.00
[default0]:[2023-09-01 14:23:44,907] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.51 | optimizer_gradients: 22.22 | optimizer_step: 41.54
[default0]:[2023-09-01 14:23:44,907] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.85 | bwd_microstep: 1296.74 | bwd_inner_microstep: 1287.05 | bwd_allreduce_microstep: 9.58 | step_microstep: 166.37
[default0]:[2023-09-01 14:23:44,907] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.85 (fwd_moe: 292.47, 1st_a2a: 2.79, 2nd_a2a: 2.70, top_k: 99.86)
[default0]:[2023-09-01 14:23:44,908] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1296.74 | bwd_inner: 1287.05 | bwd_allreduce: 9.59 | step: 166.37
[default0]:[2023-09-01 14:23:47,086] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.49 | optimizer_gradients: 22.20 | optimizer_step: 41.42
[default0]:[2023-09-01 14:23:47,086] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.08 | bwd_microstep: 1294.45 | bwd_inner_microstep: 1284.75 | bwd_allreduce_microstep: 9.59 | step_microstep: 166.66
[default0]:[2023-09-01 14:23:47,087] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.08 (fwd_moe: 290.45, 1st_a2a: 2.85, 2nd_a2a: 2.70, top_k: 99.58)
[default0]:[2023-09-01 14:23:47,087] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1294.45 | bwd_inner: 1284.74 | bwd_allreduce: 9.59 | step: 166.66
[default0]:[2023-09-01 14:23:49,360] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.60 | optimizer_gradients: 22.20 | optimizer_step: 41.35
[default0]:[2023-09-01 14:23:49,361] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.31 | bwd_microstep: 1297.18 | bwd_inner_microstep: 1287.37 | bwd_allreduce_microstep: 9.71 | step_microstep: 166.64
[default0]:[2023-09-01 14:23:49,361] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.31 (fwd_moe: 290.97, 1st_a2a: 2.84, 2nd_a2a: 2.67, top_k: 99.59)
[default0]:[2023-09-01 14:23:49,361] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1297.18 | bwd_inner: 1287.37 | bwd_allreduce: 9.70 | step: 166.64
[default0]:[2023-09-01 14:23:51,611] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.48 | optimizer_gradients: 22.24 | optimizer_step: 41.44
[default0]:[2023-09-01 14:23:51,611] [INFO] [logging.py:96:log_dist] [Rank 0] step=15, skipped=0, lr=[1.2233386666666666e-07, 1.2233386666666666e-07, 1.2233386666666666e-07, 1.2233386666666666e-07, 1.2233386666666666e-07, 1.2233386666666666e-07, 1.2233386666666666e-07, 1.2233386666666666e-07, 1.2233386666666666e-07], mom=[(0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95)]
[default0]:[2023-09-01 14:23:51,611] [INFO] [timer.py:260:stop] epoch=0/micro_step=15/global_step=15, RunningAvgSamplesPerSec=3.889499067303351, CurrSamplesPerSec=3.89175597192553, MemAllocated=20.91GB, MaxMemAllocated=31.29GB
[default0]:[2023-09-01 14:23:51,612] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.68 | bwd_microstep: 1295.29 | bwd_inner_microstep: 1285.71 | bwd_allreduce_microstep: 9.48 | step_microstep: 166.63
[default0]:[2023-09-01 14:23:51,612] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.68 (fwd_moe: 290.82, 1st_a2a: 2.78, 2nd_a2a: 2.66, top_k: 99.70)
[default0]:[2023-09-01 14:23:51,612] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1295.29 | bwd_inner: 1285.71 | bwd_allreduce: 9.48 | step: 166.63
[default0]: iteration       15/54931640 | consumed samples:          120 | consumed tokens:       245760 | elapsed time per iteration (ms): 2261.7 | learning rate: 1.223E-07 | global batch size:     8 | lm loss: 1.082832E+01 | moe loss: 1.366470E-01 | loss scale: 2048.0 | actual seqlen:  2048 | number of skipped iterations:   0 | number of nan iterations:   0 | samples per second: 3.537 | TFLOPs: 51.49 |
[default0]:[2023-09-01 14:23:53,848] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.54 | optimizer_gradients: 22.23 | optimizer_step: 41.38
[default0]:[2023-09-01 14:23:53,848] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.35 | bwd_microstep: 1298.99 | bwd_inner_microstep: 1289.24 | bwd_allreduce_microstep: 9.65 | step_microstep: 166.17
[default0]:[2023-09-01 14:23:53,848] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.35 (fwd_moe: 291.57, 1st_a2a: 2.81, 2nd_a2a: 2.68, top_k: 100.10)
[default0]:[2023-09-01 14:23:53,848] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1298.99 | bwd_inner: 1289.25 | bwd_allreduce: 9.65 | step: 166.17
[default0]:[2023-09-01 14:23:56,064] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.48 | optimizer_gradients: 22.24 | optimizer_step: 41.42
[default0]:[2023-09-01 14:23:56,064] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.21 | bwd_microstep: 1295.58 | bwd_inner_microstep: 1285.87 | bwd_allreduce_microstep: 9.60 | step_microstep: 166.70
[default0]:[2023-09-01 14:23:56,064] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.21 (fwd_moe: 291.20, 1st_a2a: 2.80, 2nd_a2a: 2.67, top_k: 99.86)
[default0]:[2023-09-01 14:23:56,064] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1295.58 | bwd_inner: 1285.88 | bwd_allreduce: 9.60 | step: 166.71
[default0]:[2023-09-01 14:23:58,342] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.50 | optimizer_gradients: 22.21 | optimizer_step: 41.42
[default0]:[2023-09-01 14:23:58,342] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.87 | bwd_microstep: 1296.26 | bwd_inner_microstep: 1286.64 | bwd_allreduce_microstep: 9.51 | step_microstep: 166.38
[default0]:[2023-09-01 14:23:58,342] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.87 (fwd_moe: 291.09, 1st_a2a: 2.79, 2nd_a2a: 2.71, top_k: 99.94)
[default0]:[2023-09-01 14:23:58,342] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1296.26 | bwd_inner: 1286.65 | bwd_allreduce: 9.51 | step: 166.38
[default0]:[2023-09-01 14:24:00,599] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.48 | optimizer_gradients: 22.27 | optimizer_step: 41.38
[default0]:[2023-09-01 14:24:00,599] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 593.86 | bwd_microstep: 1297.41 | bwd_inner_microstep: 1287.82 | bwd_allreduce_microstep: 9.49 | step_microstep: 166.33
[default0]:[2023-09-01 14:24:00,599] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 593.86 (fwd_moe: 291.21, 1st_a2a: 2.77, 2nd_a2a: 2.64, top_k: 99.95)
[default0]:[2023-09-01 14:24:00,599] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1297.41 | bwd_inner: 1287.83 | bwd_allreduce: 9.49 | step: 166.34
[default0]:[2023-09-01 14:24:02,853] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.48 | optimizer_gradients: 22.30 | optimizer_step: 41.44
[default0]:[2023-09-01 14:24:02,854] [INFO] [logging.py:96:log_dist] [Rank 0] step=20, skipped=0, lr=[1.6602453333333333e-07, 1.6602453333333333e-07, 1.6602453333333333e-07, 1.6602453333333333e-07, 1.6602453333333333e-07, 1.6602453333333333e-07, 1.6602453333333333e-07, 1.6602453333333333e-07, 1.6602453333333333e-07], mom=[(0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95)]
[default0]:[2023-09-01 14:24:02,854] [INFO] [timer.py:260:stop] epoch=0/micro_step=20/global_step=20, RunningAvgSamplesPerSec=3.889002578771922, CurrSamplesPerSec=3.88628483643392, MemAllocated=20.91GB, MaxMemAllocated=31.29GB
[default0]:[2023-09-01 14:24:02,854] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.72 | bwd_microstep: 1298.59 | bwd_inner_microstep: 1288.88 | bwd_allreduce_microstep: 9.60 | step_microstep: 167.23
[default0]:[2023-09-01 14:24:02,854] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.72 (fwd_moe: 291.63, 1st_a2a: 2.95, 2nd_a2a: 2.66, top_k: 99.86)
[default0]:[2023-09-01 14:24:02,854] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1298.59 | bwd_inner: 1288.88 | bwd_allreduce: 9.60 | step: 167.23
[default0]: iteration       20/54931640 | consumed samples:          160 | consumed tokens:       327680 | elapsed time per iteration (ms): 2248.7 | learning rate: 1.660E-07 | global batch size:     8 | lm loss: 1.069905E+01 | moe loss: 1.328279E-01 | loss scale: 2048.0 | actual seqlen:  2048 | number of skipped iterations:   0 | number of nan iterations:   0 | samples per second: 3.558 | TFLOPs: 51.78 |
[default0]:[2023-09-01 14:24:05,085] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.48 | optimizer_gradients: 22.20 | optimizer_step: 41.46
[default0]:[2023-09-01 14:24:05,086] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.95 | bwd_microstep: 1296.44 | bwd_inner_microstep: 1286.61 | bwd_allreduce_microstep: 9.73 | step_microstep: 166.64
[default0]:[2023-09-01 14:24:05,086] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.96 (fwd_moe: 291.28, 1st_a2a: 2.78, 2nd_a2a: 2.72, top_k: 99.76)
[default0]:[2023-09-01 14:24:05,086] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1296.44 | bwd_inner: 1286.61 | bwd_allreduce: 9.73 | step: 166.64
[default0]:[2023-09-01 14:24:07,375] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.48 | optimizer_gradients: 22.27 | optimizer_step: 41.46
[default0]:[2023-09-01 14:24:07,376] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.17 | bwd_microstep: 1298.63 | bwd_inner_microstep: 1288.92 | bwd_allreduce_microstep: 9.61 | step_microstep: 166.36
[default0]:[2023-09-01 14:24:07,376] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.17 (fwd_moe: 292.43, 1st_a2a: 2.84, 2nd_a2a: 2.67, top_k: 99.74)
[default0]:[2023-09-01 14:24:07,376] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1298.63 | bwd_inner: 1288.92 | bwd_allreduce: 9.61 | step: 166.36
[default0]:[2023-09-01 14:24:09,644] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.48 | optimizer_gradients: 22.22 | optimizer_step: 41.41
[default0]:[2023-09-01 14:24:09,645] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.01 | bwd_microstep: 1299.13 | bwd_inner_microstep: 1289.40 | bwd_allreduce_microstep: 9.62 | step_microstep: 166.42
[default0]:[2023-09-01 14:24:09,645] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.01 (fwd_moe: 291.50, 1st_a2a: 2.81, 2nd_a2a: 2.66, top_k: 99.99)
[default0]:[2023-09-01 14:24:09,645] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1299.13 | bwd_inner: 1289.40 | bwd_allreduce: 9.62 | step: 166.42
[default0]:[2023-09-01 14:24:11,887] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.47 | optimizer_gradients: 22.20 | optimizer_step: 41.37
[default0]:[2023-09-01 14:24:11,887] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.19 | bwd_microstep: 1296.81 | bwd_inner_microstep: 1287.09 | bwd_allreduce_microstep: 9.61 | step_microstep: 166.70
[default0]:[2023-09-01 14:24:11,888] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.19 (fwd_moe: 291.39, 1st_a2a: 2.78, 2nd_a2a: 2.66, top_k: 99.94)
[default0]:[2023-09-01 14:24:11,888] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1296.80 | bwd_inner: 1287.09 | bwd_allreduce: 9.60 | step: 166.70
[default0]:[2023-09-01 14:24:14,160] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.48 | optimizer_gradients: 22.21 | optimizer_step: 41.34
[default0]:[2023-09-01 14:24:14,160] [INFO] [logging.py:96:log_dist] [Rank 0] step=25, skipped=0, lr=[2.097152e-07, 2.097152e-07, 2.097152e-07, 2.097152e-07, 2.097152e-07, 2.097152e-07, 2.097152e-07, 2.097152e-07, 2.097152e-07], mom=[(0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95)]
[default0]:[2023-09-01 14:24:14,161] [INFO] [timer.py:260:stop] epoch=0/micro_step=25/global_step=25, RunningAvgSamplesPerSec=3.888672515591686, CurrSamplesPerSec=3.8876536550008436, MemAllocated=20.91GB, MaxMemAllocated=31.29GB
[default0]:[2023-09-01 14:24:14,161] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.69 | bwd_microstep: 1297.95 | bwd_inner_microstep: 1288.23 | bwd_allreduce_microstep: 9.61 | step_microstep: 167.23
[default0]:[2023-09-01 14:24:14,161] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.70 (fwd_moe: 292.06, 1st_a2a: 2.98, 2nd_a2a: 2.67, top_k: 99.91)
[default0]:[2023-09-01 14:24:14,161] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1297.95 | bwd_inner: 1288.23 | bwd_allreduce: 9.61 | step: 167.23
[default0]: iteration       25/54931640 | consumed samples:          200 | consumed tokens:       409600 | elapsed time per iteration (ms): 2261.2 | learning rate: 2.097E-07 | global batch size:     8 | lm loss: 1.052485E+01 | moe loss: 1.329023E-01 | loss scale: 2048.0 | actual seqlen:  2048 | number of skipped iterations:   0 | number of nan iterations:   0 | samples per second: 3.538 | TFLOPs: 51.50 |
[default0]:[2023-09-01 14:24:16,412] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.49 | optimizer_gradients: 22.30 | optimizer_step: 41.41
[default0]:[2023-09-01 14:24:16,412] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.19 | bwd_microstep: 1295.93 | bwd_inner_microstep: 1286.18 | bwd_allreduce_microstep: 9.64 | step_microstep: 166.56
[default0]:[2023-09-01 14:24:16,412] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.20 (fwd_moe: 290.81, 1st_a2a: 2.84, 2nd_a2a: 2.64, top_k: 99.62)
[default0]:[2023-09-01 14:24:16,412] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1295.93 | bwd_inner: 1286.18 | bwd_allreduce: 9.65 | step: 166.56
[default0]:[2023-09-01 14:24:18,663] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.51 | optimizer_gradients: 22.28 | optimizer_step: 41.54
[default0]:[2023-09-01 14:24:18,664] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.32 | bwd_microstep: 1297.71 | bwd_inner_microstep: 1288.00 | bwd_allreduce_microstep: 9.60 | step_microstep: 166.71
[default0]:[2023-09-01 14:24:18,664] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.32 (fwd_moe: 291.53, 1st_a2a: 2.78, 2nd_a2a: 2.64, top_k: 99.94)
[default0]:[2023-09-01 14:24:18,664] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1297.70 | bwd_inner: 1288.00 | bwd_allreduce: 9.61 | step: 166.72
[default0]:[2023-09-01 14:24:20,900] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.48 | optimizer_gradients: 22.22 | optimizer_step: 41.38
[default0]:[2023-09-01 14:24:20,901] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.22 | bwd_microstep: 1295.36 | bwd_inner_microstep: 1285.76 | bwd_allreduce_microstep: 9.49 | step_microstep: 166.16
[default0]:[2023-09-01 14:24:20,901] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.22 (fwd_moe: 290.82, 1st_a2a: 2.77, 2nd_a2a: 2.65, top_k: 99.78)
[default0]:[2023-09-01 14:24:20,901] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1295.36 | bwd_inner: 1285.77 | bwd_allreduce: 9.49 | step: 166.16
[default0]:[2023-09-01 14:24:23,119] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.51 | optimizer_gradients: 22.29 | optimizer_step: 41.39
[default0]:[2023-09-01 14:24:23,120] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.04 | bwd_microstep: 1295.27 | bwd_inner_microstep: 1285.68 | bwd_allreduce_microstep: 9.49 | step_microstep: 166.36
[default0]:[2023-09-01 14:24:23,120] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.04 (fwd_moe: 290.65, 1st_a2a: 2.79, 2nd_a2a: 2.65, top_k: 99.60)
[default0]:[2023-09-01 14:24:23,120] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1295.27 | bwd_inner: 1285.68 | bwd_allreduce: 9.49 | step: 166.36
[default0]:[2023-09-01 14:24:25,380] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.50 | optimizer_gradients: 22.21 | optimizer_step: 41.45
[default0]:[2023-09-01 14:24:25,380] [INFO] [logging.py:96:log_dist] [Rank 0] step=30, skipped=0, lr=[2.534058666666667e-07, 2.534058666666667e-07, 2.534058666666667e-07, 2.534058666666667e-07, 2.534058666666667e-07, 2.534058666666667e-07, 2.534058666666667e-07, 2.534058666666667e-07, 2.534058666666667e-07], mom=[(0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95)]
[default0]:[2023-09-01 14:24:25,380] [INFO] [timer.py:260:stop] epoch=0/micro_step=30/global_step=30, RunningAvgSamplesPerSec=3.8889110931255826, CurrSamplesPerSec=3.885925681267402, MemAllocated=20.91GB, MaxMemAllocated=31.29GB
[default0]:[2023-09-01 14:24:25,381] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 593.96 | bwd_microstep: 1296.74 | bwd_inner_microstep: 1286.97 | bwd_allreduce_microstep: 9.66 | step_microstep: 167.04
[default0]:[2023-09-01 14:24:25,381] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 593.96 (fwd_moe: 291.10, 1st_a2a: 2.82, 2nd_a2a: 2.66, top_k: 99.90)
[default0]:[2023-09-01 14:24:25,381] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1296.74 | bwd_inner: 1286.97 | bwd_allreduce: 9.66 | step: 167.04
[default0]: iteration       30/54931640 | consumed samples:          240 | consumed tokens:       491520 | elapsed time per iteration (ms): 2244.0 | learning rate: 2.534E-07 | global batch size:     8 | lm loss: 1.039030E+01 | moe loss: 1.324010E-01 | loss scale: 2048.0 | actual seqlen:  2048 | number of skipped iterations:   0 | number of nan iterations:   0 | samples per second: 3.565 | TFLOPs: 51.89 |
[default0]:[2023-09-01 14:24:27,597] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.50 | optimizer_gradients: 22.24 | optimizer_step: 41.30
[default0]:[2023-09-01 14:24:27,598] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.78 | bwd_microstep: 1295.86 | bwd_inner_microstep: 1286.18 | bwd_allreduce_microstep: 9.57 | step_microstep: 167.12
[default0]:[2023-09-01 14:24:27,598] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.79 (fwd_moe: 291.35, 1st_a2a: 2.79, 2nd_a2a: 2.66, top_k: 100.08)
[default0]:[2023-09-01 14:24:27,598] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1295.86 | bwd_inner: 1286.19 | bwd_allreduce: 9.57 | step: 167.13
[default0]:[2023-09-01 14:24:29,881] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.47 | optimizer_gradients: 22.21 | optimizer_step: 41.44
[default0]:[2023-09-01 14:24:29,882] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.95 | bwd_microstep: 1299.29 | bwd_inner_microstep: 1289.66 | bwd_allreduce_microstep: 9.53 | step_microstep: 166.36
[default0]:[2023-09-01 14:24:29,882] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.95 (fwd_moe: 292.37, 1st_a2a: 2.78, 2nd_a2a: 2.66, top_k: 100.13)
[default0]:[2023-09-01 14:24:29,882] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1299.29 | bwd_inner: 1289.66 | bwd_allreduce: 9.53 | step: 166.36
[default0]:[2023-09-01 14:24:32,123] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.46 | optimizer_gradients: 22.23 | optimizer_step: 41.39
[default0]:[2023-09-01 14:24:32,123] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.60 | bwd_microstep: 1297.91 | bwd_inner_microstep: 1288.22 | bwd_allreduce_microstep: 9.58 | step_microstep: 166.28
[default0]:[2023-09-01 14:24:32,123] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.60 (fwd_moe: 291.22, 1st_a2a: 2.78, 2nd_a2a: 2.66, top_k: 99.89)
[default0]:[2023-09-01 14:24:32,123] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1297.90 | bwd_inner: 1288.22 | bwd_allreduce: 9.58 | step: 166.29
[default0]:[2023-09-01 14:24:34,390] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.48 | optimizer_gradients: 22.29 | optimizer_step: 41.52
[default0]:[2023-09-01 14:24:34,390] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.01 | bwd_microstep: 1301.37 | bwd_inner_microstep: 1291.68 | bwd_allreduce_microstep: 9.57 | step_microstep: 166.77
[default0]:[2023-09-01 14:24:34,391] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.01 (fwd_moe: 293.27, 1st_a2a: 2.86, 2nd_a2a: 2.65, top_k: 99.87)
[default0]:[2023-09-01 14:24:34,391] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1301.37 | bwd_inner: 1291.70 | bwd_allreduce: 9.57 | step: 166.78
[default0]:[2023-09-01 14:24:36,581] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.47 | optimizer_gradients: 22.23 | optimizer_step: 41.44
[default0]:[2023-09-01 14:24:36,582] [INFO] [logging.py:96:log_dist] [Rank 0] step=35, skipped=0, lr=[2.9709653333333336e-07, 2.9709653333333336e-07, 2.9709653333333336e-07, 2.9709653333333336e-07, 2.9709653333333336e-07, 2.9709653333333336e-07, 2.9709653333333336e-07, 2.9709653333333336e-07, 2.9709653333333336e-07], mom=[(0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95)]
[default0]:[2023-09-01 14:24:36,582] [INFO] [timer.py:260:stop] epoch=0/micro_step=35/global_step=35, RunningAvgSamplesPerSec=3.888573414198281, CurrSamplesPerSec=3.889254233453322, MemAllocated=20.91GB, MaxMemAllocated=31.29GB
[default0]:[2023-09-01 14:24:36,582] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.34 | bwd_microstep: 1296.57 | bwd_inner_microstep: 1286.91 | bwd_allreduce_microstep: 9.55 | step_microstep: 167.07
[default0]:[2023-09-01 14:24:36,583] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.35 (fwd_moe: 290.82, 1st_a2a: 2.84, 2nd_a2a: 2.66, top_k: 99.66)
[default0]:[2023-09-01 14:24:36,583] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1296.57 | bwd_inner: 1286.92 | bwd_allreduce: 9.54 | step: 167.07
[default0]: iteration       35/54931640 | consumed samples:          280 | consumed tokens:       573440 | elapsed time per iteration (ms): 2240.5 | learning rate: 2.971E-07 | global batch size:     8 | lm loss: 1.025334E+01 | moe loss: 1.295981E-01 | loss scale: 2048.0 | actual seqlen:  2048 | number of skipped iterations:   0 | number of nan iterations:   0 | samples per second: 3.571 | TFLOPs: 51.97 |
[default0]:[2023-09-01 14:24:38,797] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.53 | optimizer_gradients: 22.33 | optimizer_step: 41.53
[default0]:[2023-09-01 14:24:38,798] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.23 | bwd_microstep: 1297.27 | bwd_inner_microstep: 1287.59 | bwd_allreduce_microstep: 9.57 | step_microstep: 169.49
[default0]:[2023-09-01 14:24:38,798] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.23 (fwd_moe: 291.37, 1st_a2a: 2.76, 2nd_a2a: 2.67, top_k: 99.86)
[default0]:[2023-09-01 14:24:38,798] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1297.27 | bwd_inner: 1287.60 | bwd_allreduce: 9.57 | step: 169.49
[default0]:[2023-09-01 14:24:40,997] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.47 | optimizer_gradients: 22.20 | optimizer_step: 41.39
[default0]:[2023-09-01 14:24:40,998] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.49 | bwd_microstep: 1295.33 | bwd_inner_microstep: 1285.64 | bwd_allreduce_microstep: 9.59 | step_microstep: 166.97
[default0]:[2023-09-01 14:24:40,998] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.50 (fwd_moe: 290.50, 1st_a2a: 2.80, 2nd_a2a: 2.65, top_k: 99.59)
[default0]:[2023-09-01 14:24:40,998] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1295.33 | bwd_inner: 1285.64 | bwd_allreduce: 9.59 | step: 166.97
[default0]:[2023-09-01 14:24:43,262] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.47 | optimizer_gradients: 22.21 | optimizer_step: 41.47
[default0]:[2023-09-01 14:24:43,262] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.15 | bwd_microstep: 1298.14 | bwd_inner_microstep: 1288.45 | bwd_allreduce_microstep: 9.58 | step_microstep: 167.23
[default0]:[2023-09-01 14:24:43,262] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.15 (fwd_moe: 291.79, 1st_a2a: 2.78, 2nd_a2a: 2.67, top_k: 100.09)
[default0]:[2023-09-01 14:24:43,263] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1298.14 | bwd_inner: 1288.46 | bwd_allreduce: 9.59 | step: 167.23
[default0]:[2023-09-01 14:24:45,527] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.47 | optimizer_gradients: 22.23 | optimizer_step: 41.39
[default0]:[2023-09-01 14:24:45,527] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 593.53 | bwd_microstep: 1296.72 | bwd_inner_microstep: 1287.03 | bwd_allreduce_microstep: 9.58 | step_microstep: 166.32
[default0]:[2023-09-01 14:24:45,527] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 593.52 (fwd_moe: 291.11, 1st_a2a: 2.75, 2nd_a2a: 2.65, top_k: 99.87)
[default0]:[2023-09-01 14:24:45,528] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1296.72 | bwd_inner: 1287.04 | bwd_allreduce: 9.58 | step: 166.32
[default0]:[2023-09-01 14:24:47,760] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.46 | optimizer_gradients: 22.21 | optimizer_step: 41.34
[default0]:[2023-09-01 14:24:47,760] [INFO] [logging.py:96:log_dist] [Rank 0] step=40, skipped=0, lr=[3.4078720000000003e-07, 3.4078720000000003e-07, 3.4078720000000003e-07, 3.4078720000000003e-07, 3.4078720000000003e-07, 3.4078720000000003e-07, 3.4078720000000003e-07, 3.4078720000000003e-07, 3.4078720000000003e-07], mom=[(0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95)]
[default0]:[2023-09-01 14:24:47,760] [INFO] [timer.py:260:stop] epoch=0/micro_step=40/global_step=40, RunningAvgSamplesPerSec=3.8882949922530265, CurrSamplesPerSec=3.8851261468726435, MemAllocated=20.91GB, MaxMemAllocated=31.29GB
[default0]:[2023-09-01 14:24:47,761] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.07 | bwd_microstep: 1299.27 | bwd_inner_microstep: 1289.57 | bwd_allreduce_microstep: 9.60 | step_microstep: 166.77
[default0]:[2023-09-01 14:24:47,761] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.08 (fwd_moe: 291.79, 1st_a2a: 2.79, 2nd_a2a: 2.65, top_k: 100.06)
[default0]:[2023-09-01 14:24:47,761] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1299.26 | bwd_inner: 1289.57 | bwd_allreduce: 9.60 | step: 166.77
[default0]: iteration       40/54931640 | consumed samples:          320 | consumed tokens:       655360 | elapsed time per iteration (ms): 2235.4 | learning rate: 3.408E-07 | global batch size:     8 | lm loss: 1.010853E+01 | moe loss: 1.264774E-01 | loss scale: 2048.0 | actual seqlen:  2048 | number of skipped iterations:   0 | number of nan iterations:   0 | samples per second: 3.579 | TFLOPs: 52.09 |
[default0]:[2023-09-01 14:24:49,982] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.51 | optimizer_gradients: 22.25 | optimizer_step: 41.38
[default0]:[2023-09-01 14:24:49,982] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.05 | bwd_microstep: 1300.44 | bwd_inner_microstep: 1290.74 | bwd_allreduce_microstep: 9.59 | step_microstep: 166.92
[default0]:[2023-09-01 14:24:49,982] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.05 (fwd_moe: 291.81, 1st_a2a: 2.82, 2nd_a2a: 2.67, top_k: 100.17)
[default0]:[2023-09-01 14:24:49,982] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1300.44 | bwd_inner: 1290.75 | bwd_allreduce: 9.60 | step: 166.92
[default0]:[2023-09-01 14:24:52,165] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.50 | optimizer_gradients: 22.21 | optimizer_step: 41.49
[default0]:[2023-09-01 14:24:52,165] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.94 | bwd_microstep: 1296.49 | bwd_inner_microstep: 1286.77 | bwd_allreduce_microstep: 9.60 | step_microstep: 166.62
[default0]:[2023-09-01 14:24:52,166] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.94 (fwd_moe: 290.90, 1st_a2a: 2.76, 2nd_a2a: 2.66, top_k: 99.59)
[default0]:[2023-09-01 14:24:52,166] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1296.49 | bwd_inner: 1286.78 | bwd_allreduce: 9.61 | step: 166.63
[default0]:[2023-09-01 14:24:54,358] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.48 | optimizer_gradients: 22.27 | optimizer_step: 41.40
[default0]:[2023-09-01 14:24:54,359] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.80 | bwd_microstep: 1299.73 | bwd_inner_microstep: 1290.04 | bwd_allreduce_microstep: 9.58 | step_microstep: 166.47
[default0]:[2023-09-01 14:24:54,359] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.81 (fwd_moe: 291.02, 1st_a2a: 2.79, 2nd_a2a: 2.65, top_k: 99.86)
[default0]:[2023-09-01 14:24:54,359] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1299.73 | bwd_inner: 1290.04 | bwd_allreduce: 9.58 | step: 166.47
[default0]:[2023-09-01 14:24:56,629] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.54 | optimizer_gradients: 22.27 | optimizer_step: 42.19
[default0]:[2023-09-01 14:24:56,629] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.89 | bwd_microstep: 1298.58 | bwd_inner_microstep: 1288.95 | bwd_allreduce_microstep: 9.52 | step_microstep: 167.23
[default0]:[2023-09-01 14:24:56,630] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.90 (fwd_moe: 291.98, 1st_a2a: 2.91, 2nd_a2a: 2.67, top_k: 100.10)
[default0]:[2023-09-01 14:24:56,630] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1298.58 | bwd_inner: 1288.96 | bwd_allreduce: 9.52 | step: 167.23
[default0]:[2023-09-01 14:24:58,808] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.48 | optimizer_gradients: 22.25 | optimizer_step: 41.36
[default0]:[2023-09-01 14:24:58,808] [INFO] [logging.py:96:log_dist] [Rank 0] step=45, skipped=0, lr=[3.844778666666667e-07, 3.844778666666667e-07, 3.844778666666667e-07, 3.844778666666667e-07, 3.844778666666667e-07, 3.844778666666667e-07, 3.844778666666667e-07, 3.844778666666667e-07, 3.844778666666667e-07], mom=[(0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95)]
[default0]:[2023-09-01 14:24:58,809] [INFO] [timer.py:260:stop] epoch=0/micro_step=45/global_step=45, RunningAvgSamplesPerSec=3.888027367967962, CurrSamplesPerSec=3.8873406328449756, MemAllocated=20.91GB, MaxMemAllocated=31.29GB
[default0]:[2023-09-01 14:24:58,809] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.75 | bwd_microstep: 1297.80 | bwd_inner_microstep: 1288.12 | bwd_allreduce_microstep: 9.55 | step_microstep: 167.46
[default0]:[2023-09-01 14:24:58,809] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.75 (fwd_moe: 291.15, 1st_a2a: 2.80, 2nd_a2a: 2.66, top_k: 99.84)
[default0]:[2023-09-01 14:24:58,809] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1297.80 | bwd_inner: 1288.14 | bwd_allreduce: 9.55 | step: 167.46
[default0]: iteration       45/54931640 | consumed samples:          360 | consumed tokens:       737280 | elapsed time per iteration (ms): 2209.7 | learning rate: 3.845E-07 | global batch size:     8 | lm loss: 1.002533E+01 | moe loss: 1.245215E-01 | loss scale: 2048.0 | actual seqlen:  2048 | number of skipped iterations:   0 | number of nan iterations:   0 | samples per second: 3.620 | TFLOPs: 52.70 |
[default0]:[2023-09-01 14:25:01,028] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.48 | optimizer_gradients: 22.24 | optimizer_step: 41.42
[default0]:[2023-09-01 14:25:01,028] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.77 | bwd_microstep: 1297.68 | bwd_inner_microstep: 1288.02 | bwd_allreduce_microstep: 9.55 | step_microstep: 166.39
[default0]:[2023-09-01 14:25:01,028] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.77 (fwd_moe: 291.64, 1st_a2a: 2.83, 2nd_a2a: 2.63, top_k: 99.95)
[default0]:[2023-09-01 14:25:01,029] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1297.68 | bwd_inner: 1288.03 | bwd_allreduce: 9.55 | step: 166.39
[default0]:[2023-09-01 14:25:03,218] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.48 | optimizer_gradients: 22.25 | optimizer_step: 41.45
[default0]:[2023-09-01 14:25:03,219] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.06 | bwd_microstep: 1295.53 | bwd_inner_microstep: 1285.91 | bwd_allreduce_microstep: 9.52 | step_microstep: 167.03
[default0]:[2023-09-01 14:25:03,219] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.06 (fwd_moe: 290.89, 1st_a2a: 2.75, 2nd_a2a: 2.66, top_k: 99.86)
[default0]:[2023-09-01 14:25:03,219] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1295.53 | bwd_inner: 1285.91 | bwd_allreduce: 9.53 | step: 167.03
[default0]:[2023-09-01 14:25:05,463] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.48 | optimizer_gradients: 22.24 | optimizer_step: 41.46
[default0]:[2023-09-01 14:25:05,464] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 593.17 | bwd_microstep: 1297.82 | bwd_inner_microstep: 1288.19 | bwd_allreduce_microstep: 9.53 | step_microstep: 167.02
[default0]:[2023-09-01 14:25:05,464] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 593.17 (fwd_moe: 291.74, 1st_a2a: 2.75, 2nd_a2a: 2.68, top_k: 100.20)
[default0]:[2023-09-01 14:25:05,464] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1297.82 | bwd_inner: 1288.19 | bwd_allreduce: 9.53 | step: 167.03
[default0]:[2023-09-01 14:25:07,689] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.46 | optimizer_gradients: 22.17 | optimizer_step: 41.38
[default0]:[2023-09-01 14:25:07,689] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.90 | bwd_microstep: 1297.18 | bwd_inner_microstep: 1287.45 | bwd_allreduce_microstep: 9.62 | step_microstep: 166.56
[default0]:[2023-09-01 14:25:07,690] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.91 (fwd_moe: 290.91, 1st_a2a: 2.77, 2nd_a2a: 2.67, top_k: 99.51)
[default0]:[2023-09-01 14:25:07,690] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1297.18 | bwd_inner: 1287.45 | bwd_allreduce: 9.63 | step: 166.56
[default0]:[2023-09-01 14:25:09,925] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.48 | optimizer_gradients: 22.21 | optimizer_step: 41.47
[default0]:[2023-09-01 14:25:09,925] [INFO] [logging.py:96:log_dist] [Rank 0] step=50, skipped=0, lr=[4.2816853333333333e-07, 4.2816853333333333e-07, 4.2816853333333333e-07, 4.2816853333333333e-07, 4.2816853333333333e-07, 4.2816853333333333e-07, 4.2816853333333333e-07, 4.2816853333333333e-07, 4.2816853333333333e-07], mom=[(0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95)]
[default0]:[2023-09-01 14:25:09,926] [INFO] [timer.py:260:stop] epoch=0/micro_step=50/global_step=50, RunningAvgSamplesPerSec=3.8880158796649043, CurrSamplesPerSec=3.885492353075705, MemAllocated=20.91GB, MaxMemAllocated=31.29GB
[default0]:[2023-09-01 14:25:09,926] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.38 | bwd_microstep: 1297.93 | bwd_inner_microstep: 1288.22 | bwd_allreduce_microstep: 9.60 | step_microstep: 167.18
[default0]:[2023-09-01 14:25:09,926] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.39 (fwd_moe: 290.92, 1st_a2a: 2.84, 2nd_a2a: 2.65, top_k: 99.46)
[default0]:[2023-09-01 14:25:09,926] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1297.92 | bwd_inner: 1288.22 | bwd_allreduce: 9.60 | step: 167.18
[default0]: iteration       50/54931640 | consumed samples:          400 | consumed tokens:       819200 | elapsed time per iteration (ms): 2223.5 | learning rate: 4.282E-07 | global batch size:     8 | lm loss: 9.915193E+00 | moe loss: 1.233980E-01 | loss scale: 2048.0 | actual seqlen:  2048 | number of skipped iterations:   0 | number of nan iterations:   0 | samples per second: 3.598 | TFLOPs: 52.37 |
[default0]:[2023-09-01 14:25:12,146] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.48 | optimizer_gradients: 22.24 | optimizer_step: 41.45
[default0]:[2023-09-01 14:25:12,147] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.95 | bwd_microstep: 1296.89 | bwd_inner_microstep: 1287.16 | bwd_allreduce_microstep: 9.62 | step_microstep: 166.82
[default0]:[2023-09-01 14:25:12,147] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.95 (fwd_moe: 291.48, 1st_a2a: 2.79, 2nd_a2a: 2.64, top_k: 99.93)
[default0]:[2023-09-01 14:25:12,147] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1296.88 | bwd_inner: 1287.17 | bwd_allreduce: 9.62 | step: 166.83
[default0]:[2023-09-01 14:25:14,356] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.47 | optimizer_gradients: 22.23 | optimizer_step: 41.48
[default0]:[2023-09-01 14:25:14,356] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.92 | bwd_microstep: 1298.96 | bwd_inner_microstep: 1289.26 | bwd_allreduce_microstep: 9.60 | step_microstep: 166.86
[default0]:[2023-09-01 14:25:14,356] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.92 (fwd_moe: 292.68, 1st_a2a: 2.81, 2nd_a2a: 2.65, top_k: 101.04)
[default0]:[2023-09-01 14:25:14,356] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1298.96 | bwd_inner: 1289.27 | bwd_allreduce: 9.60 | step: 166.86
[default0]:[2023-09-01 14:25:16,548] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.48 | optimizer_gradients: 22.22 | optimizer_step: 41.49
[default0]:[2023-09-01 14:25:16,548] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.39 | bwd_microstep: 1298.82 | bwd_inner_microstep: 1289.14 | bwd_allreduce_microstep: 9.57 | step_microstep: 166.56
[default0]:[2023-09-01 14:25:16,548] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.39 (fwd_moe: 291.74, 1st_a2a: 2.78, 2nd_a2a: 2.66, top_k: 100.05)
[default0]:[2023-09-01 14:25:16,548] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1298.82 | bwd_inner: 1289.15 | bwd_allreduce: 9.58 | step: 166.56
[default0]:[2023-09-01 14:25:18,734] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.47 | optimizer_gradients: 22.23 | optimizer_step: 41.36
[default0]:[2023-09-01 14:25:18,735] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.81 | bwd_microstep: 1296.61 | bwd_inner_microstep: 1286.93 | bwd_allreduce_microstep: 9.57 | step_microstep: 166.14
[default0]:[2023-09-01 14:25:18,735] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.81 (fwd_moe: 290.94, 1st_a2a: 2.96, 2nd_a2a: 2.66, top_k: 99.60)
[default0]:[2023-09-01 14:25:18,735] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1296.61 | bwd_inner: 1286.93 | bwd_allreduce: 9.58 | step: 166.15
[default0]:[2023-09-01 14:25:20,946] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.49 | optimizer_gradients: 22.18 | optimizer_step: 41.38
[default0]:[2023-09-01 14:25:20,946] [INFO] [logging.py:96:log_dist] [Rank 0] step=55, skipped=0, lr=[4.718592e-07, 4.718592e-07, 4.718592e-07, 4.718592e-07, 4.718592e-07, 4.718592e-07, 4.718592e-07, 4.718592e-07, 4.718592e-07], mom=[(0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95)]
[default0]:[2023-09-01 14:25:20,946] [INFO] [timer.py:260:stop] epoch=0/micro_step=55/global_step=55, RunningAvgSamplesPerSec=3.887963846071563, CurrSamplesPerSec=3.886716090361916, MemAllocated=20.91GB, MaxMemAllocated=31.29GB
[default0]:[2023-09-01 14:25:20,947] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.80 | bwd_microstep: 1298.44 | bwd_inner_microstep: 1288.75 | bwd_allreduce_microstep: 9.59 | step_microstep: 167.10
[default0]:[2023-09-01 14:25:20,947] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.80 (fwd_moe: 291.78, 1st_a2a: 2.77, 2nd_a2a: 2.65, top_k: 100.08)
[default0]:[2023-09-01 14:25:20,947] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1298.44 | bwd_inner: 1288.75 | bwd_allreduce: 9.59 | step: 167.10
[default0]: iteration       55/54931640 | consumed samples:          440 | consumed tokens:       901120 | elapsed time per iteration (ms): 2204.0 | learning rate: 4.719E-07 | global batch size:     8 | lm loss: 9.870671E+00 | moe loss: 1.220434E-01 | loss scale: 2048.0 | actual seqlen:  2048 | number of skipped iterations:   0 | number of nan iterations:   0 | samples per second: 3.630 | TFLOPs: 52.83 |
[default0]:[2023-09-01 14:25:23,123] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.47 | optimizer_gradients: 22.24 | optimizer_step: 41.96
[default0]:[2023-09-01 14:25:23,123] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.48 | bwd_microstep: 1298.47 | bwd_inner_microstep: 1288.87 | bwd_allreduce_microstep: 9.50 | step_microstep: 166.92
[default0]:[2023-09-01 14:25:23,123] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.49 (fwd_moe: 292.20, 1st_a2a: 2.78, 2nd_a2a: 2.67, top_k: 100.21)
[default0]:[2023-09-01 14:25:23,124] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1298.47 | bwd_inner: 1288.87 | bwd_allreduce: 9.50 | step: 166.93
[default0]:[2023-09-01 14:25:25,342] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.46 | optimizer_gradients: 22.24 | optimizer_step: 41.41
[default0]:[2023-09-01 14:25:25,343] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.95 | bwd_microstep: 1299.67 | bwd_inner_microstep: 1290.03 | bwd_allreduce_microstep: 9.54 | step_microstep: 166.76
[default0]:[2023-09-01 14:25:25,343] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.96 (fwd_moe: 292.43, 1st_a2a: 2.79, 2nd_a2a: 2.65, top_k: 100.37)
[default0]:[2023-09-01 14:25:25,343] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1299.67 | bwd_inner: 1290.04 | bwd_allreduce: 9.54 | step: 166.76
[default0]:[2023-09-01 14:25:27,513] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.48 | optimizer_gradients: 22.21 | optimizer_step: 41.39
[default0]:[2023-09-01 14:25:27,513] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.07 | bwd_microstep: 1299.39 | bwd_inner_microstep: 1289.65 | bwd_allreduce_microstep: 9.63 | step_microstep: 166.96
[default0]:[2023-09-01 14:25:27,513] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.07 (fwd_moe: 292.28, 1st_a2a: 2.85, 2nd_a2a: 2.68, top_k: 100.12)
[default0]:[2023-09-01 14:25:27,514] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1299.39 | bwd_inner: 1289.66 | bwd_allreduce: 9.64 | step: 166.96
[default0]:[2023-09-01 14:25:29,738] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.47 | optimizer_gradients: 22.20 | optimizer_step: 41.45
[default0]:[2023-09-01 14:25:29,738] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.06 | bwd_microstep: 1298.10 | bwd_inner_microstep: 1288.37 | bwd_allreduce_microstep: 9.63 | step_microstep: 166.41
[default0]:[2023-09-01 14:25:29,738] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.07 (fwd_moe: 290.84, 1st_a2a: 2.76, 2nd_a2a: 2.66, top_k: 99.71)
[default0]:[2023-09-01 14:25:29,739] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1298.10 | bwd_inner: 1288.37 | bwd_allreduce: 9.63 | step: 166.41
[default0]:[2023-09-01 14:25:31,987] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.46 | optimizer_gradients: 22.34 | optimizer_step: 41.41
[default0]:[2023-09-01 14:25:31,987] [INFO] [logging.py:96:log_dist] [Rank 0] step=60, skipped=0, lr=[5.155498666666666e-07, 5.155498666666666e-07, 5.155498666666666e-07, 5.155498666666666e-07, 5.155498666666666e-07, 5.155498666666666e-07, 5.155498666666666e-07, 5.155498666666666e-07, 5.155498666666666e-07], mom=[(0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95)]
[default0]:[2023-09-01 14:25:31,987] [INFO] [timer.py:260:stop] epoch=0/micro_step=60/global_step=60, RunningAvgSamplesPerSec=3.8877955604877785, CurrSamplesPerSec=3.8876171706867195, MemAllocated=20.91GB, MaxMemAllocated=31.29GB
[default0]:[2023-09-01 14:25:31,988] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.75 | bwd_microstep: 1297.71 | bwd_inner_microstep: 1288.01 | bwd_allreduce_microstep: 9.60 | step_microstep: 167.34
[default0]:[2023-09-01 14:25:31,988] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.76 (fwd_moe: 291.73, 1st_a2a: 2.77, 2nd_a2a: 2.67, top_k: 100.07)
[default0]:[2023-09-01 14:25:31,988] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1297.71 | bwd_inner: 1288.01 | bwd_allreduce: 9.60 | step: 167.34
[default0]: iteration       60/54931640 | consumed samples:          480 | consumed tokens:       983040 | elapsed time per iteration (ms): 2208.2 | learning rate: 5.155E-07 | global batch size:     8 | lm loss: 9.824690E+00 | moe loss: 1.209136E-01 | loss scale: 2048.0 | actual seqlen:  2048 | number of skipped iterations:   0 | number of nan iterations:   0 | samples per second: 3.623 | TFLOPs: 52.74 |
[default0]:[2023-09-01 14:25:34,252] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.49 | optimizer_gradients: 22.20 | optimizer_step: 41.40
[default0]:[2023-09-01 14:25:34,252] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.14 | bwd_microstep: 1301.25 | bwd_inner_microstep: 1291.57 | bwd_allreduce_microstep: 9.58 | step_microstep: 166.87
[default0]:[2023-09-01 14:25:34,253] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.14 (fwd_moe: 293.94, 1st_a2a: 2.77, 2nd_a2a: 2.65, top_k: 100.11)
[default0]:[2023-09-01 14:25:34,253] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1301.25 | bwd_inner: 1291.57 | bwd_allreduce: 9.58 | step: 166.87
[default0]:[2023-09-01 14:25:36,439] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.50 | optimizer_gradients: 22.18 | optimizer_step: 41.38
[default0]:[2023-09-01 14:25:36,439] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.11 | bwd_microstep: 1296.86 | bwd_inner_microstep: 1287.16 | bwd_allreduce_microstep: 9.60 | step_microstep: 165.98
[default0]:[2023-09-01 14:25:36,439] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.11 (fwd_moe: 291.77, 1st_a2a: 2.80, 2nd_a2a: 2.66, top_k: 100.12)
[default0]:[2023-09-01 14:25:36,439] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1296.86 | bwd_inner: 1287.16 | bwd_allreduce: 9.60 | step: 165.98
[default0]:[2023-09-01 14:25:38,644] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.47 | optimizer_gradients: 22.19 | optimizer_step: 41.46
[default0]:[2023-09-01 14:25:38,644] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.41 | bwd_microstep: 1297.47 | bwd_inner_microstep: 1287.76 | bwd_allreduce_microstep: 9.60 | step_microstep: 166.53
[default0]:[2023-09-01 14:25:38,645] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.41 (fwd_moe: 291.37, 1st_a2a: 2.75, 2nd_a2a: 2.67, top_k: 99.84)
[default0]:[2023-09-01 14:25:38,645] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1297.47 | bwd_inner: 1287.76 | bwd_allreduce: 9.60 | step: 166.53
[default0]:[2023-09-01 14:25:40,846] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.49 | optimizer_gradients: 22.18 | optimizer_step: 41.36
[default0]:[2023-09-01 14:25:40,846] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 593.43 | bwd_microstep: 1295.21 | bwd_inner_microstep: 1285.66 | bwd_allreduce_microstep: 9.45 | step_microstep: 166.40
[default0]:[2023-09-01 14:25:40,847] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 593.44 (fwd_moe: 290.50, 1st_a2a: 2.75, 2nd_a2a: 2.64, top_k: 99.57)
[default0]:[2023-09-01 14:25:40,847] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1295.21 | bwd_inner: 1285.66 | bwd_allreduce: 9.46 | step: 166.40
[default0]:[2023-09-01 14:25:43,017] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.49 | optimizer_gradients: 22.19 | optimizer_step: 41.39
[default0]:[2023-09-01 14:25:43,017] [INFO] [logging.py:96:log_dist] [Rank 0] step=65, skipped=0, lr=[5.592405333333334e-07, 5.592405333333334e-07, 5.592405333333334e-07, 5.592405333333334e-07, 5.592405333333334e-07, 5.592405333333334e-07, 5.592405333333334e-07, 5.592405333333334e-07, 5.592405333333334e-07], mom=[(0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95)]
[default0]:[2023-09-01 14:25:43,018] [INFO] [timer.py:260:stop] epoch=0/micro_step=65/global_step=65, RunningAvgSamplesPerSec=3.8877907185955918, CurrSamplesPerSec=3.8891627234451924, MemAllocated=20.91GB, MaxMemAllocated=31.29GB
[default0]:[2023-09-01 14:25:43,018] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.03 | bwd_microstep: 1296.92 | bwd_inner_microstep: 1287.26 | bwd_allreduce_microstep: 9.56 | step_microstep: 167.05
[default0]:[2023-09-01 14:25:43,018] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.03 (fwd_moe: 291.03, 1st_a2a: 2.77, 2nd_a2a: 2.65, top_k: 99.70)
[default0]:[2023-09-01 14:25:43,018] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1296.92 | bwd_inner: 1287.26 | bwd_allreduce: 9.56 | step: 167.06
[default0]: iteration       65/54931640 | consumed samples:          520 | consumed tokens:      1064960 | elapsed time per iteration (ms): 2206.2 | learning rate: 5.592E-07 | global batch size:     8 | lm loss: 9.721619E+00 | moe loss: 1.206416E-01 | loss scale: 2048.0 | actual seqlen:  2048 | number of skipped iterations:   0 | number of nan iterations:   0 | samples per second: 3.626 | TFLOPs: 52.78 |
[default0]:[2023-09-01 14:25:45,251] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.51 | optimizer_gradients: 22.28 | optimizer_step: 41.51
[default0]:[2023-09-01 14:25:45,251] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.85 | bwd_microstep: 1298.21 | bwd_inner_microstep: 1288.66 | bwd_allreduce_microstep: 9.45 | step_microstep: 166.89
[default0]:[2023-09-01 14:25:45,251] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.85 (fwd_moe: 291.83, 1st_a2a: 2.82, 2nd_a2a: 2.65, top_k: 99.97)
[default0]:[2023-09-01 14:25:45,252] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1298.21 | bwd_inner: 1288.67 | bwd_allreduce: 9.45 | step: 166.89
[default0]:[2023-09-01 14:25:47,500] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.50 | optimizer_gradients: 22.25 | optimizer_step: 41.43
[default0]:[2023-09-01 14:25:47,501] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.68 | bwd_microstep: 1299.51 | bwd_inner_microstep: 1289.64 | bwd_allreduce_microstep: 9.76 | step_microstep: 166.85
[default0]:[2023-09-01 14:25:47,501] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.68 (fwd_moe: 292.67, 1st_a2a: 2.83, 2nd_a2a: 2.66, top_k: 100.74)
[default0]:[2023-09-01 14:25:47,501] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1299.51 | bwd_inner: 1289.65 | bwd_allreduce: 9.76 | step: 166.85
[default0]:[2023-09-01 14:25:49,711] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.46 | optimizer_gradients: 22.21 | optimizer_step: 41.33
[default0]:[2023-09-01 14:25:49,712] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.20 | bwd_microstep: 1296.35 | bwd_inner_microstep: 1286.74 | bwd_allreduce_microstep: 9.52 | step_microstep: 166.46
[default0]:[2023-09-01 14:25:49,712] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.20 (fwd_moe: 291.55, 1st_a2a: 2.79, 2nd_a2a: 2.66, top_k: 99.84)
[default0]:[2023-09-01 14:25:49,712] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1296.35 | bwd_inner: 1286.74 | bwd_allreduce: 9.52 | step: 166.46
[default0]:[2023-09-01 14:25:51,983] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.48 | optimizer_gradients: 22.21 | optimizer_step: 41.37
[default0]:[2023-09-01 14:25:51,983] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.89 | bwd_microstep: 1298.26 | bwd_inner_microstep: 1288.64 | bwd_allreduce_microstep: 9.51 | step_microstep: 166.47
[default0]:[2023-09-01 14:25:51,984] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.89 (fwd_moe: 291.49, 1st_a2a: 2.81, 2nd_a2a: 2.66, top_k: 99.95)
[default0]:[2023-09-01 14:25:51,984] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1298.26 | bwd_inner: 1288.65 | bwd_allreduce: 9.51 | step: 166.47
[default0]:[2023-09-01 14:25:54,237] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.49 | optimizer_gradients: 22.24 | optimizer_step: 41.29
[default0]:[2023-09-01 14:25:54,237] [INFO] [logging.py:96:log_dist] [Rank 0] step=70, skipped=0, lr=[6.029312000000001e-07, 6.029312000000001e-07, 6.029312000000001e-07, 6.029312000000001e-07, 6.029312000000001e-07, 6.029312000000001e-07, 6.029312000000001e-07, 6.029312000000001e-07, 6.029312000000001e-07], mom=[(0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95)]
[default0]:[2023-09-01 14:25:54,237] [INFO] [timer.py:260:stop] epoch=0/micro_step=70/global_step=70, RunningAvgSamplesPerSec=3.887713516460143, CurrSamplesPerSec=3.8841664203932664, MemAllocated=20.91GB, MaxMemAllocated=31.29GB
[default0]:[2023-09-01 14:25:54,238] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.64 | bwd_microstep: 1298.32 | bwd_inner_microstep: 1288.60 | bwd_allreduce_microstep: 9.62 | step_microstep: 168.71
[default0]:[2023-09-01 14:25:54,238] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.64 (fwd_moe: 291.47, 1st_a2a: 2.76, 2nd_a2a: 2.66, top_k: 99.92)
[default0]:[2023-09-01 14:25:54,238] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1298.32 | bwd_inner: 1288.60 | bwd_allreduce: 9.62 | step: 168.72
[default0]: iteration       70/54931640 | consumed samples:          560 | consumed tokens:      1146880 | elapsed time per iteration (ms): 2243.9 | learning rate: 6.029E-07 | global batch size:     8 | lm loss: 9.696068E+00 | moe loss: 1.207867E-01 | loss scale: 2048.0 | actual seqlen:  2048 | number of skipped iterations:   0 | number of nan iterations:   0 | samples per second: 3.565 | TFLOPs: 51.90 |
[default0]:[2023-09-01 14:25:56,466] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.55 | optimizer_gradients: 22.38 | optimizer_step: 41.39
[default0]:[2023-09-01 14:25:56,467] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.67 | bwd_microstep: 1297.92 | bwd_inner_microstep: 1288.18 | bwd_allreduce_microstep: 9.64 | step_microstep: 166.96
[default0]:[2023-09-01 14:25:56,467] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.67 (fwd_moe: 291.08, 1st_a2a: 2.80, 2nd_a2a: 2.66, top_k: 99.77)
[default0]:[2023-09-01 14:25:56,467] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1297.92 | bwd_inner: 1288.18 | bwd_allreduce: 9.64 | step: 166.97
[default0]:[2023-09-01 14:25:58,675] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.50 | optimizer_gradients: 22.26 | optimizer_step: 41.33
[default0]:[2023-09-01 14:25:58,676] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.13 | bwd_microstep: 1299.80 | bwd_inner_microstep: 1290.15 | bwd_allreduce_microstep: 9.55 | step_microstep: 166.87
[default0]:[2023-09-01 14:25:58,676] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.13 (fwd_moe: 292.48, 1st_a2a: 2.80, 2nd_a2a: 2.69, top_k: 100.37)
[default0]:[2023-09-01 14:25:58,676] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1299.80 | bwd_inner: 1290.15 | bwd_allreduce: 9.55 | step: 166.88
[default0]:[2023-09-01 14:26:00,938] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.47 | optimizer_gradients: 22.23 | optimizer_step: 41.34
[default0]:[2023-09-01 14:26:00,939] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.22 | bwd_microstep: 1295.52 | bwd_inner_microstep: 1285.85 | bwd_allreduce_microstep: 9.57 | step_microstep: 166.62
[default0]:[2023-09-01 14:26:00,939] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.23 (fwd_moe: 290.11, 1st_a2a: 2.74, 2nd_a2a: 2.66, top_k: 99.38)
[default0]:[2023-09-01 14:26:00,939] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1295.52 | bwd_inner: 1285.86 | bwd_allreduce: 9.57 | step: 166.62
[default0]:[2023-09-01 14:26:03,129] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.46 | optimizer_gradients: 22.52 | optimizer_step: 41.85
[default0]:[2023-09-01 14:26:03,129] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.11 | bwd_microstep: 1297.47 | bwd_inner_microstep: 1287.92 | bwd_allreduce_microstep: 9.46 | step_microstep: 167.16
[default0]:[2023-09-01 14:26:03,129] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.11 (fwd_moe: 292.06, 1st_a2a: 2.78, 2nd_a2a: 2.67, top_k: 100.05)
[default0]:[2023-09-01 14:26:03,129] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1297.47 | bwd_inner: 1287.92 | bwd_allreduce: 9.46 | step: 167.16
[default0]:[2023-09-01 14:26:05,310] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.47 | optimizer_gradients: 22.24 | optimizer_step: 41.45
[default0]:[2023-09-01 14:26:05,310] [INFO] [logging.py:96:log_dist] [Rank 0] step=75, skipped=0, lr=[6.466218666666667e-07, 6.466218666666667e-07, 6.466218666666667e-07, 6.466218666666667e-07, 6.466218666666667e-07, 6.466218666666667e-07, 6.466218666666667e-07, 6.466218666666667e-07, 6.466218666666667e-07], mom=[(0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95)]
[default0]:[2023-09-01 14:26:05,310] [INFO] [timer.py:260:stop] epoch=0/micro_step=75/global_step=75, RunningAvgSamplesPerSec=3.8876329662806848, CurrSamplesPerSec=3.883089878590487, MemAllocated=20.91GB, MaxMemAllocated=31.29GB
[default0]:[2023-09-01 14:26:05,311] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.47 | bwd_microstep: 1299.51 | bwd_inner_microstep: 1289.79 | bwd_allreduce_microstep: 9.62 | step_microstep: 167.26
[default0]:[2023-09-01 14:26:05,311] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.47 (fwd_moe: 292.88, 1st_a2a: 2.82, 2nd_a2a: 2.67, top_k: 100.82)
[default0]:[2023-09-01 14:26:05,311] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1299.51 | bwd_inner: 1289.80 | bwd_allreduce: 9.62 | step: 167.26
[default0]: iteration       75/54931640 | consumed samples:          600 | consumed tokens:      1228800 | elapsed time per iteration (ms): 2214.6 | learning rate: 6.466E-07 | global batch size:     8 | lm loss: 9.734926E+00 | moe loss: 1.206486E-01 | loss scale: 2048.0 | actual seqlen:  2048 | number of skipped iterations:   0 | number of nan iterations:   0 | samples per second: 3.612 | TFLOPs: 52.58 |
[default0]:[2023-09-01 14:26:07,561] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.46 | optimizer_gradients: 22.20 | optimizer_step: 41.38
[default0]:[2023-09-01 14:26:07,562] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.05 | bwd_microstep: 1297.66 | bwd_inner_microstep: 1287.96 | bwd_allreduce_microstep: 9.59 | step_microstep: 166.48
[default0]:[2023-09-01 14:26:07,562] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.05 (fwd_moe: 292.23, 1st_a2a: 2.88, 2nd_a2a: 2.71, top_k: 100.22)
[default0]:[2023-09-01 14:26:07,562] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1297.66 | bwd_inner: 1287.97 | bwd_allreduce: 9.59 | step: 166.49
[default0]:[2023-09-01 14:26:09,907] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.48 | optimizer_gradients: 22.28 | optimizer_step: 41.35
[default0]:[2023-09-01 14:26:09,907] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.49 | bwd_microstep: 1299.04 | bwd_inner_microstep: 1289.34 | bwd_allreduce_microstep: 9.59 | step_microstep: 167.05
[default0]:[2023-09-01 14:26:09,907] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.50 (fwd_moe: 291.96, 1st_a2a: 2.79, 2nd_a2a: 2.64, top_k: 100.06)
[default0]:[2023-09-01 14:26:09,907] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1299.04 | bwd_inner: 1289.35 | bwd_allreduce: 9.58 | step: 167.05
[default0]:[2023-09-01 14:26:12,131] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.45 | optimizer_gradients: 22.20 | optimizer_step: 41.35
[default0]:[2023-09-01 14:26:12,132] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.01 | bwd_microstep: 1295.12 | bwd_inner_microstep: 1285.40 | bwd_allreduce_microstep: 9.61 | step_microstep: 166.04
[default0]:[2023-09-01 14:26:12,132] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.01 (fwd_moe: 290.63, 1st_a2a: 2.78, 2nd_a2a: 2.66, top_k: 99.65)
[default0]:[2023-09-01 14:26:12,132] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1295.12 | bwd_inner: 1285.41 | bwd_allreduce: 9.61 | step: 166.05
[default0]:[2023-09-01 14:26:14,365] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.49 | optimizer_gradients: 22.25 | optimizer_step: 41.46
[default0]:[2023-09-01 14:26:14,366] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.80 | bwd_microstep: 1302.21 | bwd_inner_microstep: 1292.49 | bwd_allreduce_microstep: 9.61 | step_microstep: 166.28
[default0]:[2023-09-01 14:26:14,366] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.80 (fwd_moe: 293.77, 1st_a2a: 2.79, 2nd_a2a: 2.66, top_k: 100.09)
[default0]:[2023-09-01 14:26:14,366] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1302.21 | bwd_inner: 1292.50 | bwd_allreduce: 9.61 | step: 166.28
[default0]:[2023-09-01 14:26:16,576] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.46 | optimizer_gradients: 22.21 | optimizer_step: 41.38
[default0]:[2023-09-01 14:26:16,576] [INFO] [logging.py:96:log_dist] [Rank 0] step=80, skipped=0, lr=[6.903125333333334e-07, 6.903125333333334e-07, 6.903125333333334e-07, 6.903125333333334e-07, 6.903125333333334e-07, 6.903125333333334e-07, 6.903125333333334e-07, 6.903125333333334e-07, 6.903125333333334e-07], mom=[(0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95)]
[default0]:[2023-09-01 14:26:16,577] [INFO] [timer.py:260:stop] epoch=0/micro_step=80/global_step=80, RunningAvgSamplesPerSec=3.8876163160449613, CurrSamplesPerSec=3.888610148615681, MemAllocated=20.91GB, MaxMemAllocated=31.29GB
[default0]:[2023-09-01 14:26:16,577] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.10 | bwd_microstep: 1297.17 | bwd_inner_microstep: 1287.37 | bwd_allreduce_microstep: 9.69 | step_microstep: 167.09
[default0]:[2023-09-01 14:26:16,577] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.10 (fwd_moe: 291.49, 1st_a2a: 2.76, 2nd_a2a: 2.67, top_k: 99.98)
[default0]:[2023-09-01 14:26:16,577] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1297.16 | bwd_inner: 1287.38 | bwd_allreduce: 9.69 | step: 167.09
[default0]: iteration       80/54931640 | consumed samples:          640 | consumed tokens:      1310720 | elapsed time per iteration (ms): 2253.4 | learning rate: 6.903E-07 | global batch size:     8 | lm loss: 9.715349E+00 | moe loss: 1.205716E-01 | loss scale: 2048.0 | actual seqlen:  2048 | number of skipped iterations:   0 | number of nan iterations:   0 | samples per second: 3.550 | TFLOPs: 51.68 |
[default0]:[2023-09-01 14:26:18,790] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.49 | optimizer_gradients: 22.21 | optimizer_step: 41.36
[default0]:[2023-09-01 14:26:18,791] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.84 | bwd_microstep: 1297.03 | bwd_inner_microstep: 1287.29 | bwd_allreduce_microstep: 9.63 | step_microstep: 166.97
[default0]:[2023-09-01 14:26:18,791] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.84 (fwd_moe: 291.47, 1st_a2a: 2.78, 2nd_a2a: 2.73, top_k: 99.91)
[default0]:[2023-09-01 14:26:18,791] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1297.03 | bwd_inner: 1287.30 | bwd_allreduce: 9.62 | step: 166.97
[default0]:[2023-09-01 14:26:20,984] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.46 | optimizer_gradients: 22.24 | optimizer_step: 41.38
[default0]:[2023-09-01 14:26:20,984] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 593.12 | bwd_microstep: 1298.65 | bwd_inner_microstep: 1288.95 | bwd_allreduce_microstep: 9.59 | step_microstep: 166.96
[default0]:[2023-09-01 14:26:20,984] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 593.12 (fwd_moe: 292.17, 1st_a2a: 2.79, 2nd_a2a: 2.66, top_k: 99.99)
[default0]:[2023-09-01 14:26:20,985] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1298.65 | bwd_inner: 1288.95 | bwd_allreduce: 9.59 | step: 166.96
[default0]:[2023-09-01 14:26:23,255] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.54 | optimizer_gradients: 22.20 | optimizer_step: 41.38
[default0]:[2023-09-01 14:26:23,256] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.97 | bwd_microstep: 1296.25 | bwd_inner_microstep: 1286.70 | bwd_allreduce_microstep: 9.44 | step_microstep: 166.80
[default0]:[2023-09-01 14:26:23,256] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.97 (fwd_moe: 291.29, 1st_a2a: 2.77, 2nd_a2a: 2.65, top_k: 99.87)
[default0]:[2023-09-01 14:26:23,256] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1296.25 | bwd_inner: 1286.70 | bwd_allreduce: 9.45 | step: 166.80
[default0]:[2023-09-01 14:26:25,463] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.55 | optimizer_gradients: 22.20 | optimizer_step: 41.69
[default0]:[2023-09-01 14:26:25,463] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.22 | bwd_microstep: 1299.09 | bwd_inner_microstep: 1289.38 | bwd_allreduce_microstep: 9.60 | step_microstep: 166.97
[default0]:[2023-09-01 14:26:25,463] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.22 (fwd_moe: 291.53, 1st_a2a: 2.79, 2nd_a2a: 2.64, top_k: 100.04)
[default0]:[2023-09-01 14:26:25,464] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1299.08 | bwd_inner: 1289.38 | bwd_allreduce: 9.61 | step: 166.97
[default0]:[2023-09-01 14:26:27,669] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.47 | optimizer_gradients: 22.19 | optimizer_step: 41.47
[default0]:[2023-09-01 14:26:27,669] [INFO] [logging.py:96:log_dist] [Rank 0] step=85, skipped=0, lr=[7.340032000000002e-07, 7.340032000000002e-07, 7.340032000000002e-07, 7.340032000000002e-07, 7.340032000000002e-07, 7.340032000000002e-07, 7.340032000000002e-07, 7.340032000000002e-07, 7.340032000000002e-07], mom=[(0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95)]
[default0]:[2023-09-01 14:26:27,670] [INFO] [timer.py:260:stop] epoch=0/micro_step=85/global_step=85, RunningAvgSamplesPerSec=3.8876101756316928, CurrSamplesPerSec=3.8902642850650277, MemAllocated=20.91GB, MaxMemAllocated=31.29GB
[default0]:[2023-09-01 14:26:27,670] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.84 | bwd_microstep: 1296.73 | bwd_inner_microstep: 1286.97 | bwd_allreduce_microstep: 9.64 | step_microstep: 166.89
[default0]:[2023-09-01 14:26:27,670] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.84 (fwd_moe: 291.28, 1st_a2a: 2.78, 2nd_a2a: 2.64, top_k: 99.99)
[default0]:[2023-09-01 14:26:27,670] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1296.73 | bwd_inner: 1286.98 | bwd_allreduce: 9.64 | step: 166.89
[default0]: iteration       85/54931640 | consumed samples:          680 | consumed tokens:      1392640 | elapsed time per iteration (ms): 2218.5 | learning rate: 7.340E-07 | global batch size:     8 | lm loss: 9.665760E+00 | moe loss: 1.207139E-01 | loss scale: 2048.0 | actual seqlen:  2048 | number of skipped iterations:   0 | number of nan iterations:   0 | samples per second: 3.606 | TFLOPs: 52.49 |
[default0]:[2023-09-01 14:26:29,881] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.46 | optimizer_gradients: 22.19 | optimizer_step: 41.48
[default0]:[2023-09-01 14:26:29,881] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.53 | bwd_microstep: 1296.53 | bwd_inner_microstep: 1286.91 | bwd_allreduce_microstep: 9.52 | step_microstep: 166.31
[default0]:[2023-09-01 14:26:29,881] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.53 (fwd_moe: 290.61, 1st_a2a: 2.81, 2nd_a2a: 2.66, top_k: 99.68)
[default0]:[2023-09-01 14:26:29,882] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1296.53 | bwd_inner: 1286.91 | bwd_allreduce: 9.52 | step: 166.31
[default0]:[2023-09-01 14:26:32,049] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.47 | optimizer_gradients: 22.18 | optimizer_step: 41.46
[default0]:[2023-09-01 14:26:32,050] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.96 | bwd_microstep: 1296.40 | bwd_inner_microstep: 1286.74 | bwd_allreduce_microstep: 9.56 | step_microstep: 166.45
[default0]:[2023-09-01 14:26:32,050] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.96 (fwd_moe: 291.04, 1st_a2a: 2.74, 2nd_a2a: 2.64, top_k: 99.76)
[default0]:[2023-09-01 14:26:32,050] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1296.40 | bwd_inner: 1286.74 | bwd_allreduce: 9.57 | step: 166.44
[default0]:[2023-09-01 14:26:34,298] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.46 | optimizer_gradients: 22.21 | optimizer_step: 41.39
[default0]:[2023-09-01 14:26:34,299] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.57 | bwd_microstep: 1296.97 | bwd_inner_microstep: 1287.32 | bwd_allreduce_microstep: 9.54 | step_microstep: 167.85
[default0]:[2023-09-01 14:26:34,299] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.57 (fwd_moe: 291.89, 1st_a2a: 2.78, 2nd_a2a: 2.66, top_k: 99.70)
[default0]:[2023-09-01 14:26:34,299] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1296.97 | bwd_inner: 1287.32 | bwd_allreduce: 9.54 | step: 167.86
[default0]:[2023-09-01 14:26:36,473] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.46 | optimizer_gradients: 22.22 | optimizer_step: 41.38
[default0]:[2023-09-01 14:26:36,474] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.98 | bwd_microstep: 1296.98 | bwd_inner_microstep: 1287.22 | bwd_allreduce_microstep: 9.64 | step_microstep: 166.61
[default0]:[2023-09-01 14:26:36,474] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.98 (fwd_moe: 291.62, 1st_a2a: 2.76, 2nd_a2a: 2.65, top_k: 100.09)
[default0]:[2023-09-01 14:26:36,474] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1296.98 | bwd_inner: 1287.23 | bwd_allreduce: 9.65 | step: 166.62
[default0]:[2023-09-01 14:26:38,699] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.48 | optimizer_gradients: 22.28 | optimizer_step: 41.42
[default0]:[2023-09-01 14:26:38,699] [INFO] [logging.py:96:log_dist] [Rank 0] step=90, skipped=0, lr=[7.776938666666667e-07, 7.776938666666667e-07, 7.776938666666667e-07, 7.776938666666667e-07, 7.776938666666667e-07, 7.776938666666667e-07, 7.776938666666667e-07, 7.776938666666667e-07, 7.776938666666667e-07], mom=[(0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95)]
[default0]:[2023-09-01 14:26:38,699] [INFO] [timer.py:260:stop] epoch=0/micro_step=90/global_step=90, RunningAvgSamplesPerSec=3.8876590652611704, CurrSamplesPerSec=3.882543969643558, MemAllocated=20.91GB, MaxMemAllocated=31.29GB
[default0]:[2023-09-01 14:26:38,700] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.87 | bwd_microstep: 1300.45 | bwd_inner_microstep: 1290.70 | bwd_allreduce_microstep: 9.65 | step_microstep: 167.19
[default0]:[2023-09-01 14:26:38,700] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.87 (fwd_moe: 292.23, 1st_a2a: 2.82, 2nd_a2a: 2.66, top_k: 100.21)
[default0]:[2023-09-01 14:26:38,700] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1300.45 | bwd_inner: 1290.70 | bwd_allreduce: 9.65 | step: 167.20
[default0]: iteration       90/54931640 | consumed samples:          720 | consumed tokens:      1474560 | elapsed time per iteration (ms): 2206.0 | learning rate: 7.777E-07 | global batch size:     8 | lm loss: 9.578876E+00 | moe loss: 1.206313E-01 | loss scale: 2048.0 | actual seqlen:  2048 | number of skipped iterations:   0 | number of nan iterations:   0 | samples per second: 3.626 | TFLOPs: 52.79 |
[default0]:[2023-09-01 14:26:40,932] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.46 | optimizer_gradients: 22.25 | optimizer_step: 41.30
[default0]:[2023-09-01 14:26:40,932] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 593.94 | bwd_microstep: 1296.25 | bwd_inner_microstep: 1286.57 | bwd_allreduce_microstep: 9.57 | step_microstep: 166.53
[default0]:[2023-09-01 14:26:40,933] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 593.94 (fwd_moe: 291.30, 1st_a2a: 2.75, 2nd_a2a: 2.65, top_k: 99.94)
[default0]:[2023-09-01 14:26:40,933] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1296.25 | bwd_inner: 1286.57 | bwd_allreduce: 9.58 | step: 166.54
[default0]:[2023-09-01 14:26:43,140] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.50 | optimizer_gradients: 22.62 | optimizer_step: 42.03
[default0]:[2023-09-01 14:26:43,141] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.84 | bwd_microstep: 1298.17 | bwd_inner_microstep: 1288.49 | bwd_allreduce_microstep: 9.58 | step_microstep: 167.55
[default0]:[2023-09-01 14:26:43,141] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.84 (fwd_moe: 291.72, 1st_a2a: 2.79, 2nd_a2a: 2.85, top_k: 100.02)
[default0]:[2023-09-01 14:26:43,141] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1298.18 | bwd_inner: 1288.50 | bwd_allreduce: 9.58 | step: 167.55
[default0]:[2023-09-01 14:26:45,368] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.47 | optimizer_gradients: 22.21 | optimizer_step: 41.45
[default0]:[2023-09-01 14:26:45,368] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.84 | bwd_microstep: 1297.59 | bwd_inner_microstep: 1287.90 | bwd_allreduce_microstep: 9.59 | step_microstep: 166.61
[default0]:[2023-09-01 14:26:45,368] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.85 (fwd_moe: 291.82, 1st_a2a: 2.79, 2nd_a2a: 2.64, top_k: 99.97)
[default0]:[2023-09-01 14:26:45,368] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1297.59 | bwd_inner: 1287.90 | bwd_allreduce: 9.59 | step: 166.61
[default0]:[2023-09-01 14:26:47,598] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.55 | optimizer_gradients: 22.21 | optimizer_step: 41.49
[default0]:[2023-09-01 14:26:47,598] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.89 | bwd_microstep: 1298.69 | bwd_inner_microstep: 1288.99 | bwd_allreduce_microstep: 9.59 | step_microstep: 166.47
[default0]:[2023-09-01 14:26:47,599] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.89 (fwd_moe: 292.48, 1st_a2a: 2.76, 2nd_a2a: 2.68, top_k: 100.76)
[default0]:[2023-09-01 14:26:47,599] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1298.69 | bwd_inner: 1289.00 | bwd_allreduce: 9.59 | step: 166.47
[default0]:[2023-09-01 14:26:49,806] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.53 | optimizer_gradients: 22.20 | optimizer_step: 41.50
[default0]:[2023-09-01 14:26:49,806] [INFO] [logging.py:96:log_dist] [Rank 0] step=95, skipped=0, lr=[8.213845333333334e-07, 8.213845333333334e-07, 8.213845333333334e-07, 8.213845333333334e-07, 8.213845333333334e-07, 8.213845333333334e-07, 8.213845333333334e-07, 8.213845333333334e-07, 8.213845333333334e-07], mom=[(0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95)]
[default0]:[2023-09-01 14:26:49,807] [INFO] [timer.py:260:stop] epoch=0/micro_step=95/global_step=95, RunningAvgSamplesPerSec=3.887597177979858, CurrSamplesPerSec=3.886477943531317, MemAllocated=20.91GB, MaxMemAllocated=31.29GB
[default0]:[2023-09-01 14:26:49,807] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.85 | bwd_microstep: 1298.33 | bwd_inner_microstep: 1288.61 | bwd_allreduce_microstep: 9.62 | step_microstep: 167.31
[default0]:[2023-09-01 14:26:49,807] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.85 (fwd_moe: 291.28, 1st_a2a: 2.78, 2nd_a2a: 2.66, top_k: 99.99)
[default0]:[2023-09-01 14:26:49,807] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1298.33 | bwd_inner: 1288.61 | bwd_allreduce: 9.61 | step: 167.31
[default0]: iteration       95/54931640 | consumed samples:          760 | consumed tokens:      1556480 | elapsed time per iteration (ms): 2221.3 | learning rate: 8.214E-07 | global batch size:     8 | lm loss: 9.601669E+00 | moe loss: 1.208397E-01 | loss scale: 2048.0 | actual seqlen:  2048 | number of skipped iterations:   0 | number of nan iterations:   0 | samples per second: 3.602 | TFLOPs: 52.42 |
[default0]:[2023-09-01 14:26:51,981] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.48 | optimizer_gradients: 22.25 | optimizer_step: 41.39
[default0]:[2023-09-01 14:26:51,982] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.60 | bwd_microstep: 1297.12 | bwd_inner_microstep: 1287.42 | bwd_allreduce_microstep: 9.60 | step_microstep: 167.25
[default0]:[2023-09-01 14:26:51,982] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.60 (fwd_moe: 291.79, 1st_a2a: 2.77, 2nd_a2a: 2.67, top_k: 100.01)
[default0]:[2023-09-01 14:26:51,982] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1297.12 | bwd_inner: 1287.42 | bwd_allreduce: 9.60 | step: 167.25
[default0]:[2023-09-01 14:26:54,225] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.46 | optimizer_gradients: 22.23 | optimizer_step: 41.44
[default0]:[2023-09-01 14:26:54,226] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.07 | bwd_microstep: 1299.91 | bwd_inner_microstep: 1290.20 | bwd_allreduce_microstep: 9.61 | step_microstep: 167.48
[default0]:[2023-09-01 14:26:54,226] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.07 (fwd_moe: 291.98, 1st_a2a: 2.95, 2nd_a2a: 2.65, top_k: 100.15)
[default0]:[2023-09-01 14:26:54,226] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1299.91 | bwd_inner: 1290.20 | bwd_allreduce: 9.61 | step: 167.48
[default0]:[2023-09-01 14:26:56,456] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.49 | optimizer_gradients: 22.18 | optimizer_step: 41.39
[default0]:[2023-09-01 14:26:56,456] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.08 | bwd_microstep: 1298.00 | bwd_inner_microstep: 1288.25 | bwd_allreduce_microstep: 9.65 | step_microstep: 166.48
[default0]:[2023-09-01 14:26:56,457] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.09 (fwd_moe: 291.89, 1st_a2a: 2.84, 2nd_a2a: 2.66, top_k: 99.98)
[default0]:[2023-09-01 14:26:56,457] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1298.00 | bwd_inner: 1288.25 | bwd_allreduce: 9.65 | step: 166.48
[default0]:[2023-09-01 14:26:58,653] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.46 | optimizer_gradients: 22.23 | optimizer_step: 41.50
[default0]:[2023-09-01 14:26:58,653] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 591.83 | bwd_microstep: 1298.08 | bwd_inner_microstep: 1288.36 | bwd_allreduce_microstep: 9.61 | step_microstep: 166.72
[default0]:[2023-09-01 14:26:58,653] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 591.84 (fwd_moe: 291.62, 1st_a2a: 2.80, 2nd_a2a: 2.66, top_k: 100.02)
[default0]:[2023-09-01 14:26:58,653] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1298.07 | bwd_inner: 1288.36 | bwd_allreduce: 9.61 | step: 166.72
[default0]:[2023-09-01 14:27:00,901] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.53 | optimizer_gradients: 22.19 | optimizer_step: 41.42
[default0]:[2023-09-01 14:27:00,901] [INFO] [logging.py:96:log_dist] [Rank 0] step=100, skipped=0, lr=[8.650752e-07, 8.650752e-07, 8.650752e-07, 8.650752e-07, 8.650752e-07, 8.650752e-07, 8.650752e-07, 8.650752e-07, 8.650752e-07], mom=[(0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95)]
[default0]:[2023-09-01 14:27:00,902] [INFO] [timer.py:260:stop] epoch=0/micro_step=100/global_step=100, RunningAvgSamplesPerSec=3.887587847685466, CurrSamplesPerSec=3.8911742314206474, MemAllocated=20.91GB, MaxMemAllocated=31.29GB
[default0]:[2023-09-01 14:27:00,902] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 593.24 | bwd_microstep: 1294.94 | bwd_inner_microstep: 1285.33 | bwd_allreduce_microstep: 9.52 | step_microstep: 166.73
[default0]:[2023-09-01 14:27:00,902] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 593.24 (fwd_moe: 290.29, 1st_a2a: 2.76, 2nd_a2a: 2.65, top_k: 99.56)
[default0]:[2023-09-01 14:27:00,902] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1294.94 | bwd_inner: 1285.33 | bwd_allreduce: 9.52 | step: 166.73
[default0]: iteration      100/54931640 | consumed samples:          800 | consumed tokens:      1638400 | elapsed time per iteration (ms): 2219.0 | learning rate: 8.651E-07 | global batch size:     8 | lm loss: 9.581123E+00 | moe loss: 1.206725E-01 | loss scale: 2048.0 | actual seqlen:  2048 | number of skipped iterations:   0 | number of nan iterations:   0 | samples per second: 3.605 | TFLOPs: 52.48 |
[default0]:-----------------------------------------------------------------------------------------------
[default0]: validation loss at iteration 100 | lm loss value: 9.535101E+00 | lm loss PPL: 1.383699E+04 | 
[default0]:-----------------------------------------------------------------------------------------------
[default0]:[2023-09-01 14:27:38,900] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.51 | optimizer_gradients: 22.18 | optimizer_step: 41.37
[default0]:[2023-09-01 14:27:38,901] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 27423.38 | bwd_microstep: 1296.94 | bwd_inner_microstep: 1287.18 | bwd_allreduce_microstep: 9.65 | step_microstep: 166.64
[default0]:[2023-09-01 14:27:38,902] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 27423.41 (fwd_moe: 291.12, 1st_a2a: 2.78, 2nd_a2a: 2.67, top_k: 99.77)
[default0]:[2023-09-01 14:27:38,902] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1296.94 | bwd_inner: 1287.19 | bwd_allreduce: 9.65 | step: 166.64
[default0]:[2023-09-01 14:27:41,303] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.52 | optimizer_gradients: 22.20 | optimizer_step: 41.49
[default0]:[2023-09-01 14:27:41,303] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.43 | bwd_microstep: 1296.58 | bwd_inner_microstep: 1286.71 | bwd_allreduce_microstep: 9.77 | step_microstep: 166.58
[default0]:[2023-09-01 14:27:41,303] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.43 (fwd_moe: 290.68, 1st_a2a: 2.80, 2nd_a2a: 2.66, top_k: 99.49)
[default0]:[2023-09-01 14:27:41,304] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1296.58 | bwd_inner: 1286.71 | bwd_allreduce: 9.77 | step: 166.58
[default0]:[2023-09-01 14:27:43,581] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.50 | optimizer_gradients: 22.29 | optimizer_step: 41.42
[default0]:[2023-09-01 14:27:43,582] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.27 | bwd_microstep: 1300.14 | bwd_inner_microstep: 1290.36 | bwd_allreduce_microstep: 9.67 | step_microstep: 167.07
[default0]:[2023-09-01 14:27:43,582] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.27 (fwd_moe: 291.36, 1st_a2a: 2.77, 2nd_a2a: 2.67, top_k: 100.09)
[default0]:[2023-09-01 14:27:43,582] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1300.14 | bwd_inner: 1290.37 | bwd_allreduce: 9.67 | step: 167.08
[default0]:[2023-09-01 14:27:45,810] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.46 | optimizer_gradients: 22.18 | optimizer_step: 41.34
[default0]:[2023-09-01 14:27:45,810] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 593.13 | bwd_microstep: 1300.31 | bwd_inner_microstep: 1290.58 | bwd_allreduce_microstep: 9.63 | step_microstep: 166.49
[default0]:[2023-09-01 14:27:45,810] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 593.13 (fwd_moe: 292.10, 1st_a2a: 2.85, 2nd_a2a: 2.69, top_k: 100.21)
[default0]:[2023-09-01 14:27:45,810] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1300.31 | bwd_inner: 1290.58 | bwd_allreduce: 9.63 | step: 166.49
[default0]:[2023-09-01 14:27:48,029] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.62 | optimizer_gradients: 22.26 | optimizer_step: 41.35
[default0]:[2023-09-01 14:27:48,030] [INFO] [logging.py:96:log_dist] [Rank 0] step=105, skipped=0, lr=[9.087658666666667e-07, 9.087658666666667e-07, 9.087658666666667e-07, 9.087658666666667e-07, 9.087658666666667e-07, 9.087658666666667e-07, 9.087658666666667e-07, 9.087658666666667e-07, 9.087658666666667e-07], mom=[(0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95), (0.9, 0.95)]
[default0]:[2023-09-01 14:27:48,030] [INFO] [timer.py:260:stop] epoch=0/micro_step=105/global_step=105, RunningAvgSamplesPerSec=3.887513546374929, CurrSamplesPerSec=3.8859904863135077, MemAllocated=20.91GB, MaxMemAllocated=31.29GB
[default0]:[2023-09-01 14:27:48,030] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.48 | bwd_microstep: 1297.98 | bwd_inner_microstep: 1288.17 | bwd_allreduce_microstep: 9.69 | step_microstep: 167.24
[default0]:[2023-09-01 14:27:48,030] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.48 (fwd_moe: 291.41, 1st_a2a: 2.78, 2nd_a2a: 2.67, top_k: 99.93)
[default0]:[2023-09-01 14:27:48,030] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1297.97 | bwd_inner: 1288.18 | bwd_allreduce: 9.69 | step: 167.24
[default0]: iteration      105/54931640 | consumed samples:          840 | consumed tokens:      1720320 | elapsed time per iteration (ms): 9425.7 | learning rate: 9.088E-07 | global batch size:     8 | lm loss: 9.536827E+00 | moe loss: 1.206915E-01 | loss scale: 2048.0 | actual seqlen:  2048 | number of skipped iterations:   0 | number of nan iterations:   0 | samples per second: 0.849 | TFLOPs: 12.35 |
[default0]:[2023-09-01 14:27:50,364] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.51 | optimizer_gradients: 22.20 | optimizer_step: 41.45
[default0]:[2023-09-01 14:27:50,364] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.74 | bwd_microstep: 1297.96 | bwd_inner_microstep: 1288.19 | bwd_allreduce_microstep: 9.65 | step_microstep: 166.83
[default0]:[2023-09-01 14:27:50,364] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.75 (fwd_moe: 291.41, 1st_a2a: 2.79, 2nd_a2a: 2.66, top_k: 99.73)
[default0]:[2023-09-01 14:27:50,365] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1297.96 | bwd_inner: 1288.20 | bwd_allreduce: 9.65 | step: 166.83
[default0]:[2023-09-01 14:27:52,577] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.50 | optimizer_gradients: 22.26 | optimizer_step: 41.60
[default0]:[2023-09-01 14:27:52,577] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 593.10 | bwd_microstep: 1298.05 | bwd_inner_microstep: 1288.57 | bwd_allreduce_microstep: 9.38 | step_microstep: 167.31
[default0]:[2023-09-01 14:27:52,578] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 593.10 (fwd_moe: 292.21, 1st_a2a: 2.75, 2nd_a2a: 2.66, top_k: 100.06)
[default0]:[2023-09-01 14:27:52,578] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1298.05 | bwd_inner: 1288.57 | bwd_allreduce: 9.38 | step: 167.31
[default0]:[2023-09-01 14:27:54,769] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.47 | optimizer_gradients: 22.21 | optimizer_step: 41.37
[default0]:[2023-09-01 14:27:54,770] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 593.42 | bwd_microstep: 1300.63 | bwd_inner_microstep: 1290.82 | bwd_allreduce_microstep: 9.70 | step_microstep: 166.74
[default0]:[2023-09-01 14:27:54,770] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 593.43 (fwd_moe: 291.90, 1st_a2a: 2.90, 2nd_a2a: 2.69, top_k: 100.08)
[default0]:[2023-09-01 14:27:54,770] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1300.62 | bwd_inner: 1290.82 | bwd_allreduce: 9.70 | step: 166.74
[default0]:[2023-09-01 14:27:56,874] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | optimizer_allgather: 9.48 | optimizer_gradients: 22.25 | optimizer_step: 41.33
[default0]:[2023-09-01 14:27:56,875] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd_microstep: 592.16 | bwd_microstep: 1296.38 | bwd_inner_microstep: 1286.46 | bwd_allreduce_microstep: 9.82 | step_microstep: 166.51
[default0]:[2023-09-01 14:27:56,875] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 592.16 (fwd_moe: 290.44, 1st_a2a: 2.78, 2nd_a2a: 2.68, top_k: 99.57)
[default0]:[2023-09-01 14:27:56,875] [INFO] [logging.py:96:log_dist] [Rank 0] time (ms) | fwd: 0.00 | bwd: 1296.38 | bwd_inner: 1286.46 | bwd_allreduce: 9.82 | step: 166.52
slurmstepd: error: *** JOB 4681705 ON n2dgx01 CANCELLED AT 2023-09-01T14:27:57 DUE TO TIME LIMIT ***
srun: Job step aborted: Waiting up to 32 seconds for job step to finish.
slurmstepd: error: *** STEP 4681705.0 ON n2dgx01 CANCELLED AT 2023-09-01T14:27:57 DUE TO TIME LIMIT ***
WARNING:torch.distributed.elastic.agent.server.api:Received 15 death signal, shutting down workers
WARNING:torch.distributed.elastic.multiprocessing.api:Sending process 852351 closing signal SIGTERM
